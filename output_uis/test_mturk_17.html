<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Get all the latest politics news Subscribe Thank you for subscribing We have more newsletters Show me See our privacy notice Invalid Email One of the IRA’s most senior former officers has admitted for the first time that the terror <role id='role-0-Attacker-0'trigno='0'>group</role> is responsible for the <role id='role-0-Place-0'trigno='0'>Birmingham</role> <role id='role-0-Target-0'trigno='0'>pub</role> <trigger id='trigger-0'>bombings</trigger>. Kieran Conway, who was head of the IRA’s intelligence-gathering department in the 1970s, broke a 40-year silence by the organisation to make the admission. He admitted he was “appalled and ashamed” because he claimed the bombing of civilians went against everything it stood for. He said the <trigger id='trigger-1'>attacks</trigger> on The <role id='role-1-Target-0'trigno='1'>Mulberry Bush</role> and The <role id='role-1-Target-1'trigno='1'>Tavern</role> in The <role id='role-1-Place-0'trigno='1'>Town</role> had been in revenge for the <trigger id='trigger-2'>death</trigger> of IRA bomber <role id='role-2-Victim-0'trigno='2'>James McDade</role>. At first he feared that the timing of the attacks-with very little warning-had been deliberate because “tempers were high” . But <role id='role-3-Participant-0'trigno='3'><role id='role-3-Participant-0'trigno='3'>he</role></role> was later <trigger id='trigger-3'>told</trigger> that the IRA unit involved had tried to use “a succession of phone boxes” which were out of order, significantly delaying the bomb-warning call. Video Loading Video Unavailable Click to play Tap to play The video will start in 8 Cancel Play now Listen to our recreation of the Birmingham pub bombings warning call-made to the Birmingham Post & Mail newsroom Conway, who makes the admissions in his new memoir, also revealed that soon after the bombings the IRA’s England Operational Commander and his adjutant “made it back home” to Dublin for an urgent de-brief and to assess the impact of the disaster as far as the terrorists were concerned. <role id='role-4-Place-0'trigno='4'>Birmingham</role> <role id='role-4-Target-0'trigno='4'>pub</role> <trigger id='trigger-4'>bombings</trigger>: Minute by minute-24 hours that changed our city forever Funding for the terrorists dried up almost overnight and the bombings, which left <role id='role-5-Victim-0'trigno='5'>21</role> <trigger id='trigger-5'>dead</trigger> and almost <role id='role-6-Victim-0'trigno='6'>200</role> <trigger id='trigger-6'>injured</trigger>, including <role id='role-7-Victim-0'trigno='7'>many</role> <trigger id='trigger-7'>maimed</trigger> for life, cost them hugely in the propaganda war. And in an interview he confirmed that the IRA hierarchy in Dublin knew all along that the six <role id='role-8-Detainee-0'trigno='8'>Irishmen</role> <trigger id='trigger-8'>arrested</trigger> for the explosions were innocent “from the get go, from the very start.” Now, Julie and Brian Hambleton, who lost their sister Maxine in the bombings and lead the city’s Justice4the21 campaign, called on West Midlands Police and David Cameron to take immediate action. <role id='role-9-Participant-0'trigno='9'><role id='role-9-Participant-0'trigno='9'>Julie</role></role> <trigger id='trigger-9'>said</trigger>: “I am expecting West Midlands Police Chief Constable Chris Sims and West Midlands Police Force to interview with Mr Conway with immediate effect. “And I hope that Mr Cameron, who a week ago told The House of Commons that the pub bombers must be found, takes note of this development and ensures that the police follow this through.” <role id='role-10-Participant-0'trigno='10'><role id='role-10-Participant-0'trigno='10'>Brian</role></role> <trigger id='trigger-10'>added</trigger>: “The police keep saying they won’t do anything because there is no fresh evidence. Well, here it is in black and white. It’s an admission. They have got to do something with this information.” The <role id='role-11-Place-0'trigno='11'>Birmingham</role> <role id='role-11-Target-0'trigno='11'>pub</role> <trigger id='trigger-11'>bombings</trigger>-The 28 numbers that add up to a cover-up, say campaigners Mr <role id='role-12-Participant-0'trigno='12'><role id='role-12-Participant-0'trigno='12'>Conway</role></role>, now a criminal lawyer in <role id='role-12-Place-0'trigno='12'>Dublin</role>, <trigger id='trigger-12'>says</trigger> in the book that where off-duty <role id='role-13-Target-0'trigno='13'>soldiers</role> were the targets of <trigger id='trigger-13'>bombings</trigger> “I had little sympathy for either the soldiers or the unfortunate civilians who had been sharing their drinking space.” <role id='role-14-Participant-0'trigno='14'><role id='role-14-Participant-0'trigno='14'>He</role></role> <trigger id='trigger-14'>continued</trigger>: “The Birmingham bombs were another matter."The bombings came after British police disrupted funeral arrangements for <role id='role-15-Victim-0'trigno='15'>James McDade</role>, a volunteer who had himself <trigger id='trigger-15'>died</trigger> in a premature explosion in <role id='role-15-Place-0'trigno='15'>England</role>. “Tempers were high and I, for one, certainly at first feared that the local IRA had knowingly caused these dreadful casualties–21 <role id='role-16-Victim-0'trigno='16'>people</role> were <trigger id='trigger-16'>killed</trigger> and a great many <role id='role-17-Victim-0'trigno='17'>others</role> <trigger id='trigger-17'>injured</trigger>.” “I was appalled and personally ashamed of the bombing, which went against everything we claimed to stand for.” <role id='role-18-Participant-0'trigno='18'><role id='role-18-Participant-0'trigno='18'>He</role></role> <trigger id='trigger-18'>said</trigger> <role id='role-19-Participant-0'trigno='19'><role id='role-19-Participant-0'trigno='19'>he</role></role> told two other senior IRA figures, <role id='role-19-Participant-1'trigno='19'><role id='role-19-Participant-1'trigno='19'>Dave O’Connell</role></role> and <role id='role-19-Participant-2'trigno='19'><role id='role-19-Participant-2'trigno='19'>Kevin Mallon</role></role> “exactly what I thought” when they <trigger id='trigger-19'>met up</trigger>. “In fact, both men were themselves furious, fully recognising not just the damage the bombing had caused to the IRA but its immorality as well.” <role id='role-20-Attacker-0'trigno='20'>McDade</role>, a lieutenant in the Birmingham Brigade of the IRA, <trigger id='trigger-20'>blew</trigger> himself up while trying to plant a <role id='role-20-ExplosiveDevice-0'trigno='20'>bomb</role> at <role id='role-20-Target-0'trigno='20'>Coventry Telephone exchange</role> a week before the <role id='role-21-Target-0'trigno='21'>pub</role> <trigger id='trigger-21'>bombings</trigger>. Neither The Mulberry Bush nor The Tavern in The Town had any military connection. Normal IRA procedure at the time for any attack on non-military targets was to give a 30-minute warning in order for full evacuations to take place. Read our docudrama minute-by-minute recreation of the events of November 21 1974 The <role id='role-22-Participant-0'trigno='22'><role id='role-22-Participant-0'trigno='22'>Birmingham Mail</role></role> received an ambiguous <trigger id='trigger-22'>call</trigger> at 8. 11pm on November 21. The caller did not identify either pub, referring instead to The Rotunda, above The Mulberry Bush and the New Street Tax Office, which was above the underground Tavern in The Town. The first <role id='role-23-ExplosiveDevice-0'trigno='23'>bomb</role> <trigger id='trigger-23'>destroyed</trigger> The <role id='role-23-Target-0'trigno='23'>Mulberry Bush</role> just six minutes later. The Tavern was destroyed at 8. 27pm. Conway was not directly involved in the debrief with the England Operational Commander. But <role id='role-24-Participant-0'trigno='24'><role id='role-24-Participant-0'trigno='24'>he</role></role> <trigger id='trigger-24'>said</trigger> he was later told “that the early indications were that the casualties were the result of yet another failure in the warning system, a succession of phone boxes from which the warning might have been relayed having proved to be inoperable.” In an interview with a national newspaper he described the <role id='role-25-Place-0'trigno='25'>Birmingham</role> <role id='role-25-Target-0'trigno='25'>pub</role> <trigger id='trigger-25'>bombings</trigger> as “a total disaster.” He added that the secret ‘ Feakle Talks’, held a couple of weeks after the bombings, were used by the IRA to try to start to repair its image after the <role id='role-26-Place-1'trigno='26'>Birmingham</role> and the <role id='role-26-Place-0'trigno='26'>Guildford</role> <role id='role-26-Target-0'trigno='26'>pub</role> <trigger id='trigger-26'>bombings</trigger>. The talks, in Feakle, County Clare, involved senior IRA officials and Protestant clergymen and ended abruptly after a tip-off that Irish Special Branch officers were on their way to arrest the republicans. But they set in train a process that eventually led to a brief ceasefire that began on December 22, 1974. Conway had been recruited in 1970, having been radicalised during the 1968 student protest movements. He met with senior republicans, including future deputy first minister of Northern Ireland Martin McGuinness and Sinn Fein president Gerry Adams. Adams continues to deny that he was ever in the IRA. Conway was later jailed in Belfast’s notorious Crumlin Road prison and went on hunger strike to achieve political status. Although he left the IRA in 1975, he rejoined during the 1981 hunger strike, then finally broke with the republican movement for good in 1993 when the British and Irish governments announced the Downing Street Declaration. He claimed the declaration basically reinforced partition. “The IRA went on ceasefire, it decommissioned and did all the things they said they would never do, and disappeared into history,” <role id='role-27-Participant-0'trigno='27'><role id='role-27-Participant-0'trigno='27'>he</role></role> <trigger id='trigger-27'>said</trigger>. “It was a complete and utter defeat, absolutely.” In his book he also claims that rogue Irish police officers colluded with the IRA throughout the Troubles and that members of the Dublin establishment, including several mainstream politicians, aided the Provisionals in their armed campaign. * Southside Provisional: From Freedom Fighter to The Four Courts is published by Orpen press. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "wiki_ied_bombings_5_news_3-E1", "text": "bombings", "offset": 49, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "group", "entity_id": "wiki_ied_bombings_5_news_3-T8", "offset": 42, "length": 1}]}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T10", "offset": 48, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Birmingham", "entity_id": "wiki_ied_bombings_5_news_3-T9", "offset": 47, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E2", "text": "attacks", "offset": 110, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "Mulberry Bush", "entity_id": "wiki_ied_bombings_5_news_3-T23", "offset": 113, "length": 2}, {"text": "Tavern", "entity_id": "wiki_ied_bombings_5_news_3-T24", "offset": 117, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "Town", "entity_id": "wiki_ied_bombings_5_news_3-T25", "offset": 120, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E15", "text": "death", "offset": 127, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "James McDade", "entity_id": "wiki_ied_bombings_5_news_3-T28", "offset": 131, "length": 2}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E16", "text": "told", "offset": 164, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T31", "offset": 161, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T31", "offset": 161, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E3", "text": "bombings", "offset": 294, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T52", "offset": 293, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Birmingham", "entity_id": "wiki_ied_bombings_5_news_3-T51", "offset": 292, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E4", "text": "dead", "offset": 322, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "21", "entity_id": "wiki_ied_bombings_5_news_3-T56", "offset": 321, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E5", "text": "injured", "offset": 326, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "200", "entity_id": "wiki_ied_bombings_5_news_3-T57", "offset": 325, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E6", "text": "maimed", "offset": 330, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "many", "entity_id": "wiki_ied_bombings_5_news_3-T58", "offset": 329, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E7", "text": "arrested", "offset": 361, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "Irishmen", "entity_id": "wiki_ied_bombings_5_news_3-T64", "offset": 360, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E17", "text": "said", "offset": 417, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Julie", "entity_id": "wiki_ied_bombings_5_news_3-T74", "offset": 416, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Julie", "entity_id": "wiki_ied_bombings_5_news_3-T74", "offset": 416, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E18", "text": "added", "offset": 485, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Brian", "entity_id": "wiki_ied_bombings_5_news_3-T87", "offset": 484, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Brian", "entity_id": "wiki_ied_bombings_5_news_3-T87", "offset": 484, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E8", "text": "bombings", "offset": 535, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T92", "offset": 534, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Birmingham", "entity_id": "wiki_ied_bombings_5_news_3-T91", "offset": 533, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E19", "text": "says", "offset": 561, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Conway", "entity_id": "wiki_ied_bombings_5_news_3-T94", "offset": 552, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Conway", "entity_id": "wiki_ied_bombings_5_news_3-T94", "offset": 552, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": [{"text": "Dublin", "entity_id": "wiki_ied_bombings_5_news_3-T96", "offset": 559, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E9", "text": "bombings", "offset": 575, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "soldiers", "entity_id": "wiki_ied_bombings_5_news_3-T97", "offset": 570, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E20", "text": "continued", "offset": 599, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "He", "entity_id": "wiki_ied_bombings_5_news_3-T105", "offset": 598, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "He", "entity_id": "wiki_ied_bombings_5_news_3-T105", "offset": 598, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E10", "text": "died", "offset": 628, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "James McDade", "entity_id": "wiki_ied_bombings_5_news_3-T110", "offset": 620, "length": 2}]}, {"role": "Place", "tokens": [{"text": "England", "entity_id": "wiki_ied_bombings_5_news_3-T114", "offset": 634, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E11", "text": "killed", "offset": 664, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_ied_bombings_5_news_3-T117", "offset": 662, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E12", "text": "injured", "offset": 670, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "others", "entity_id": "wiki_ied_bombings_5_news_3-T118", "offset": 669, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E21", "text": "said", "offset": 696, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "He", "entity_id": "wiki_ied_bombings_5_news_3-T121", "offset": 695, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "He", "entity_id": "wiki_ied_bombings_5_news_3-T121", "offset": 695, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E22", "text": "met up", "offset": 720, "length": 2, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T122", "offset": 697, "length": 1}, {"text": "Dave O\u2019Connell", "entity_id": "wiki_ied_bombings_5_news_3-T125", "offset": 705, "length": 4}, {"text": "Kevin Mallon", "entity_id": "wiki_ied_bombings_5_news_3-T126", "offset": 710, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T122", "offset": 697, "length": 1}, {"text": "Dave O\u2019Connell", "entity_id": "wiki_ied_bombings_5_news_3-T125", "offset": 705, "length": 4}, {"text": "Kevin Mallon", "entity_id": "wiki_ied_bombings_5_news_3-T126", "offset": 710, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E23", "text": "blew", "offset": 765, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "McDade", "entity_id": "wiki_ied_bombings_5_news_3-T133", "offset": 753, "length": 1}]}, {"role": "Target", "tokens": [{"text": "Coventry Telephone exchange", "entity_id": "wiki_ied_bombings_5_news_3-T139", "offset": 775, "length": 3}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": [{"text": "bomb", "entity_id": "wiki_ied_bombings_5_news_3-T138", "offset": 773, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E24", "text": "bombings", "offset": 783, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T140", "offset": 782, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E25", "text": "call", "offset": 853, "length": 1, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Birmingham Mail", "entity_id": "wiki_ied_bombings_5_news_3-T147", "offset": 848, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Birmingham Mail", "entity_id": "wiki_ied_bombings_5_news_3-T147", "offset": 848, "length": 2}]}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E26", "text": "destroyed", "offset": 900, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "Mulberry Bush", "entity_id": "wiki_ied_bombings_5_news_3-T157", "offset": 902, "length": 2}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": [{"text": "bomb", "entity_id": "wiki_ied_bombings_5_news_3-T156", "offset": 899, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E27", "text": "said", "offset": 934, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T162", "offset": 933, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T162", "offset": 933, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_ied_bombings_5_news_3-E13", "text": "bombings", "offset": 992, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T168", "offset": 991, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Birmingham", "entity_id": "wiki_ied_bombings_5_news_3-T167", "offset": 990, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E14", "text": "bombings", "offset": 1039, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "pub", "entity_id": "wiki_ied_bombings_5_news_3-T174", "offset": 1038, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Guildford", "entity_id": "wiki_ied_bombings_5_news_3-T173", "offset": 1037, "length": 1}, {"text": "Birmingham", "entity_id": "wiki_ied_bombings_5_news_3-T172", "offset": 1034, "length": 1}]}]}, {"event_id": "wiki_ied_bombings_5_news_3-E28", "text": "said", "offset": 1250, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T216", "offset": 1249, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "wiki_ied_bombings_5_news_3-T216", "offset": 1249, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>