<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      After explosives <trigger id='trigger-0'>killed</trigger> three <role id='role-0-Victim-0'trigno='0'>people</role> and <trigger id='trigger-1'>wounded</trigger> about 180 <role id='role-1-Victim-0'trigno='1'>others</role> during the Boston Marathon, details continue to trickle in as investigators sort through evidence. WHAT'S NEW--<role id='role-3-Participant-0'trigno='3'><role id='role-3-Participant-0'trigno='3'><role id='role-2-Communicator-0'trigno='2'>Obama</role></role></role> <trigger id='trigger-2'>declared</trigger> an emergency in <role id='role-3-Place-0'trigno='3'><role id='role-2-Place-0'trigno='2'>Massachusetts</role></role> and <trigger id='trigger-3'>ordered</trigger> <role id='role-3-Participant-1'trigno='3'><role id='role-3-Participant-1'trigno='3'>federal</role></role> aid to supplement <role id='role-3-Topic-0'trigno='3'>state</role> and local response efforts. PREVIOUSLY REPORTED Details on the bombs--<role id='role-4-Communicator-0'trigno='4'>Investigators</role> <trigger id='trigger-4'>say</trigger> the dual <role id='role-5-ExplosiveDevice-0'trigno='5'><role id='role-4-Topic-0'trigno='4'>bombs</role></role>, which <trigger id='trigger-5'>exploded</trigger> 12 seconds apart Monday, were designed to deliver vicious suffering. Photos: After the explosion: Moment-by-moment Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Witness Ben Thorndike saw Monday's blast at the Boston Marathon from a nearby office building. His sequence of photos, seven shown here, show the moments immediately after the blast. Hide Caption 1 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 2 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 3 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 4 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 5 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 6 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–The image ends the sequence of photos showing the moments immediately after the blast. Hide Caption 7 of 7 JUST WATCHED Several members of same family wounded Replay More Videos. . . MUST WATCH Several members of same family wounded 04: 43 JUST WATCHED Doctor: Instincts kicked in after blast Replay More Videos. . . MUST WATCH Doctor: Instincts kicked in after blast 09: 06 JUST WATCHED Expert: Cooker bomb easy to make Replay More Videos. . . MUST WATCH Expert: Cooker bomb easy to make 03: 40 JUST WATCHED Mailbox might have saved this man's life Replay More Videos. . . MUST WATCH Mailbox might have saved this man's life 03: 13--One was housed in a pressure cooker hidden inside a backpack, the FBI said. The device also had fragments that may have included nails, BBs and ball bearings, the agency said.--The second bomb was in a metal container, but it was unclear whether it was in a pressure cooker as well, the FBI said.--Photos obtained by CNN show the remains of a pressure cooker found at the scene, along with a shredded black backpack and what appear to be metal pellets or ball bearings.--They were sent to the FBI's national laboratory in Virginia, where technicians will try to reconstruct the devices.--In the past, the U. S. <role id='role-6-Participant-0'trigno='6'><role id='role-6-Participant-0'trigno='6'>government</role></role> has <trigger id='trigger-6'>warned</trigger> federal <role id='role-6-Participant-1'trigno='6'><role id='role-6-Participant-1'trigno='6'>agencies</role></role> that <role id='role-6-Topic-0'trigno='6'>terrorists</role> could turn pressure cookers into bombs by packing them with explosives and shrapnel, and detonating them with blasting caps.--Authorities sifted through thousands of pieces of evidence and a mass of digital photos and video clips. <role id='role-7-Participant-0'trigno='7'><role id='role-7-Participant-0'trigno='7'>They</role></role> have <trigger id='trigger-7'>pleaded</trigger> for the <role id='role-7-Participant-1'trigno='7'><role id='role-7-Participant-1'trigno='7'>public's</role></role> help in providing additional <role id='role-7-Topic-0'trigno='7'>leads</role> and <role id='role-7-Topic-1'trigno='7'>images</role>. The casualties The blasts left three people dead.--Martin Richard, an 8-year-old boy with a gap-tooth grin and bright eyes. He loved to run and play in his yard.--Krystle Campbell, a 29-year-old freckle-faced woman described as having"a heart of gold."--The third victim was Lingzu Lu, a graduate student at Boston University, who had moved to the city last fall, making friends and soaking up new experiences.--Of the approximately 178 <role id='role-8-Victim-0'trigno='8'>people</role> <trigger id='trigger-8'>injured</trigger>, <role id='role-8-Victim-1'trigno='8'>66</role> remain in area hospitals, according to the latest CNN tally. Thirteen of those are still in critical condition, hospital officials said.-Martin's mother and sister are among the wounded. His <role id='role-9-Patient-0'trigno='9'>mother</role> underwent <trigger id='trigger-9'>surgery</trigger> for a brain injury, and his 6-year-old sister lost her leg. The injuries--<role id='role-9-Treater-0'trigno='9'>Doctors</role> say dozens of victims suffered injuries to their legs that involve blood vessels, bone and tissue.--The <trigger id='trigger-10'>bombings</trigger> resulted in at least 13 <trigger id='trigger-11'>amputations</trigger> and left <role id='role-11-Treater-0'trigno='11'>doctors</role> picking ball bearings out of <role id='role-11-Patient-0'trigno='11'><role id='role-10-Target-0'trigno='10'>victims</role></role> in the emergency room, a terrorism expert briefed on the investigation said.--Dr. George Velmahos, head of trauma care at Massachusetts General Hospital, said his team found"numerous"metal pellets and nails inside patients'bodies."There are people who have 10, 20, 30, 40 of them in their body, or more,"Velmahos said.--Dr. <role id='role-12-Communicator-0'trigno='12'>Ron Walls</role> also <trigger id='trigger-12'>said</trigger> one <role id='role-12-Topic-0'trigno='12'>patient</role> had more than 12 carpenter-type nails."There is no question some of these objects were implanted in the device for the purpose of being exploded forward,"he said. Terror group links--While the clues moved the investigation forward, it is still unclear whether the attack was an act of domestic or foreign terrorism.--No connection has been made to any terrorist group or individual.--President <role id='role-13-Communicator-0'trigno='13'>Barack Obama</role> <trigger id='trigger-13'>described</trigger> the bombings as an act of terrorism, but said it is unclear whether they were the work of a group or"a malevolent individual."--The Pakistani <role id='role-14-Communicator-0'trigno='14'>Taliban</role> has <trigger id='trigger-14'>said</trigger> it was not involved in the attack.--Authorities don't have a sense of what the motive is, an official said.--The <role id='role-15-Participant-0'trigno='15'><role id='role-15-Participant-0'trigno='15'>FBI</role></role> <trigger id='trigger-15'>asked</trigger> the <role id='role-15-Participant-1'trigno='15'><role id='role-15-Participant-1'trigno='15'>public</role></role> to report anyone who talked about targeting the marathon or showed interest in <role id='role-15-Topic-0'trigno='15'>explosives</role>. The agency urged anyone who might have heard explosions in remote areas--possibly by someone testing a bomb--or seen someone carrying"an unusually heavy, dark-colored bag"around the time of the attack to come forward.'Possible'suspects Three days later, authorities have yet to make an arrest, but have made"significant progress,"a law enforcement official said.--Investigators have pinpointed two men of"high interest"as possible suspects after they appeared in images near the finish line moments before the blasts, a law enforcement official said.--One of the men is seen carrying a black backpack.--Authorities had not yet named the two, but their photographs have been distributed to law enforcement, a source said.--Earlier Wednesday, two sources with knowledge of the investigation identified a man as a possible suspect in the attack, but did not name him.--Seen on a video, the man wore a white baseball cap. One of the sources added that the cap was on backwards and the man was also wearing a light-colored hooded sweatshirt and a black jacket.--It was not immediately clear if he is one of those alluded to in the photographs distributed to law enforcement officials.--Investigators are closer to cracking the case"every hour,"Massachusetts Gov. Deval Patrick said. He urged patience with the probe to allow investigators space to do their job.--"I wish they had nailed the perpetrator within minutes of this catastrophe, but I understand from experience it's going to take some time,"he said. The Investigation--Significant progress has been made in the <trigger id='trigger-16'>investigation</trigger>, but there has been no arrest, the FBI told CNN.--After sources told CNN on Wednesday that an <trigger id='trigger-17'>arrest</trigger> had been made, sources with the Department of Justice and <role id='role-17-Jailer-0'trigno='17'>Boston Police Department</role> each said that no arrest had been made.--A source with Boston law enforcement said,"We got him,"but would not clarify whether that meant an identification had been made or an arrest carried out.--Some federal sources said that it would be going too far to say even that an identification had been made, but several sources in Boston disputed that, saying a clear identification had been made.--<role id='role-18-Investigator-0'trigno='18'>Investigators</role> believe they have <trigger id='trigger-18'>identified</trigger> a <role id='role-18-Defendant-0'trigno='18'>suspect</role> in the marathon bombings, a source who has been briefed on the investigation told CNN's John King. The possible breakthrough came from an analysis of video from a Lord and Taylor department store near the site of the second blast, and video from a Boston TV station helped as well, the official said.--As they scramble to search for suspects, authorities are processing"the most complex crime scene that we have dealt with in the history of our department,"said Ed Davis, the Boston police commissioner.--Forensic specialists and dogs trained to detect explosive devices and their residue were at the scene of the blasts. A command post has been created, with 1, 000 officers conducting interviews and gathering details.--Authorities have received 2, 000 tips from around the world, said Richard DesLauriers, the special agent in charge of the FBI's Boston office."Someone knows who did this,"he said. Security elsewhere--Cities have stepped up security after the attacks, including Washington, New York, Miami, Chicago, Atlanta and Los Angeles.--British police said they are reviewing the security plan for the London Marathon scheduled for Sunday. The marathon will observe 30 seconds of silence and is urging runners to wear a black ribbon to mark the Boston tragedy. Reaction--"Boston is not going to be intimidated by this,"said Secretary of State John Kerry, a former U. S. senator from Massachusetts."But we are going to find out who did this. The police work being done is extraordinary. The FBI is remarkable. There is a great deal of forensic evidence. We are hopeful we can bring people to justice.""The Islamic Republic condemns killing of innocent people in U. S. Boston, Pakistan, Afghanistan, Iraq and Syria in equal measure,"Iran's Ayatollah <role id='role-19-Communicator-0'trigno='19'>Ali Khamenei</role> <trigger id='trigger-19'>said</trigger> Wednesday, according to a <role id='role-19-Topic-0'trigno='19'>report</role> on state-run <role id='role-19-Recipient-0'trigno='19'>Press TV</role>. Tributes--Obama and first lady Michelle Obama will travel to Boston on Thursday for an 11 a. m. interfaith service dedicated to the victims. The president is expected to meet with the families of those wounded or killed.--Obama declared an emergency in Massachusetts and ordered federal aid to supplement state and local response efforts. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "backpack_ied_18-E2", "text": "killed", "offset": 2, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "backpack_ied_18-T2", "offset": 4, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "backpack_ied_18-E3", "text": "wounded", "offset": 6, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "others", "entity_id": "backpack_ied_18-T3", "offset": 9, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E11", "text": "declared", "offset": 32, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Obama", "entity_id": "backpack_ied_18-T6", "offset": 31, "length": 1}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": [{"text": "Massachusetts", "entity_id": "backpack_ied_18-T7", "offset": 36, "length": 1}]}]}, {"event_id": "backpack_ied_18-E12", "text": "ordered", "offset": 38, "length": 1, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Obama", "entity_id": "backpack_ied_18-T6", "offset": 31, "length": 1}, {"text": "federal", "entity_id": "backpack_ied_18-T8", "offset": 39, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Obama", "entity_id": "backpack_ied_18-T6", "offset": 31, "length": 1}, {"text": "federal", "entity_id": "backpack_ied_18-T8", "offset": 39, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "state", "entity_id": "backpack_ied_18-T9", "offset": 43, "length": 1}]}, {"role": "Place", "tokens": [{"text": "Massachusetts", "entity_id": "backpack_ied_18-T7", "offset": 36, "length": 1}]}]}, {"event_id": "backpack_ied_18-E13", "text": "say", "offset": 57, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Investigators", "entity_id": "backpack_ied_18-T11", "offset": 56, "length": 1}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "bombs", "entity_id": "backpack_ied_18-T12", "offset": 60, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E1", "text": "exploded", "offset": 63, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": [{"text": "bombs", "entity_id": "backpack_ied_18-T12", "offset": 60, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E14", "text": "warned", "offset": 563, "length": 1, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "government", "entity_id": "backpack_ied_18-T47", "offset": 561, "length": 1}, {"text": "agencies", "entity_id": "backpack_ied_18-T48", "offset": 565, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "government", "entity_id": "backpack_ied_18-T47", "offset": 561, "length": 1}, {"text": "agencies", "entity_id": "backpack_ied_18-T48", "offset": 565, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "terrorists", "entity_id": "backpack_ied_18-T49", "offset": 567, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E15", "text": "pleaded", "offset": 610, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "They", "entity_id": "backpack_ied_18-T57", "offset": 608, "length": 1}, {"text": "public's", "entity_id": "backpack_ied_18-T309", "offset": 613, "length": 3}]}, {"role": "Participant", "tokens": [{"text": "They", "entity_id": "backpack_ied_18-T57", "offset": 608, "length": 1}, {"text": "public's", "entity_id": "backpack_ied_18-T309", "offset": 613, "length": 3}]}, {"role": "Topic", "tokens": [{"text": "leads", "entity_id": "backpack_ied_18-T308", "offset": 620, "length": 1}, {"text": "images", "entity_id": "backpack_ied_18-T307", "offset": 622, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E4", "text": "injured", "offset": 726, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "backpack_ied_18-T74", "offset": 725, "length": 1}, {"text": "66", "entity_id": "backpack_ied_18-T75", "offset": 728, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E5", "text": "surgery", "offset": 769, "length": 1, "template": "[Treater] treater treated [Patient] patient for [MedicalIssue] medical issue with [Instrument] means at [Place] place", "role_text_map": [{"role": "Treater", "tokens": [{"text": "Doctors", "entity_id": "backpack_ied_18-T92", "offset": 790, "length": 1}]}, {"role": "Patient", "tokens": [{"text": "mother", "entity_id": "backpack_ied_18-T88", "offset": 767, "length": 1}]}, {"role": "MedicalIssue", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E7", "text": "bombings", "offset": 811, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "victims", "entity_id": "backpack_ied_18-T96", "offset": 826, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E6", "text": "amputations", "offset": 817, "length": 1, "template": "[Treater] treater treated [Patient] patient for [MedicalIssue] medical issue with [Instrument] means at [Place] place", "role_text_map": [{"role": "Treater", "tokens": [{"text": "doctors", "entity_id": "backpack_ied_18-T95", "offset": 820, "length": 1}]}, {"role": "Patient", "tokens": [{"text": "victims", "entity_id": "backpack_ied_18-T96", "offset": 826, "length": 1}]}, {"role": "MedicalIssue", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E16", "text": "said", "offset": 904, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Ron Walls", "entity_id": "backpack_ied_18-T112", "offset": 901, "length": 2}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "patient", "entity_id": "backpack_ied_18-T113", "offset": 906, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E17", "text": "described", "offset": 987, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Barack Obama", "entity_id": "backpack_ied_18-T120", "offset": 985, "length": 2}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E18", "text": "said", "offset": 1021, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Taliban", "entity_id": "backpack_ied_18-T124", "offset": 1019, "length": 1}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E19", "text": "asked", "offset": 1051, "length": 1, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "FBI", "entity_id": "backpack_ied_18-T128", "offset": 1050, "length": 1}, {"text": "public", "entity_id": "backpack_ied_18-T129", "offset": 1053, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "FBI", "entity_id": "backpack_ied_18-T128", "offset": 1050, "length": 1}, {"text": "public", "entity_id": "backpack_ied_18-T129", "offset": 1053, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "explosives", "entity_id": "backpack_ied_18-T132", "offset": 1067, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E8", "text": "investigation", "offset": 1383, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "tokens": []}, {"role": "Defendant", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E9", "text": "arrest", "offset": 1406, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": [{"text": "Boston Police Department", "entity_id": "backpack_ied_18-T186", "offset": 1418, "length": 3}]}, {"role": "Detainee", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E10", "text": "identified", "offset": 1506, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "tokens": [{"text": "Investigators", "entity_id": "backpack_ied_18-T197", "offset": 1502, "length": 1}]}, {"role": "Defendant", "tokens": [{"text": "suspect", "entity_id": "backpack_ied_18-T199", "offset": 1508, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "backpack_ied_18-E20", "text": "said", "offset": 1867, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Ali Khamenei", "entity_id": "backpack_ied_18-T275", "offset": 1865, "length": 2}]}, {"role": "Recipient", "tokens": [{"text": "Press TV", "entity_id": "backpack_ied_18-T277", "offset": 1878, "length": 2}]}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": [{"text": "report", "entity_id": "backpack_ied_18-T317", "offset": 1873, "length": 1}]}, {"role": "Place", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>