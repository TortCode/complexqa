<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Despite President Barack Obama’s recent call to reduce the United States’reliance on drones, they will likely remain his administration’s weapon of choice. Whereas President George W. Bush oversaw fewer than 50 drone strikes during his tenure, Obama has signed off on over 400 of them in the last four years, making the program the centerpiece of U. S. counterterrorism strategy. The drones have done their job remarkably well: by killing key leaders and denying terrorists sanctuaries in Pakistan, Yemen, and, to a lesser degree, Somalia, drones have devastated al Qaeda and associated anti-American militant groups. And they have done so at little financial cost, at no risk to U. S. forces, and with fewer civilian casualties than many alternative methods would have caused. Critics, however, remain skeptical. They claim that drones <trigger id='trigger-0'>kill</trigger> thousands of innocent <role id='role-0-Victim-0'trigno='0'>civilians</role>, alienate allied governments, anger foreign publics, illegally target Americans, and set a dangerous precedent that irresponsible governments will abuse. Some of these criticisms are valid; others, less so. In the end, drone strikes remain a necessary instrument of counterterrorism. The United States simply cannot tolerate terrorist safe havens in remote parts of Pakistan and elsewhere, and drones offer a comparatively low-risk way of targeting these areas while minimizing collateral damage. So drone warfare is here to stay, and it is likely to expand in the years to come as other countries’capabilities catch up with those of the United States. But Washington must continue to improve its drone policy, spelling out clearer rules for extrajudicial and extraterritorial killings so that tyrannical regimes will have a harder time pointing to the U. S. drone program to justify attacks against political opponents. At the same time, even as it solidifies the drone program, Washington must remain mindful of the built-in limits of low-cost, unmanned interventions, since the very convenience of drone warfare risks dragging the United States into conflicts it could otherwise avoid. NOBODY DOES IT BETTER The Obama administration relies on drones for one simple reason: they work. According to data compiled by the New America Foundation, since Obama has been in the White House, <role id='role-1-Killer-0'trigno='1'>U. S</role>. drones have <trigger id='trigger-1'>killed</trigger> an estimated 3, 300 al Qaeda, Taliban, and other jihadist <role id='role-1-Victim-0'trigno='1'>operatives</role> in <role id='role-1-Place-0'trigno='1'>Pakistan</role> and <role id='role-1-Place-1'trigno='1'>Yemen</role>. That number includes over 50 senior leaders of al Qaeda and the Taliban — top figures who are not easily replaced. In 2010, Osama bin Laden warned his chief aide, <role id='role-2-Victim-0'trigno='2'>Atiyah Abd al-Rahman</role>, who was later <trigger id='trigger-2'>killed</trigger> by a drone strike in the Waziristan region of <role id='role-2-Place-0'trigno='2'>Pakistan</role> in 2011, that when experienced leaders are eliminated, the result is “the rise of lower leaders who are not as experienced as the former leaders” and who are prone to errors and miscalculations. And drones also hurt terrorist organizations when they eliminate operatives who are lower down on the food chain but who boast special skills: passport forgers, bomb makers, recruiters, and fundraisers. Drones have also undercut terrorists’ability to communicate and to <trigger id='trigger-3'>train</trigger> new <role id='role-3-Learner-0'trigno='3'>recruits</role>. In order to avoid attracting drones, al Qaeda and Taliban operatives try to avoid using electronic devices or gathering in large numbers. A tip sheet found among jihadists in Mali advised militants to “maintain complete silence of all wireless contacts” and “avoid gathering in open areas.” Leaders, however, cannot give orders when they are incommunicado, and training on a large scale is nearly impossible when a drone strike could wipe out an entire group of new recruits. Drones have turned al Qaeda’s command and training structures into a liability, forcing the group to choose between having no leaders and risking dead leaders. Critics of drone strikes often fail to take into account the fact that the alternatives are either too risky or unrealistic. To be sure, in an ideal world, militants would be captured alive, allowing authorities to question them and search their compounds for useful information. Raids, arrests, and interrogations can produce vital intelligence and can be less controversial than lethal operations. That is why they should be, and indeed already are, used in stable countries where the United States enjoys the support of the host government. But in war zones or unstable countries, such as Pakistan, Yemen, and Somalia, arresting militants is highly dangerous and, even if successful, often inefficient. In those three countries, the government exerts little or no control over remote areas, which means that it is highly dangerous to go after militants hiding out there. Worse yet, in Pakistan and Yemen, the governments have at times cooperated with militants. If the United States regularly sent in special operations forces to hunt down terrorists there, sympathetic officials could easily tip off the jihadists, likely leading to firefights, U. S. casualties, and possibly the deaths of the suspects and innocent civilians. Of course, it was a Navy SEAL team and not a drone strike that finally got bin Laden, but in many cases in which the United States needs to capture or eliminate an enemy, raids are too risky and costly. And even if a raid results in a successful capture, it begets another problem: what to do with the detainee. Prosecuting detainees in a federal or military court is difficult because often the intelligence against terrorists is inadmissible or using it risks jeopardizing sources and methods. And given the fact that the United States is trying to close, rather than expand, the detention facility at Guantánamo Bay, Cuba, it has become much harder to justify holding suspects indefinitely. It has become more politically palatable for the United States to kill rather than detain suspected terrorists. Furthermore, although a drone strike may violate the local state’s sovereignty, it does so to a lesser degree than would putting U. S. boots on the ground or conducting a large-scale air campaign. And compared with a 500-pound bomb dropped from an F-16, the grenadelike warheads carried by most drones create smaller, more precise blast zones that decrease the risk of unexpected structural damage and casualties. Even more important, drones, unlike traditional airplanes, can loiter above a target for hours, waiting for the ideal moment to strike and thus reducing the odds that civilians will be caught in the kill zone. Finally, using drones is also far less bloody than asking allies to hunt down terrorists on the United States’behalf. The Pakistani and Yemeni militaries, for example, are known to regularly torture and execute detainees, and they often indiscriminately bomb civilian areas or use scorched-earth tactics against militant groups. Some critics of the drone program, such as Ben Emmerson, the UN’s special rapporteur on the promotion and protection of human rights and fundamental freedoms while countering terrorism, have questioned the lethal approach, arguing for more focus on the factors that might contribute to extremism and terrorism, such as poverty, unemployment, and authoritarianism. Such a strategy is appealing in principle, but it is far from clear how Washington could execute it. Individuals join anti-American terrorist groups for many reasons, ranging from outrage over U. S. support for Israel to anger at their own government’s cooperation with the United States. Some people simply join up because their neighbors are doing so. Slashing unemployment in Yemen, bringing democracy to Saudi Arabia, and building a functioning government in Somalia are laudable goals, but they are not politically or financially possible for the United States, and even if achieved, they still might not reduce the allure of jihad. In some cases, the most sensible alternative to carrying out drone strikes is to do nothing at all. At times, that is the right option: if militants abroad pose little threat or if the risk of killing civilians, delegitimizing allies, or establishing the wrong precedent is too high. But sometimes imminent and intolerable threats do arise and drone strikes are the best way to eliminate them. THE NUMBERS GAME Despite the obvious benefits of using drones and the problems associated with the alternatives, numerous critics argue that drones still have too many disadvantages. First among them is an unacceptably high level of civilian casualties. Admittedly, drones have <trigger id='trigger-4'>killed</trigger> <role id='role-4-Victim-0'trigno='4'>innocents</role>. But the real debate is over how many and whether alternative approaches are any better. The Bureau of Investigative Journalism reports that in 2011, <role id='role-5-Instrument-0'trigno='5'>drone</role> <trigger id='trigger-5'>strikes</trigger> <trigger id='trigger-6'>killed</trigger> as many as 146 <role id='role-6-Victim-0'trigno='6'>noncombatants</role>, including as many as 9 <role id='role-6-Victim-1'trigno='6'>children</role>. Columbia Law School’s Human Rights Clinic also cites high numbers of civilian deaths, as does the Pakistani organization Pakistan Body Count. Peter Bergen of the New America Foundation oversees a database of drone casualties culled from U. S. sources and international media reports. He estimates that between 150 and 500 <role id='role-7-Victim-0'trigno='7'>civilians</role> have been <trigger id='trigger-7'>killed</trigger> by drones during Obama’s administration. U. S. officials, meanwhile, maintain that drone strikes have killed almost no civilians. In June 2011, John Brennan, then Obama’s top counterterrorism adviser, even contended that U. S. drone strikes had killed no civilians in the previous year. But these claims are based on the fact that the U. S. government assumes that all military-age males in the blast area of a drone strike are combatants — unless it can determine after the fact that they were innocent (and such intelligence gathering is not a priority). The United States has recently taken to launching “signature strikes,” which target not specific individuals but instead groups engaged in suspicious activities. This approach makes it even more difficult to distinguish between combatants and civilians and verify body counts of each. Still, as one U. S. official told The New York Times last year, “Al Qaeda is an insular, paranoid organization — innocent neighbors don’t hitchhike rides in the back of trucks headed for the border with guns and bombs.” Of course, not everyone accepts this reasoning. Zeeshan-ul-hassan Usmani, who runs Pakistan Body Count, says that “neither [the United States] nor Pakistan releases any detailed information about the victims. . . so [although the United States] likes to call everybody Taliban, I call everybody civilians.” The truth is that all the public numbers are unreliable. Who constitutes a civilian is often unclear; when trying to <trigger id='trigger-8'>kill</trigger> the Pakistani Taliban leader <role id='role-8-Victim-0'trigno='8'>Baitullah Mehsud</role>, for example, the <role id='role-9-Killer-0'trigno='9'>United States</role> also <trigger id='trigger-9'>killed</trigger> his <role id='role-9-Victim-0'trigno='9'>doctor</role>. The doctor was not targeting U. S. or allied forces, but he was aiding a known terrorist leader. In addition, most strikes are carried out in such remote locations that it is nearly impossible for independent sources to verify who was killed. In Pakistan, for example, the overwhelming majority of drone killings occur in tribal areas that lie outside the government’s control and are prohibitively dangerous for Westerners and independent local journalists to enter. Thus, although the New America Foundation has come under fire for relying heavily on unverifiable information provided by anonymous U. S. officials, reports from local Pakistani organizations, and the Western organizations that rely on them, are no better: their numbers are frequently doctored by the Pakistani government or by militant groups. After a strike in Pakistan, militants often cordon off the area, remove their dead, and admit only local reporters sympathetic to their cause or decide on a body count themselves. The U. S. media often then draw on such faulty reporting to give the illusion of having used multiple sources. As a result, statistics on civilians killed by drones are often inflated. One of the few truly independent on-the-ground reporting efforts, conducted by the Associated Press last year, concluded that the strikes “are killing far fewer civilians than many in [Pakistan] are led to believe.” But even the most unfavorable estimates of drone casualties reveal that the ratio of civilian to militant deaths — about one to three, according to the Bureau of Investigative Journalism — is lower than it would be for other forms of strikes. Bombings by F-16s or Tomahawk cruise missile salvos, for example, pack a much more deadly payload. In December 2009, the <role id='role-10-Attacker-0'trigno='10'>United States</role> <trigger id='trigger-10'>fired</trigger> <role id='role-10-Instrument-0'trigno='10'>Tomahawks</role> at a suspected terrorist training camp in <role id='role-11-Place-0'trigno='11'>Yemen</role>, and over 30 <role id='role-11-Victim-0'trigno='11'>people</role> were <trigger id='trigger-11'>killed</trigger> in the blast, most of them women and children. At the time, the Yemeni regime refused to allow the use of drones, but had this not been the case, a drone’s real-time surveillance would probably have spotted the large number of women and children, and the attack would have been aborted. Even if the strike had gone forward for some reason, the drone’s far smaller warhead would have killed fewer innocents. Civilian deaths are tragic and pose political problems. But the data show that drones are more discriminate than other types of force. FOREIGN FRIENDS It is also telling that drones have earned the backing, albeit secret, of foreign governments. In order to maintain popular support, politicians in Pakistan and Yemen routinely rail against the U. S. drone campaign. In reality, however, the governments of both countries have supported it. During the Bush and Obama administrations, Pakistan has even periodically hosted U. S. drone facilities and has been told about strikes in advance. Pervez Musharraf, president of Pakistan until 2008, was not worried about the drone program’s negative publicity: “In Pakistan, things fall out of the sky all the time,” he reportedly remarked. Yemen’s former president, Ali Abdullah Saleh, also at times allowed drone strikes in his country and even covered for them by telling the public that they were conducted by the Yemeni air force. When the United States’involvement was leaked in 2002, however, relations between the two countries soured. Still, Saleh later let the drone program resume in Yemen, and his replacement, Abdu Rabbu Mansour Hadi, has publicly praised drones, saying that “they pinpoint the target and have zero margin of error, if you know what target you’re aiming at.” As officials in both Pakistan and Yemen realize, U. S. drone strikes help their governments by targeting common enemies. A memo released by the antisecrecy website WikiLeaks revealed that Pakistan’s army chief, Ashfaq Parvez kayani, privately asked U. S. military leaders in 2008 for “continuous Predator coverage” over antigovernment militants, and the journalist Mark Mazzetti has reported that the United States has conducted “goodwill kills” against Pakistani militants who threatened Pakistan far more than the United States. Thus, in private, Pakistan supports the drone program. As then Prime Minister Yousaf Raza Gilani told Anne Patterson, then the U. S. ambassador to Pakistan, in 2008, “We’ll protest [against the drone program] in the National Assembly and then ignore it.” Still, Pakistan is reluctant to make its approval public. First of all, the country’s inability to fight terrorists on its own soil is a humiliation for Pakistan’s politically powerful armed forces and intelligence service. In addition, although drones kill some of the government’s enemies, they have also targeted pro-government groups that are hostile to the United States, such as the Haqqani network and the Taliban, which Pakistan has supported since its birth in the early 1990s. Even more important, the Pakistani public is vehemently opposed to U. S. drone strikes. A 2012 poll found that 74 percent of Pakistanis viewed the United States as their enemy, likely in part because of the ongoing drone campaign. Similarly, in Yemen, as the scholar Gregory Johnsen has pointed out, drone strikes can win the enmity of entire tribes. This has led critics to argue that the drone program is shortsighted: that it kills today’s enemies but creates tomorrow’s in the process. Such concerns are valid, but the level of local anger over drones is often lower than commonly portrayed. Many surveys of public opinion related to drones are conducted by anti-drone organizations, which results in biased samples. Other surveys exclude those who are unaware of the drone program and thus overstate the importance of those who are angered by it. In addition, many Pakistanis do not realize that the drones often target the very militants who are wreaking havoc on their country. And for most Pakistanis and Yemenis, the most important problems they struggle with are corruption, weak representative institutions, and poor economic growth; the drone program is only a small part of their overall anger, most of which is directed toward their own governments. A poll conducted in 2007, well before the drone campaign had expanded to its current scope, found that only 15 percent of Pakistanis had a favorable opinion of the United States. It is hard to imagine that alternatives to drone strikes, such as seal team raids or cruise missile strikes, would make the United States more popular. THE HOME FRONT Still, public opposition is real, and there is growing concern about the drone strikes even in the United States. The program came under especially heavy criticism domestically in 2011, when <role id='role-12-Victim-0'trigno='12'>Anwar al-Awlaki</role>, a U. S. citizen born in New Mexico, was <trigger id='trigger-12'>killed</trigger> by a drone strike in <role id='role-12-Place-0'trigno='12'>Yemen</role>. There is no question that Awlaki was dangerous. Adept at interspersing Islamist rhetoric with pop-culture references, Awlaki had been described as a “pied piper for Western ears” : one admirer was Nidal Malik Hasan, the U. S. Army <role id='role-13-Killer-0'trigno='13'>officer</role> who <trigger id='trigger-13'>killed</trigger> 13 U. S. <role id='role-13-Victim-0'trigno='13'>soldiers</role> at Fort Hood, <role id='role-13-Place-0'trigno='13'>Texas</role>, in 2009. The Obama administration claims that Awlaki was actively involved in plots against the United States and that the strike against him was legal under the Authorization for the Use of Military Force (AUMF), which Congress passed three days after 9 / 11 and which gives the president broad authority to use force against terrorist groups linked to the 9 / 11 attacks. Yet with the war on terrorism almost 12 years old and bin Laden dead, critics, such as the Georgetown University law professor Rosa Brooks, have begun questioning whether the AUMF still justifies drone strikes today. As Brooks has argued, “Many of the groups now being identified as threats don’t fall clearly under the AUMF’s umbrella — and many don’t pose a significant danger to the United States.” As for the case of Awlaki, opponents of his killing have argued that he did not pose an imminent threat to the United States and that in keeping the evidence used to justify his assassination secret, the administration violated the constitutional guarantee of due process for U. S. citizens. As Ron Paul, then a Texas representative, pointed out during his presidential campaign, Awlaki was never charged with any crime. He added, “If the American people accept this blindly and casually, that we now have an accepted practice of the president assassinating people who he thinks are bad guys, I think it’s sad.” The administration contends that the discussions held within the executive branch and the extensive vetting of evidence constitute a form of due process. Meanwhile, as the legal scholar Benjamin Wittes has pointed out, both Congress and the federal courts have repeatedly reaffirmed the validity of the AUMF since 2001. The U. S. government argues that given how secretly terrorists operate, it is not always possible to use other means to stop an individual overseas from planning attacks on U. S. forces or allies. As a result, the imminence of a threat should be assessed based on the individual’s propensity for violence and the likelihood of being able to stop him in the future. Wittes compares the decision-making process to that used in hostage situations, when police are not required to ask a judge for authority to kill a hostage taker or refrain from taking a clear shot if they have one. Perhaps most important, the White House has claimed only a very limited right to conduct drone strikes against U. S. citizens. The administration has asserted the authority to kill only senior al Qaeda leaders who cannot be captured, not any American member of al Qaeda. Indeed, it appears that Awlaki is the only U. S. citizen who has been deliberately killed by a drone.? FOLLOW THE LEADER The fact remains that by using drones so much, Washington risks setting a troublesome precedent with regard to extrajudicial and extraterritorial killings. Zeke Johnson of Amnesty International contends that “when the U. S. government violates international law, that sets a precedent and provides an excuse for the rest of the world to do the same.” And it is alarming to think what leaders such as Syrian President Bashar al-Assad, who has used deadly force against peaceful pro-democracy demonstrators he has deemed terrorists, would do with drones of their own. Similarly, Iran could mockingly cite the U. S. precedent to justify sending drones after rebels in Syria. Even Brennan has conceded that the administration is “establishing precedents that other nations may follow.” Controlling the spread of drone technology will prove impossible; that horse left the barn years ago. Drones are highly capable weapons that are easy to produce, and so there is no chance that Washington can stop other militaries from acquiring and using them. Nearly 90 other countries already have surveillance drones in their arsenals, and China is producing several inexpensive models for export. Armed drones are more difficult to produce and deploy, but they, too, will likely spread rapidly. Beijing even recently announced (although later denied) that it had considered sending a drone to Myanmar (also called Burma) to kill a wanted drug trafficker hiding there. The spread of drones cannot be stopped, but the United States can still influence how they are used. The coming proliferation means that Washington needs to set forth a clear policy now on extrajudicial and extraterritorial killings of terrorists — and stick to it. Fortunately, Obama has begun to discuss what constitutes a legitimate drone strike. But the definition remains murky, and this murkiness will undermine the president’s ability to denounce other countries’behavior should they start using drones or other means to hunt down enemies. By keeping its policy secret, Washington also makes it easier for critics to claim that the United States is wantonly slaughtering innocents. More transparency would make it harder for countries such as Pakistan to make outlandish claims about what the United States is doing. Drones actually protect many Pakistanis, and Washington should emphasize this fact. By being more open, the administration could also show that it carefully considers the law and the risks to civilians before ordering a strike. Washington needs to be especially open about its use of signature strikes. According to the Obama administration, signature strikes have eliminated not only low-level al Qaeda and Taliban figures but also a surprising number of higher-level officials whose presence at the scenes of the strikes was unexpected. Signature strikes are in keeping with traditional military practice; for the most part, U. S. soldiers have been trained to strike enemies at large, such as German soldiers or Vietcong guerrillas, and not specific individuals. The rise of unconventional warfare, however, has made this usual strategy more difficult because the battlefield is no longer clearly defined and enemies no longer wear identifiable uniforms, making combatants harder to distinguish from civilians. In the case of drones, where there is little on-the-ground knowledge of who is who, signature strikes raise legitimate concerns, especially because the Obama administration has not made clear what its rules and procedures for such strikes are. Washington should exercise particular care with regard to signature strikes because mistakes risk tarnishing the entire drone program. In the absence of other information, the argument that drones are wantonly killing innocents is gaining traction in the United States and abroad. More transparency could help calm these fears that Washington is acting recklessly. The U. S. government also needs to guard against another kind of danger: that the relative ease of using drones will make U. S. intervention abroad too common. The scholars Daniel Brunstetter and Megan Braun have argued that drones provide “a way to avoid deploying troops or conducting an intensive bombing campaign” and that this “may encourage countries to act on just cause with an ease that is potentially worrisome.” Although al Qaeda remains a threat, it has been substantially defanged since 9 / 11, thanks to the destruction of its haven in Afghanistan and effective global police, intelligence, and drone campaigns against its cells. In addition, the U. S. government needs to remember that many of the world’s jihadist organizations are focused first and foremost on local regimes and that although the United States has an interest in helping its allies fight extremists, Washington cannot and should not directly involve itself in every fight. The Obama administration should spell out those cases in which the AUMF does not apply and recognize the risks of carrying out so-called goodwill kills on behalf of foreign governments. Helping French and Malian forces defeat jihadists in Mali by providing logistical support, for example, is smart policy, but sending U. S. drones there is not. In places where terrorists are actively plotting against the United States, however, drones give Washington the ability to limit its military commitments abroad while keeping Americans safe. Afghanistan, for example, could again become a Taliban-run haven for terrorists after U. S. forces depart next year. Drones can greatly reduce the risk of this happening. Hovering in the skies above, they can keep Taliban leaders on the run and hinder al Qaeda’s ability to plot another 9 / 11. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "wiki_drone_strikes_2_news_4-E1", "text": "kill", "offset": 162, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "civilians", "entity_id": "wiki_drone_strikes_2_news_4-T33", "offset": 166, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E2", "text": "killed", "offset": 421, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "operatives", "entity_id": "wiki_drone_strikes_2_news_4-T77", "offset": 435, "length": 1}]}, {"role": "Place", "tokens": [{"text": "Pakistan", "entity_id": "wiki_drone_strikes_2_news_4-T78", "offset": 437, "length": 1}, {"text": "Yemen", "entity_id": "wiki_drone_strikes_2_news_4-T79", "offset": 439, "length": 1}]}, {"role": "Killer", "tokens": [{"text": "U.S", "entity_id": "wiki_drone_strikes_2_news_4-T72", "offset": 415, "length": 3}]}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E3", "text": "killed", "offset": 483, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Atiyah Abd al-Rahman", "entity_id": "wiki_drone_strikes_2_news_4-T88", "offset": 474, "length": 5}]}, {"role": "Place", "tokens": [{"text": "Pakistan", "entity_id": "wiki_drone_strikes_2_news_4-T93", "offset": 493, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E14", "text": "train", "offset": 578, "length": 1, "template": "[TeacherTrainer] taught [FieldOfKnowledge] field of knowledge to [Learner] using [Means] at [Institution] institution in [Place] place", "role_text_map": [{"role": "TeacherTrainer", "tokens": []}, {"role": "FieldOfKnowledge", "tokens": []}, {"role": "Learner", "tokens": [{"text": "recruits", "entity_id": "wiki_drone_strikes_2_news_4-T113", "offset": 580, "length": 1}]}, {"role": "Means", "tokens": []}, {"role": "Institution", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E4", "text": "killed", "offset": 1551, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "innocents", "entity_id": "wiki_drone_strikes_2_news_4-T247", "offset": 1552, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E6", "text": "strikes", "offset": 1581, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": [{"text": "drone", "entity_id": "wiki_drone_strikes_2_news_4-T249", "offset": 1580, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E5", "text": "killed", "offset": 1582, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "noncombatants", "entity_id": "wiki_drone_strikes_2_news_4-T250", "offset": 1587, "length": 1}, {"text": "children", "entity_id": "wiki_drone_strikes_2_news_4-T251", "offset": 1594, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E7", "text": "killed", "offset": 1656, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "civilians", "entity_id": "wiki_drone_strikes_2_news_4-T265", "offset": 1653, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E9", "text": "kill", "offset": 1950, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Baitullah Mehsud", "entity_id": "wiki_drone_strikes_2_news_4-T322", "offset": 1955, "length": 2}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E8", "text": "killed", "offset": 1965, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "doctor", "entity_id": "wiki_drone_strikes_2_news_4-T325", "offset": 1967, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": [{"text": "United States", "entity_id": "wiki_drone_strikes_2_news_4-T323", "offset": 1962, "length": 2}]}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E11", "text": "fired", "offset": 2300, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "United States", "entity_id": "wiki_drone_strikes_2_news_4-T381", "offset": 2298, "length": 2}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": [{"text": "Tomahawks", "entity_id": "wiki_drone_strikes_2_news_4-T382", "offset": 2301, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E10", "text": "killed", "offset": 2316, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_drone_strikes_2_news_4-T386", "offset": 2314, "length": 1}]}, {"role": "Place", "tokens": [{"text": "Yemen", "entity_id": "wiki_drone_strikes_2_news_4-T385", "offset": 2309, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E13", "text": "killed", "offset": 3257, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Anwar al-Awlaki", "entity_id": "wiki_drone_strikes_2_news_4-T559", "offset": 3240, "length": 4}]}, {"role": "Place", "tokens": [{"text": "Yemen", "entity_id": "wiki_drone_strikes_2_news_4-T564", "offset": 3263, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_drone_strikes_2_news_4-E12", "text": "killed", "offset": 3314, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "soldiers", "entity_id": "wiki_drone_strikes_2_news_4-T577", "offset": 3320, "length": 1}]}, {"role": "Place", "tokens": [{"text": "Texas", "entity_id": "wiki_drone_strikes_2_news_4-T579", "offset": 3325, "length": 1}]}, {"role": "Killer", "tokens": [{"text": "officer", "entity_id": "wiki_drone_strikes_2_news_4-T574", "offset": 3312, "length": 1}]}, {"role": "MedicalIssue", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>