<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      2 New Arrests in <role id='role-0-Place-0'trigno='0'>London</role> <trigger id='trigger-0'>Terror Attack</trigger> <role id='role-1-Place-0'trigno='1'>London</role> <role id='role-1-Jailer-0'trigno='1'>police</role> said Friday they have made two more <trigger id='trigger-1'>arrests</trigger> in connection with the <trigger id='trigger-2'>attack</trigger> near Parliament. Counter-terrorism commander Mark Rowley characterized the <trigger id='trigger-3'>arrests</trigger> as “significant,” though he did not provide any details. He said nine <role id='role-4-Detainee-0'trigno='4'>people</role> are currently <trigger id='trigger-4'>in custody</trigger> and one person has been released. Police officials identified the attacker who <trigger id='trigger-5'>killed</trigger> four <role id='role-5-Victim-0'trigno='5'>people</role> near <role id='role-5-Place-0'trigno='5'>Parliament</role> as <role id='role-6-Perpetrator-0'trigno='6'><role id='role-5-Killer-0'trigno='5'>Khalid Masood</role></role>, a Briton who converted to Islam and had a lengthy criminal record for weapons <trigger id='trigger-6'>possession</trigger> and other charges. Rowley said Masood’s birth name was Adrian Russell Ajao and appealed to the public for any information about him. A woman holds up a sign at a vigil for the victims of Wednesday's <trigger id='trigger-7'>attack</trigger>, at Trafalgar Square in London, March 23, 2017. The Islamic State group has claimed responsibility for an <trigger id='trigger-8'>attack</trigger> by a <role id='role-9-Injurer-0'trigno='9'><role id='role-8-Attacker-0'trigno='8'>man</role></role> who plowed an <role id='role-8-Instrument-0'trigno='8'>SUV</role> into <role id='role-8-Target-0'trigno='8'>pedestrians</role> and then <trigger id='trigger-9'>stabbed</trigger> a police <role id='role-9-Victim-0'trigno='9'>officer</role>. “We remain keen to hear from anyone who knew Khalid Masood well, understands who his associates were and can provide us with information about places he has recently visited,’’Rowley said. “There might be people out there who did have concerns about Masood but did not feel comfortable for whatever reason in passing those concerns to us.’’Islamic State said Masood, who was 52, was a “soldier” of the extremist group who responded to its call to attack civilians and the military in countries allied with the United States in battling IS. Masood had never been convicted of terrorist offenses, but British security officials said he had been investigated in the past “in relation to concerns about violent extremism.” Authorities say they believe he was acting alone Wednesday when <role id='role-11-Killer-0'trigno='11'><role id='role-10-Attacker-0'trigno='10'>he</role></role> <trigger id='trigger-10'>ran down</trigger> <role id='role-10-Target-0'trigno='10'>pedestrians</role> on <role id='role-10-Place-0'trigno='10'>Westminster Bridge</role>, a Thames River crossing leading to the Houses of Parliament, crashed his rented vehicle into a gate and <trigger id='trigger-11'>fatally stabbed</trigger> a <role id='role-11-Victim-0'trigno='11'>policeman</role> who tried to stop him. Armed police shot and killed Masood moments later. A <role id='role-12-Place-0'trigno='12'>property</role> in Birmingham, England, was <trigger id='trigger-12'>searched</trigger> by <role id='role-12-Investigator-0'trigno='12'>police</role> following Wednesday's <role id='role-13-Place-0'trigno='13'>London</role> <trigger id='trigger-13'>attack</trigger>, March 23, 2017. In the hours after Wednesday’s <trigger id='trigger-14'>attack</trigger> in the heart of <role id='role-14-Place-0'trigno='14'>London</role>, <role id='role-15-Attacker-0'trigno='15'>police</role> <trigger id='trigger-15'>conducted raids</trigger> around the <role id='role-15-Place-0'trigno='15'>country</role> in search of anyone who may have given support to Masood. Eight <role id='role-16-Detainee-0'trigno='16'>men</role> and <role id='role-16-Detainee-1'trigno='16'>women</role> were <trigger id='trigger-16'>arrested</trigger> Thursday on suspicion of planning terrorist acts. The dead assailant, who was older than most Islamist <role id='role-17-Attacker-0'trigno='17'>attackers</role> involved in recent spectacular <trigger id='trigger-17'>terror attacks</trigger> in <role id='role-17-Place-0'trigno='17'>Europe</role>, had been a teacher of English and was known as a fanatical bodybuilder. One of the <role id='role-18-Target-1'trigno='18'>civilians</role> who was <trigger id='trigger-18'>run down</trigger> on the bridge, a 75-year-old <role id='role-19-Victim-0'trigno='19'><role id='role-18-Target-0'trigno='18'>man</role></role>, <trigger id='trigger-19'>died</trigger> Thursday in a <role id='role-19-Place-0'trigno='19'>hospital</role>, raising the casualty toll to four victims and Masood. Although Islamic State claimed responsibility for the <trigger id='trigger-20'>attack</trigger>, a statement posted online did not implicate the group in the planning or execution of the attack. An Italian tourist who witnessed the carnage told reporters he saw Masood attack the policeman with two knives. “<role id='role-21-Injurer-0'trigno='21'>He</role> gave [the <role id='role-21-Victim-0'trigno='21'>officer</role>] around <trigger id='trigger-21'>10 stabs in the back</trigger>,” the visitor said. Valiant efforts to resuscitate Constable <role id='role-22-Victim-0'trigno='22'>Keith Palmer</role> at the scene <trigger id='trigger-22'>failed</trigger>. The 48-year-old officer was a 15-year police veteran. One American was among the <trigger id='trigger-23'>dead</trigger>-54-year-old <role id='role-23-Victim-0'trigno='23'>Kurt Cochran</role> of Utah, who was in London with his wife to celebrate their 25th wedding anniversary. His wife, <role id='role-24-Victim-1'trigno='24'>Melissa</role>, was among the 30 <role id='role-24-Victim-0'trigno='24'>people</role> <trigger id='trigger-24'>injured</trigger>. <role id='role-25-Injurer-0'trigno='25'>Masood</role>’s <role id='role-25-Instrument-0'trigno='25'>vehicle</role> <trigger id='trigger-25'>hit</trigger> the <role id='role-25-Victim-0'trigno='25'>Cochrans</role> as they crossed Westminster Bridge. The remaining victim of the <trigger id='trigger-26'>attack</trigger> was a British school administrator, <role id='role-26-Target-0'trigno='26'>Aysha Frade</role>, 43. Candles burn on Westminster Bridge the day after an <trigger id='trigger-27'>attack</trigger> in London, March 23, 2017. Mourners gathered in London’s Trafalgar Square Thursday evening, about one kilometer from the crime scene, for a candlelight vigil. The mayor of London, Sadiq Khan, told the crowd of thousands that” those trying to destroy our shared way of life will never succeed.” Khan said the vigil in the most recognizable public plaza in London was meant to honor the dead and injured, but also “to send a clear, clear message: Londoners will never be cowed by terrorism.” Rowley, head of counterterrorism efforts for London’s <role id='role-28-Jailer-0'trigno='28'>Metropolitan Police Service</role>, said the eight <role id='role-28-Detainee-0'trigno='28'>people</role> <trigger id='trigger-28'>arrested</trigger> Thursday were picked up during searches at six separate <role id='role-28-Place-0'trigno='28'>locations</role>, and that <trigger id='trigger-29'>investigations</trigger> were continuing in <role id='role-29-Place-0'trigno='29'>London</role>, <role id='role-29-Place-1'trigno='29'>Birmingham</role> and other <role id='role-29-Place-2'trigno='29'>parts</role> of England. He declined to say whether or how those <trigger id='trigger-30'>detained</trigger> were involved in Wednesday’s <trigger id='trigger-31'>attack</trigger>. “It is still our belief, which continues to be born out by our investigation, that this attacker acted alone and was inspired by international terrorism,” Rowley told reporters. Britain's Prime Minister <role id='role-32-Communicator-0'trigno='32'>Theresa May</role> <trigger id='trigger-32'>gives a media statement</trigger> outside 10 Downing street in London, March 22, 2017, following a terror <trigger id='trigger-33'>attack</trigger> in the <role id='role-33-Place-0'trigno='33'>Westminster</role> area of London earlier Wednesday. Prime Minister Theresa May struck a defiant tone in discussing the <trigger id='trigger-34'>attack</trigger> before Parliament Thursday, telling British lawmakers that what London experienced was “an attack on free people everywhere.” “Yesterday an <trigger id='trigger-35'>act of terrorism</trigger> tried to silence our democracy, but today we meet as normal, as generations have done before us and as future generations will continue to do, to deliver a simple message: We are not afraid and our resolve will never waver in the face of terrorism,” she said. May thanked Britain’s friends and allies around the world “who have made it clear that they stand with us at this time.” She said the victims include nationals of France, Romania, South Korea, Germany, Poland, Ireland, China, Italy and Greece, as well as the United States. The United Nations Security Council in New York, chaired by British Foreign Minister Boris Johnson, observed a moment of silence Thursday for the London victims. Tense <role id='role-36-Place-0'trigno='36'>London</role> Carries on After <role id='role-36-Attacker-0'trigno='36'>Islamic State</role> <trigger id='trigger-36'>Attack</trigger> Video size width x height pixels Tense <role id='role-37-Place-0'trigno='37'>London</role> Carries on After <role id='role-37-Attacker-0'trigno='37'>Islamic State</role> <trigger id='trigger-37'>Attack</trigger> Share this video 0: 02: 20 ▶ 0: 00: 00 / 0: 02: 20 ▶ ▶ Direct link 270p | 6. 3MB 360p | 9. 3MB 720p | 61. 6MB “You may know that today there are victims in London from 11 nations. Which goes to show that an <trigger id='trigger-38'>attack</trigger> on <role id='role-38-Place-0'trigno='38'>London</role> is an attack on the world,” Johnson said. “I can tell you from my talks here in the United States with the U. S. government and with partners from around the world that the world is uniting to defeat the <role id='role-39-Attacker-0'trigno='39'>people</role> who launched this <trigger id='trigger-39'>attack</trigger> and defeat their bankrupt and odious ideology.” In London, Parliament’s session began with a minute of silence Thursday. Police officers stood in silence nearby outside the headquarters of the city’s Metropolitan Police. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E1", "text": "Terror Attack", "offset": 5, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T42", "offset": 4, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E2", "text": "arrests", "offset": 16, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": [{"text": "police", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T40", "offset": 8, "length": 1}]}, {"role": "Detainee", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T228", "offset": 7, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E3", "text": "attack", "offset": 21, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E4", "text": "arrests", "offset": 33, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E5", "text": "in custody", "offset": 53, "length": 2, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "people", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T153", "offset": 50, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E6", "text": "killed", "offset": 68, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T131", "offset": 70, "length": 1}]}, {"role": "Place", "tokens": [{"text": "Parliament", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T149", "offset": 72, "length": 1}]}, {"role": "Killer", "tokens": [{"text": "Khalid Masood", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T150", "offset": 74, "length": 2}]}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E7", "text": "possession", "offset": 91, "length": 1, "template": "[Perpetrator] committed a crime against [Victim] at [Place] place", "role_text_map": [{"role": "Perpetrator", "tokens": [{"text": "Khalid Masood", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T150", "offset": 74, "length": 2}]}, {"role": "Victim", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E8", "text": "attack", "offset": 134, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E9", "text": "attack", "offset": 156, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "man", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T17", "offset": 159, "length": 1}]}, {"role": "Target", "tokens": [{"text": "pedestrians", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T251", "offset": 165, "length": 1}]}, {"role": "Instrument", "tokens": [{"text": "SUV", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T257", "offset": 163, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E10", "text": "stabbed", "offset": 168, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "officer", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T255", "offset": 171, "length": 1}]}, {"role": "Injurer", "tokens": [{"text": "man", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T17", "offset": 159, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E11", "text": "ran down", "offset": 320, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "he", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T107", "offset": 319, "length": 1}]}, {"role": "Target", "tokens": [{"text": "pedestrians", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T110", "offset": 322, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "Westminster Bridge", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T109", "offset": 324, "length": 2}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E12", "text": "fatally stabbed", "offset": 346, "length": 2, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "policeman", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T103", "offset": 349, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": [{"text": "he", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T107", "offset": 319, "length": 1}]}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E14", "text": "searched", "offset": 373, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "tokens": [{"text": "police", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T35", "offset": 375, "length": 1}]}, {"role": "Defendant", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "property", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T38", "offset": 366, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E13", "text": "attack", "offset": 381, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T36", "offset": 380, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E15", "text": "attack", "offset": 395, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T2", "offset": 400, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E16", "text": "conducted raids", "offset": 403, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "police", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T261", "offset": 402, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "country", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T222", "offset": 407, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E17", "text": "arrested", "offset": 425, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "men", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T225", "offset": 421, "length": 1}, {"text": "women", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T262", "offset": 423, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E18", "text": "terror attacks", "offset": 449, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "attackers", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T218", "offset": 444, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "Europe", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T90", "offset": 452, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E20", "text": "run down", "offset": 474, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "man", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T92", "offset": 486, "length": 1}, {"text": "civilians", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T79", "offset": 471, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E19", "text": "died", "offset": 488, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "man", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T92", "offset": 486, "length": 1}]}, {"role": "Place", "tokens": [{"text": "hospital", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T71", "offset": 492, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E21", "text": "attack", "offset": 511, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E22", "text": "10 stabs in the back", "offset": 558, "length": 5, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "officer", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T204", "offset": 555, "length": 1}]}, {"role": "Injurer", "tokens": [{"text": "He", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T203", "offset": 551, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E23", "text": "failed", "offset": 579, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Keith Palmer", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T206", "offset": 574, "length": 2}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E24", "text": "dead", "offset": 601, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Kurt Cochran", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T215", "offset": 608, "length": 2}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E25", "text": "injured", "offset": 637, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T141", "offset": 636, "length": 1}, {"text": "Melissa", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T171", "offset": 630, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E26", "text": "hit", "offset": 643, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "Cochrans", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T98", "offset": 645, "length": 1}]}, {"role": "Injurer", "tokens": [{"text": "Masood", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T130", "offset": 639, "length": 1}]}, {"role": "Instrument", "tokens": [{"text": "vehicle", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T4", "offset": 642, "length": 1}]}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E27", "text": "attack", "offset": 657, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "Aysha Frade", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T15", "offset": 664, "length": 2}]}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E28", "text": "attack", "offset": 678, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E29", "text": "arrested", "offset": 799, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": [{"text": "Metropolitan Police Service", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T235", "offset": 791, "length": 3}]}, {"role": "Detainee", "tokens": [{"text": "people", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T217", "offset": 798, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "locations", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T60", "offset": 809, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E30", "text": "investigations", "offset": 813, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "tokens": []}, {"role": "Defendant", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T61", "offset": 817, "length": 1}, {"text": "Birmingham", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T56", "offset": 819, "length": 1}, {"text": "parts", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T57", "offset": 822, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E31", "text": "detained", "offset": 834, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E32", "text": "attack", "offset": 841, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E34", "text": "gives a media statement", "offset": 884, "length": 4, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Theresa May", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T188", "offset": 882, "length": 2}]}, {"role": "Recipient", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E33", "text": "attack", "offset": 903, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "Westminster", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T193", "offset": 906, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E35", "text": "attack", "offset": 924, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E36", "text": "act of terrorism", "offset": 949, "length": 3, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E37", "text": "Attack", "offset": 1101, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "Islamic State", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T140", "offset": 1099, "length": 2}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T29", "offset": 1095, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E38", "text": "Attack", "offset": 1115, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "Islamic State", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T139", "offset": 1113, "length": 2}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T138", "offset": 1109, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E39", "text": "attack", "offset": 1176, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "London", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T198", "offset": 1178, "length": 1}]}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E40", "text": "attack", "offset": 1229, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "people", "entity_id": "95_VOA_EN_NW_2017.03.24.3780056-T155", "offset": 1225, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>