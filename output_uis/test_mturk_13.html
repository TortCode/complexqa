<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Thai <role id='role-0-Prosecutor-0'trigno='0'>Authorities</role> <trigger id='trigger-0'>Indict</trigger> <role id='role-0-Defendant-0'trigno='0'>2</role> Over August <role id='role-1-Place-0'trigno='1'>Shrine</role> <trigger id='trigger-1'>Attack</trigger> A Bangkok military <role id='role-2-Prosecutor-0'trigno='2'>court</role> has <trigger id='trigger-2'>indicted</trigger> two <role id='role-2-Defendant-0'trigno='2'>men</role> accused of carrying out the August 17 <trigger id='trigger-3'>bombing</trigger> at a popular <role id='role-3-Place-0'trigno='3'>shrine</role> that <trigger id='trigger-4'>killed</trigger> 20 <role id='role-4-Victim-0'trigno='4'>people</role>. The <role id='role-5-Prosecutor-0'trigno='5'>court</role> on Tuesday <trigger id='trigger-5'>indicted</trigger> <role id='role-5-Defendant-0'trigno='5'>Bilal Mohammed</role> and <role id='role-5-Defendant-1'trigno='5'>Mieraili Yusufu</role> on 10 counts connected to the <trigger id='trigger-6'>blast</trigger>, including conspiracy to explode bombs and commit premeditated murder. Thailand authorities have not officially named the bombing of Erawan Shrine an act of terror, and accordingly neither suspect was charged specifically with terrorism. Police issued 17 arrest warrants following the <trigger id='trigger-7'>bombing</trigger> but only <role id='role-8-Detainee-1'trigno='8'>Bilal</role> and <role id='role-8-Detainee-0'trigno='8'>Mieraili</role> have been <trigger id='trigger-8'>detained</trigger>. They are described as ethnic Uighurs, a minority group based in China's Xinjiang region. <role id='role-9-Detainee-0'trigno='9'>They</role> have been held in custody since their <trigger id='trigger-9'>arrests</trigger> in late August and early September. Thai <role id='role-10-Participant-0'trigno='10'><role id='role-10-Participant-0'trigno='10'>officials</role></role> have <trigger id='trigger-10'>said</trigger> the <trigger id='trigger-11'>blast</trigger> was carried out by a people-smuggling <role id='role-11-Attacker-0'trigno='11'>gang</role> seeking revenge on Thai authorities for cracking down on their operation. The August 17 <trigger id='trigger-12'>blast</trigger> at the <role id='role-12-Place-0'trigno='12'>Erawan Shrine</role>-a popular tourist destination-was one of the most deadly acts of violence in Bangkok in decades, and left 20 <role id='role-13-Victim-0'trigno='13'>people</role> <trigger id='trigger-13'>dead</trigger> and more than <role id='role-14-Victim-0'trigno='14'>120</role> <trigger id='trigger-14'>injured</trigger>. Of the <trigger id='trigger-15'>dead</trigger>, <role id='role-15-Victim-0'trigno='15'>14</role> were tourists. The <trigger id='trigger-16'>attack</trigger> shocked the residents of the capital because of the apparent randomness, which drove home the point that no place is immune to acts of terror. <role id='role-17-Participant-0'trigno='17'><role id='role-17-Participant-0'trigno='17'>Authorities</role></role>, however, have <trigger id='trigger-17'>declined</trigger> to call it an act of terrorism out of apparent fear that it would hurt the country's huge tourism industry. <role id='role-18-Participant-0'trigno='18'><role id='role-18-Participant-0'trigno='18'>Police</role></role> initially appeared at first to be at a loss, but soon <trigger id='trigger-18'>claimed</trigger> success with a series of <trigger id='trigger-19'>raids</trigger> and two <trigger id='trigger-20'>arrests</trigger>. Arrest warrants have been issued for 15 others. The two suspects were brought to the court in handcuffs wearing brown prison garb. Members of the media were not allowed to enter the court and the <trigger id='trigger-21'>indictments</trigger> took place before the two <role id='role-22-PassengerArtifact-0'trigno='22'><role id='role-21-Defendant-0'trigno='21'>suspects</role></role> <trigger id='trigger-22'>arrived</trigger>, <trigger id='trigger-23'>said</trigger> defense lawyer <role id='role-23-Participant-0'trigno='23'><role id='role-23-Participant-0'trigno='23'>Chuchart Kanpai</role></role>. Doubts about motive Early speculation about the <trigger id='trigger-24'>bombing</trigger> had suggested it might be the work of Uighur separatists who were angry that <role id='role-25-Transporter-0'trigno='25'>Thailand</role> in July forcibly <trigger id='trigger-25'>repatriated</trigger> more than 100 <role id='role-25-PassengerArtifact-0'trigno='25'>Uighurs</role> to <role id='role-25-Destination-0'trigno='25'>China</role>, where it is feared they face persecution. The theory was bolstered by the fact that the Erawan Shrine is popular among Chinese tourists, who figured prominently among the <role id='role-26-Target-0'trigno='26'>victims</role> of the <trigger id='trigger-26'>bombing</trigger>. But Thai <role id='role-27-Participant-0'trigno='27'><role id='role-27-Participant-0'trigno='27'>officials</role></role> <trigger id='trigger-27'>reject</trigger> any political or religious motive, sticking to the theory that it was a revenge for disrupting a human-smuggling gang. Still, skepticism about the <role id='role-28-Participant-0'trigno='28'><role id='role-28-Participant-0'trigno='28'>police</role></role> <trigger id='trigger-28'>explanation</trigger> on the <role id='role-29-Place-0'trigno='29'>shrine</role> <trigger id='trigger-29'>attack</trigger> has abounded because of leaks, contradictions, misstatements and secrecy surrounding the investigation. The two <role id='role-30-Defendant-0'trigno='30'>suspects</role> are being <trigger id='trigger-30'>tried</trigger> at a military <role id='role-30-JudgeCourt-0'trigno='30'>court</role> on an army <role id='role-30-Place-0'trigno='30'>base</role> in Bangkok because cases of “national security” have been handled by the military since last May, when the army seized power in a coup from an elected government. Former National Police Chief <role id='role-31-Participant-0'trigno='31'><role id='role-31-Participant-0'trigno='31'>Somyot Poomphanmuang</role></role> <trigger id='trigger-31'>said</trigger> before his retirement in September that the case against the two suspects was supported by closed-circuit television footage, witnesses, DNA matching and physical evidence, in addition to their confessions. Security camera footage from the Erawan Shrine showed a man wearing a yellow T-shirt who sat down on a bench at the outdoor shrine, took off a black backpack and then left it behind as he stood up and walked away. Time stamps on closed circuit TV footage showed <role id='role-32-PassengerArtifact-0'trigno='32'>he</role> <trigger id='trigger-32'>left</trigger> the <role id='role-32-Origin-0'trigno='32'>shrine</role> just minutes before the <trigger id='trigger-33'>blast</trigger> occurred, during evening rush hour as the area in central Bangkok was filled with people. Police believe that Bilal is the yellow-shirted man who planted the bomb and <role id='role-34-Attacker-0'trigno='34'>Yusufu</role> is believed to have <trigger id='trigger-34'>detonated</trigger> the <role id='role-34-ExplosiveDevice-0'trigno='34'>bomb</role>. Bilal, was initially identified as Adem Karadag, which was the name on a fake Turkish passport in his possession when <role id='role-35-Detainee-0'trigno='35'>he</role> was <trigger id='trigger-35'>arrested</trigger> Aug. 29. <role id='role-36-Detainee-0'trigno='36'>He</role> was <trigger id='trigger-36'>arrested</trigger> at <role id='role-36-Place-0'trigno='36'>one</role> of two apartments <role id='role-36-Jailer-0'trigno='36'>police</role> raided on the outskirts of Bangkok. <role id='role-37-Detainee-0'trigno='37'>Yusufu</role> was <trigger id='trigger-37'>arrested</trigger> Sept. 1 near the Thai-Cambodia border, carrying a Chinese passport indicating he was from Xinjiang. <role id='role-38-Participant-0'trigno='38'><role id='role-38-Participant-0'trigno='38'>Police</role></role> <trigger id='trigger-38'>said</trigger> <role id='role-38-Topic-0'trigno='38'>his</role> DNA and fingerprints were found in both raided apartments, including on a container of gunpowder. <role id='role-39-Participant-0'trigno='39'><role id='role-39-Participant-0'trigno='39'>Police</role></role> <trigger id='trigger-39'>said</trigger> they have confessions from the two, and Bilal's lawyer says his client admitted planting the deadly bomb at the behest of another suspect who remains a fugitive. <role id='role-40-Participant-0'trigno='40'><role id='role-40-Participant-0'trigno='40'>He</role></role> <trigger id='trigger-40'>says</trigger> Bilal was induced to carry out the action by a promise that his emigration to Turkey would be expedited. Some material for this report came from AP. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E1", "text": "Indict", "offset": 2, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": [{"text": "Authorities", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T116", "offset": 1, "length": 1}]}, {"role": "Defendant", "tokens": [{"text": "2", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T146", "offset": 3, "length": 1}]}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E2", "text": "Attack", "offset": 7, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "Shrine", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T119", "offset": 6, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E3", "text": "indicted", "offset": 13, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": [{"text": "court", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T118", "offset": 11, "length": 1}]}, {"role": "Defendant", "tokens": [{"text": "men", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T113", "offset": 15, "length": 1}]}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E4", "text": "bombing", "offset": 23, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "shrine", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T114", "offset": 27, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E5", "text": "killed", "offset": 29, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T40", "offset": 31, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E6", "text": "indicted", "offset": 37, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": [{"text": "court", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T39", "offset": 34, "length": 1}]}, {"role": "Defendant", "tokens": [{"text": "Bilal Mohammed", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T38", "offset": 38, "length": 2}, {"text": "Mieraili Yusufu", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T37", "offset": 41, "length": 2}]}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E7", "text": "blast", "offset": 49, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E39", "text": "bombing", "offset": 94, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E8", "text": "detained", "offset": 102, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "Mieraili", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T71", "offset": 99, "length": 1}, {"text": "Bilal", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T70", "offset": 97, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E9", "text": "arrests", "offset": 130, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "They", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T66", "offset": 122, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E10", "text": "said", "offset": 141, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "officials", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T137", "offset": 139, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "officials", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T137", "offset": 139, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E11", "text": "blast", "offset": 143, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "gang", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T139", "offset": 152, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E12", "text": "blast", "offset": 168, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Erawan Shrine", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T135", "offset": 171, "length": 2}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E13", "text": "dead", "offset": 197, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T13", "offset": 196, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E14", "text": "injured", "offset": 202, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "120", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T14", "offset": 201, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E15", "text": "dead", "offset": 206, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "14", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T12", "offset": 208, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E16", "text": "attack", "offset": 213, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E40", "text": "declined", "offset": 246, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Authorities", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T15", "offset": 241, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Authorities", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T15", "offset": 241, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E19", "text": "claimed", "offset": 283, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T92", "offset": 270, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T92", "offset": 270, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E18", "text": "raids", "offset": 289, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E17", "text": "arrests", "offset": 292, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E20", "text": "indictments", "offset": 331, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": []}, {"role": "Defendant", "tokens": [{"text": "suspects", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T85", "offset": 337, "length": 1}]}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E21", "text": "arrived", "offset": 338, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": [{"text": "suspects", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T85", "offset": 337, "length": 1}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E41", "text": "said", "offset": 340, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Chuchart Kanpai", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T83", "offset": 343, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Chuchart Kanpai", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T83", "offset": 343, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E22", "text": "bombing", "offset": 353, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E23", "text": "repatriated", "offset": 372, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "Thailand", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T107", "offset": 368, "length": 1}]}, {"role": "PassengerArtifact", "tokens": [{"text": "Uighurs", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T108", "offset": 376, "length": 1}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "China", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T109", "offset": 378, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E24", "text": "bombing", "offset": 413, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "victims", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T17", "offset": 410, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E25", "text": "reject", "offset": 418, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "officials", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T19", "offset": 417, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "officials", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T19", "offset": 417, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E27", "text": "explanation", "offset": 448, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T24", "offset": 447, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T24", "offset": 447, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E26", "text": "attack", "offset": 452, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "shrine", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T23", "offset": 451, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E28", "text": "tried", "offset": 473, "length": 1, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": []}, {"role": "Defendant", "tokens": [{"text": "suspects", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T26", "offset": 470, "length": 1}]}, {"role": "JudgeCourt", "tokens": [{"text": "court", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T59", "offset": 477, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "base", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T57", "offset": 481, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E29", "text": "said", "offset": 520, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Somyot Poomphanmuang", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T144", "offset": 518, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Somyot Poomphanmuang", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T144", "offset": 518, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E30", "text": "left", "offset": 610, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": [{"text": "he", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T81", "offset": 609, "length": 1}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": [{"text": "shrine", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T82", "offset": 612, "length": 1}]}, {"role": "Destination", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E31", "text": "blast", "offset": 617, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E32", "text": "detonated", "offset": 655, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "Yusufu", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T56", "offset": 650, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": [{"text": "bomb", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T55", "offset": 657, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E33", "text": "arrested", "offset": 683, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "he", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T130", "offset": 681, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E34", "text": "arrested", "offset": 690, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": [{"text": "police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T126", "offset": 696, "length": 1}]}, {"role": "Detainee", "tokens": [{"text": "He", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T127", "offset": 688, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": [{"text": "one", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T128", "offset": 692, "length": 1}]}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E35", "text": "arrested", "offset": 706, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "Yusufu", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T100", "offset": 704, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E36", "text": "said", "offset": 728, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T97", "offset": 727, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T97", "offset": 727, "length": 1}]}, {"role": "Topic", "tokens": [{"text": "his", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T94", "offset": 729, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E37", "text": "said", "offset": 748, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T32", "offset": 747, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Police", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T32", "offset": 747, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E38", "text": "says", "offset": 781, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "He", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T3", "offset": 780, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "He", "entity_id": "23_VOA_EN_NW_2015.11.24.3071320-T3", "offset": 780, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>