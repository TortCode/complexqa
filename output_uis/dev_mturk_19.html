<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    Enable developer mode:
    <input type="checkbox" id="developer-mode">

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      The owner of a body shop and truck rental agency in Junction City, Kan. , identified Timothy McVeigh in <trigger id='trigger-0'>court</trigger> Friday as the man <role id='role-1-Recipient-0'trigno='1'>who</role> <trigger id='trigger-1'>rented</trigger> the <role id='role-1-AcquiredEntity-0'trigno='1'>Ryder truck</role> used in the <trigger id='trigger-2'>bombing</trigger> of the Oklahoma City federal <role id='role-2-Target-0'trigno='2'>building</role>."I was looking right at <role id='role-3-Topic-0'trigno='3'>him</role>,"<trigger id='trigger-3'>declared</trigger> <role id='role-4-Giver-0'trigno='4'><role id='role-3-Participant-0'trigno='3'><role id='role-3-Participant-0'trigno='3'>Eldon Elliott</role></role></role>, owner of Elliott's Body Shop, recalling the two occasions when <role id='role-4-Recipient-0'trigno='4'>McVeigh</role>, now 29, entered his shop--on April 15, 1995, to <trigger id='trigger-4'>reserve</trigger> a <role id='role-4-AcquiredEntity-0'trigno='4'>truck</role> and pay the <role id='role-4-PaymentBarter-0'trigno='4'>$280. 32</role> rental fee in advance; and on April 17 to pick up the 20-foot Ryder truck. <role id='role-5-Participant-0'trigno='5'><role id='role-5-Participant-0'trigno='5'>He</role></role> <trigger id='trigger-5'>said</trigger> <role id='role-5-Topic-0'trigno='5'>McVeigh</role> used the name"Robert Kling.""That's the way I look at everybody,"<role id='role-6-Participant-0'trigno='6'><role id='role-6-Participant-0'trigno='6'>he</role></role> <trigger id='trigger-6'>told</trigger> <role id='role-6-Participant-1'trigno='6'><role id='role-6-Participant-1'trigno='6'>jurors</role></role> and <role id='role-6-Participant-2'trigno='6'><role id='role-6-Participant-2'trigno='6'>U. S</role></role>. District Judge Richard Matsch."I look at them right square in the face.""Is there any doubt in <role id='role-7-Participant-1'trigno='7'><role id='role-7-Participant-1'trigno='7'>your</role></role> mind?"<trigger id='trigger-7'>asked</trigger> Justice Department prosecutor <role id='role-8-Participant-1'trigno='8'><role id='role-8-Participant-1'trigno='8'><role id='role-7-Participant-0'trigno='7'><role id='role-7-Participant-0'trigno='7'>Scott Mendeloff</role></role></role></role>."No,"<role id='role-8-Participant-0'trigno='8'><role id='role-8-Participant-0'trigno='8'>Elliott</role></role> <trigger id='trigger-8'>replied</trigger>."Who was it?"<role id='role-9-Participant-0'trigno='9'><role id='role-9-Participant-0'trigno='9'>Mendeloff</role></role> <trigger id='trigger-9'>asked</trigger>."Timothy McVeigh,"<role id='role-10-Participant-0'trigno='10'><role id='role-10-Participant-0'trigno='10'>Elliott</role></role> <trigger id='trigger-10'>said</trigger>. <trigger id='trigger-11'>Asked</trigger> to point him out, <role id='role-11-Recipient-0'trigno='11'>Elliott</role> gestured to the defense table."Right over there. Blue shirt."McVeigh sat stone-faced, wearing a blue oxford shirt with long sleeves rolled up. He did not acknowledge Elliott's identification. The testimony came on a day when <role id='role-12-Participant-0'trigno='12'><role id='role-12-Participant-0'trigno='12'>prosecutors</role></role> <trigger id='trigger-12'>presented</trigger> a series of <role id='role-12-Topic-0'trigno='12'>witnesses</role> and <role id='role-12-Topic-1'trigno='12'>documents</role>, including telephone records, a taxi log and a Chinese food takeout order, as well as surveillance photos from a McDonald's restaurant, to trace <role id='role-13-Transporter-0'trigno='13'>McVeigh</role>'s <trigger id='trigger-13'>movements</trigger> from April 14, 1995, when prosecutors say <role id='role-15-Transporter-0'trigno='15'><role id='role-14-Transporter-0'trigno='14'>he</role></role> <trigger id='trigger-14'>arrived</trigger> in <role id='role-14-Destination-0'trigno='14'>Junction City</role>, until April 17, when the <role id='role-15-Vehicle-0'trigno='15'>Ryder truck</role> was <trigger id='trigger-15'>driven</trigger> from Elliott's <role id='role-15-Origin-0'trigno='15'>shop</role> around 4: 30 p. m. The <role id='role-16-Target-0'trigno='16'>Murrah Federal Building</role> in <role id='role-16-Place-0'trigno='16'>Oklahoma City</role> was shattered by an <trigger id='trigger-16'>explosion</trigger> at 9: 02 a. m. on April 19, 1995, <trigger id='trigger-17'>killing</trigger> 168 <role id='role-17-Victim-0'trigno='17'>people</role> and <trigger id='trigger-18'>injuring</trigger> more than 500 <role id='role-18-Victim-0'trigno='18'>others</role>. McVeigh is on trial on charges of murder and conspiracy. Prosecutors claim <role id='role-19-PassengerArtifact-0'trigno='19'>McVeigh</role> <trigger id='trigger-19'>arrived</trigger> in <role id='role-19-Destination-0'trigno='19'>Junction City</role> on April 14, where <role id='role-21-Recipient-0'trigno='21'><role id='role-20-Giver-0'trigno='20'>he</role></role> <trigger id='trigger-20'>sold</trigger> his <role id='role-20-AcquiredEntity-0'trigno='20'>car</role> and <trigger id='trigger-21'>purchased</trigger> a yellow 1977 <role id='role-21-AcquiredEntity-0'trigno='21'>Mercury Marquis</role>. <role id='role-22-Transporter-0'trigno='22'>He</role> allegedly <trigger id='trigger-22'>walked</trigger> to the J and K bus <role id='role-22-Destination-0'trigno='22'>depot</role> where <role id='role-23-Participant-0'trigno='23'><role id='role-23-Participant-0'trigno='23'>he</role></role> <trigger id='trigger-23'>called</trigger> <role id='role-23-Participant-1'trigno='23'><role id='role-23-Participant-1'trigno='23'>Elliott's</role></role> to obtain a price quote on a Ryder truck rental. According to testimony, McVeigh checked into the Dreamland Motel later that day and stayed until the 17th. Prosecutors say <role id='role-24-Transporter-0'trigno='24'>he</role> <trigger id='trigger-24'>drove</trigger> the <role id='role-24-Vehicle-0'trigno='24'>truck</role> to <role id='role-24-Destination-0'trigno='24'>Geary Lake</role> in Kansas, that 4, 000 pounds of <role id='role-25-ExplosiveDevice-0'trigno='25'>ammonium nitrate laced with nitromethane</role> were loaded into the truck there, and that it was driven to <role id='role-25-Place-0'trigno='25'>Oklahoma City</role> and <trigger id='trigger-25'>detonated</trigger>. Elliott <trigger id='trigger-26'>testified</trigger> that on April 15, <role id='role-28-Recipient-0'trigno='28'><role id='role-27-Transporter-0'trigno='27'>McVeigh</role></role> <trigger id='trigger-27'>came</trigger> to the body <role id='role-27-Destination-0'trigno='27'>shop</role> and <trigger id='trigger-28'>reserved</trigger> the <role id='role-28-AcquiredEntity-0'trigno='28'>truck</role>, to be picked up at 4 p. m. two days later. <role id='role-29-Participant-0'trigno='29'><role id='role-29-Participant-0'trigno='29'>Elliott</role></role> <trigger id='trigger-29'>said</trigger> that <role id='role-29-Topic-0'trigno='29'>McVeigh</role> gave him the <role id='role-28-PaymentBarter-0'trigno='28'>$280. 32</role> in exact change after declining to pay an additional amount for insurance. <role id='role-31-Topic-0'trigno='31'><role id='role-30-Recipient-0'trigno='30'>He</role></role> <trigger id='trigger-30'>rented</trigger> the <role id='role-30-AcquiredEntity-0'trigno='30'>truck</role> using a driver's license in the name of"Robert Kling"that showed an address in Redfield, S. D. , <role id='role-31-Participant-0'trigno='31'><role id='role-31-Participant-0'trigno='31'><role id='role-30-Giver-0'trigno='30'>Elliott</role></role></role> <trigger id='trigger-31'>said</trigger>. To piece together McVeigh's movements, <role id='role-32-Participant-0'trigno='32'><role id='role-32-Participant-0'trigno='32'>prosecutors</role></role> <trigger id='trigger-32'>called</trigger> <role id='role-32-Participant-1'trigno='32'><role id='role-32-Participant-1'trigno='32'>Yuhua Bai</role></role>, owner of Hunam Palace, in Junction City, who testified that shortly after 5 p. m. on April 15 <role id='role-33-Recipient-0'trigno='33'>she</role> took a phone order for moo goo gai pan and egg rolls from a caller who gave the name"<role id='role-33-Communicator-0'trigno='33'>Kling</role>"and <trigger id='trigger-33'>requested</trigger> delivery to Room 25 at the Dreamland. According to previous testimony, McVeigh was assigned Room 25. Phone records indicated were shown to the jury indicating that a <trigger id='trigger-34'>call</trigger> was made from that room to the <role id='role-34-Participant-0'trigno='34'><role id='role-34-Participant-0'trigno='34'>Hunam Palace</role></role> at 5: 17 p. m. on the 15th. <role id='role-35-Participant-1'trigno='35'><role id='role-35-Participant-1'trigno='35'>Prosecutors</role></role> also <trigger id='trigger-35'>called</trigger> <role id='role-35-Participant-0'trigno='35'><role id='role-35-Participant-0'trigno='35'>David D'Albini</role></role>, manager of the McDonald's at the time, who narrated surveillance photographs taken in the restaurant April 17. Watching a TV monitor, jurors saw <role id='role-37-Transporter-0'trigno='37'><role id='role-36-Transporter-0'trigno='36'>McVeigh</role></role>, clad in a plaid shirt and jeans, <trigger id='trigger-36'>approach</trigger> the <role id='role-36-Destination-0'trigno='36'>counter</role> and later <trigger id='trigger-37'>walk</trigger> out of the <role id='role-37-Origin-0'trigno='37'>restaurant</role>. The video, which carried a date and time stamp, showed <role id='role-38-Transporter-0'trigno='38'>him</role> <trigger id='trigger-38'>leaving</trigger> the <role id='role-38-Origin-0'trigno='38'>restaurant</role> at 3: 57 p. m. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "scenario_en_kairos_73-E12", "text": "court", "offset": 21, "length": 1, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": []}, {"role": "Defendant", "tokens": []}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E25", "text": "rented", "offset": 27, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": []}, {"role": "Recipient", "tokens": [{"text": "who", "entity_id": "scenario_en_kairos_73-T10", "offset": 26, "length": 1}]}, {"role": "AcquiredEntity", "tokens": [{"text": "Ryder truck", "entity_id": "scenario_en_kairos_73-T11", "offset": 29, "length": 2}]}, {"role": "PaymentBarter", "tokens": []}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E13", "text": "bombing", "offset": 34, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "building", "entity_id": "scenario_en_kairos_73-T14", "offset": 40, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E14", "text": "declared", "offset": 51, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Eldon Elliott", "entity_id": "scenario_en_kairos_73-T17", "offset": 52, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Eldon Elliott", "entity_id": "scenario_en_kairos_73-T17", "offset": 52, "length": 2}]}, {"role": "Topic", "tokens": [{"text": "him", "entity_id": "scenario_en_kairos_73-T16", "offset": 48, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E21", "text": "reserve", "offset": 84, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": [{"text": "Eldon Elliott", "entity_id": "scenario_en_kairos_73-T17", "offset": 52, "length": 2}]}, {"role": "Recipient", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T20", "offset": 68, "length": 1}]}, {"role": "AcquiredEntity", "tokens": [{"text": "truck", "entity_id": "scenario_en_kairos_73-T23", "offset": 86, "length": 1}]}, {"role": "PaymentBarter", "tokens": [{"text": "$280.32", "entity_id": "scenario_en_kairos_73-T170", "offset": 90, "length": 4}]}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E15", "text": "said", "offset": 114, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "He", "entity_id": "scenario_en_kairos_73-T25", "offset": 113, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "He", "entity_id": "scenario_en_kairos_73-T25", "offset": 113, "length": 1}]}, {"role": "Topic", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T26", "offset": 115, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E1", "text": "told", "offset": 137, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T30", "offset": 136, "length": 1}, {"text": "jurors", "entity_id": "scenario_en_kairos_73-T31", "offset": 138, "length": 1}, {"text": "U.S", "entity_id": "scenario_en_kairos_73-T32", "offset": 140, "length": 3}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T30", "offset": 136, "length": 1}, {"text": "jurors", "entity_id": "scenario_en_kairos_73-T31", "offset": 138, "length": 1}, {"text": "U.S", "entity_id": "scenario_en_kairos_73-T32", "offset": 140, "length": 3}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E2", "text": "asked", "offset": 171, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Scott Mendeloff", "entity_id": "scenario_en_kairos_73-T40", "offset": 175, "length": 2}, {"text": "your", "entity_id": "scenario_en_kairos_73-T37", "offset": 167, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Scott Mendeloff", "entity_id": "scenario_en_kairos_73-T40", "offset": 175, "length": 2}, {"text": "your", "entity_id": "scenario_en_kairos_73-T37", "offset": 167, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E26", "text": "replied", "offset": 183, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T41", "offset": 182, "length": 1}, {"text": "Scott Mendeloff", "entity_id": "scenario_en_kairos_73-T40", "offset": 175, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T41", "offset": 182, "length": 1}, {"text": "Scott Mendeloff", "entity_id": "scenario_en_kairos_73-T40", "offset": 175, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E4", "text": "asked", "offset": 192, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Mendeloff", "entity_id": "scenario_en_kairos_73-T43", "offset": 191, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Mendeloff", "entity_id": "scenario_en_kairos_73-T43", "offset": 191, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E3", "text": "said", "offset": 200, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T45", "offset": 199, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T45", "offset": 199, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E22", "text": "Asked", "offset": 202, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "tokens": []}, {"role": "Recipient", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T47", "offset": 208, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E16", "text": "presented", "offset": 258, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "prosecutors", "entity_id": "scenario_en_kairos_73-T51", "offset": 257, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "prosecutors", "entity_id": "scenario_en_kairos_73-T51", "offset": 257, "length": 1}]}, {"role": "Topic", "tokens": [{"text": "witnesses", "entity_id": "scenario_en_kairos_73-T52", "offset": 262, "length": 1}, {"text": "documents", "entity_id": "scenario_en_kairos_73-T164", "offset": 264, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E23", "text": "movements", "offset": 297, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T56", "offset": 294, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E24", "text": "arrived", "offset": 308, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T58", "offset": 307, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "Junction City", "entity_id": "scenario_en_kairos_73-T59", "offset": 310, "length": 2}]}]}, {"event_id": "scenario_en_kairos_73-E27", "text": "driven", "offset": 322, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T58", "offset": 307, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": [{"text": "Ryder truck", "entity_id": "scenario_en_kairos_73-T60", "offset": 319, "length": 2}]}, {"role": "Origin", "tokens": [{"text": "shop", "entity_id": "scenario_en_kairos_73-T62", "offset": 327, "length": 1}]}, {"role": "Destination", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E5", "text": "explosion", "offset": 347, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": [{"text": "Murrah Federal Building", "entity_id": "scenario_en_kairos_73-T63", "offset": 337, "length": 3}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "Oklahoma City", "entity_id": "scenario_en_kairos_73-T64", "offset": 341, "length": 2}]}]}, {"event_id": "scenario_en_kairos_73-E6", "text": "killing", "offset": 362, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "scenario_en_kairos_73-T65", "offset": 364, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E7", "text": "injuring", "offset": 366, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "others", "entity_id": "scenario_en_kairos_73-T66", "offset": 370, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E8", "text": "arrived", "offset": 386, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T69", "offset": 385, "length": 1}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "Junction City", "entity_id": "scenario_en_kairos_73-T70", "offset": 388, "length": 2}]}]}, {"event_id": "scenario_en_kairos_73-E9", "text": "sold", "offset": 396, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T72", "offset": 395, "length": 1}]}, {"role": "Recipient", "tokens": []}, {"role": "AcquiredEntity", "tokens": [{"text": "car", "entity_id": "scenario_en_kairos_73-T152", "offset": 398, "length": 1}]}, {"role": "PaymentBarter", "tokens": []}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E10", "text": "purchased", "offset": 400, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": []}, {"role": "Recipient", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T72", "offset": 395, "length": 1}]}, {"role": "AcquiredEntity", "tokens": [{"text": "Mercury Marquis", "entity_id": "scenario_en_kairos_73-T74", "offset": 404, "length": 2}]}, {"role": "PaymentBarter", "tokens": []}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E28", "text": "walked", "offset": 409, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "He", "entity_id": "scenario_en_kairos_73-T75", "offset": 407, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "depot", "entity_id": "scenario_en_kairos_73-T77", "offset": 416, "length": 1}]}]}, {"event_id": "scenario_en_kairos_73-E29", "text": "called", "offset": 419, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T79", "offset": 418, "length": 1}, {"text": "Elliott's", "entity_id": "scenario_en_kairos_73-T80", "offset": 420, "length": 3}]}, {"role": "Participant", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T79", "offset": 418, "length": 1}, {"text": "Elliott's", "entity_id": "scenario_en_kairos_73-T80", "offset": 420, "length": 3}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E17", "text": "drove", "offset": 456, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "he", "entity_id": "scenario_en_kairos_73-T86", "offset": 455, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": [{"text": "truck", "entity_id": "scenario_en_kairos_73-T87", "offset": 458, "length": 1}]}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "Geary Lake", "entity_id": "scenario_en_kairos_73-T88", "offset": 460, "length": 2}]}]}, {"event_id": "scenario_en_kairos_73-E11", "text": "detonated", "offset": 492, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": [{"text": "ammonium nitrate laced with nitromethane", "entity_id": "scenario_en_kairos_73-T90", "offset": 471, "length": 5}]}, {"role": "Place", "tokens": [{"text": "Oklahoma City", "entity_id": "scenario_en_kairos_73-T94", "offset": 489, "length": 2}]}]}, {"event_id": "scenario_en_kairos_73-E18", "text": "testified", "offset": 495, "length": 1, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "tokens": []}, {"role": "Defendant", "tokens": []}, {"role": "JudgeCourt", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E30", "text": "came", "offset": 502, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T96", "offset": 501, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "shop", "entity_id": "scenario_en_kairos_73-T97", "offset": 506, "length": 1}]}]}, {"event_id": "scenario_en_kairos_73-E31", "text": "reserved", "offset": 508, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": []}, {"role": "Recipient", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T96", "offset": 501, "length": 1}]}, {"role": "AcquiredEntity", "tokens": [{"text": "truck", "entity_id": "scenario_en_kairos_73-T98", "offset": 510, "length": 1}]}, {"role": "PaymentBarter", "tokens": [{"text": "$280.32", "entity_id": "scenario_en_kairos_73-T190", "offset": 533, "length": 4}]}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E32", "text": "said", "offset": 527, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T99", "offset": 526, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T99", "offset": 526, "length": 1}]}, {"role": "Topic", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T100", "offset": 529, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E33", "text": "rented", "offset": 551, "length": 1, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T109", "offset": 580, "length": 1}]}, {"role": "Recipient", "tokens": [{"text": "He", "entity_id": "scenario_en_kairos_73-T102", "offset": 550, "length": 1}]}, {"role": "AcquiredEntity", "tokens": [{"text": "truck", "entity_id": "scenario_en_kairos_73-T103", "offset": 553, "length": 1}]}, {"role": "PaymentBarter", "tokens": []}, {"role": "Beneficiary", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E19", "text": "said", "offset": 581, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T109", "offset": 580, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "Elliott", "entity_id": "scenario_en_kairos_73-T109", "offset": 580, "length": 1}]}, {"role": "Topic", "tokens": [{"text": "He", "entity_id": "scenario_en_kairos_73-T102", "offset": 550, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E35", "text": "called", "offset": 592, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "prosecutors", "entity_id": "scenario_en_kairos_73-T111", "offset": 591, "length": 1}, {"text": "Yuhua Bai", "entity_id": "scenario_en_kairos_73-T112", "offset": 593, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "prosecutors", "entity_id": "scenario_en_kairos_73-T111", "offset": 591, "length": 1}, {"text": "Yuhua Bai", "entity_id": "scenario_en_kairos_73-T112", "offset": 593, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E34", "text": "requested", "offset": 642, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "tokens": [{"text": "Kling", "entity_id": "scenario_en_kairos_73-T120", "offset": 639, "length": 1}]}, {"role": "Recipient", "tokens": [{"text": "she", "entity_id": "scenario_en_kairos_73-T117", "offset": 618, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E36", "text": "call", "offset": 673, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "Hunam Palace", "entity_id": "scenario_en_kairos_73-T127", "offset": 681, "length": 2}]}, {"role": "Participant", "tokens": [{"text": "Hunam Palace", "entity_id": "scenario_en_kairos_73-T127", "offset": 681, "length": 2}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E20", "text": "called", "offset": 697, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": [{"text": "David D'Albini", "entity_id": "scenario_en_kairos_73-T129", "offset": 698, "length": 4}, {"text": "Prosecutors", "entity_id": "scenario_en_kairos_73-T128", "offset": 695, "length": 1}]}, {"role": "Participant", "tokens": [{"text": "David D'Albini", "entity_id": "scenario_en_kairos_73-T129", "offset": 698, "length": 4}, {"text": "Prosecutors", "entity_id": "scenario_en_kairos_73-T128", "offset": 695, "length": 1}]}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E38", "text": "approach", "offset": 741, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T135", "offset": 731, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "counter", "entity_id": "scenario_en_kairos_73-T136", "offset": 743, "length": 1}]}]}, {"event_id": "scenario_en_kairos_73-E39", "text": "walk", "offset": 746, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "McVeigh", "entity_id": "scenario_en_kairos_73-T135", "offset": 731, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": [{"text": "restaurant", "entity_id": "scenario_en_kairos_73-T137", "offset": 750, "length": 1}]}, {"role": "Destination", "tokens": []}]}, {"event_id": "scenario_en_kairos_73-E37", "text": "leaving", "offset": 765, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "him", "entity_id": "scenario_en_kairos_73-T138", "offset": 764, "length": 1}]}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": [{"text": "restaurant", "entity_id": "scenario_en_kairos_73-T139", "offset": 767, "length": 1}]}, {"role": "Destination", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <div id="strategyB-tuples" hidden>
      ${strategyB-tuples}
    </div>

    <p>
      You can navigate all of the events by clicking the following buttons. <br>
      You have to finish all the events before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <div class="strategies">
      <span id="strategy-btns">
        <button id="selectA" class="btn btn-default" type="button">
          Strategy A</button>
        <button id="selectB" class="btn btn-default" type="button">
          Strategy B</button>
      </span>
      <select id="tuple-select">
      </select>
      <div class="ann-component">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>
      <div class="strategy" id="strategyA">
        <div class="ann-component">
          <em>
            These are relations between events.
          </em>
          <div id='relations-area' class='ann well well-sm'>
          </div>
        </div>
      </div>
      <div class="strategy" id="strategyB">
      </div>
    </div>
    <div id="input-area">
    </div>
    <div title="Fill all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <style>.mg-15 {
    margin-left: 15px;
    margin-right: 15px;
}

.mg-5 {
    margin: 5px;
}

.container-fluid {
    max-width: 1800px;
    margin: 30px;
}

.btn-container {
    display: inline-block;
    margin: 10px;
}

.strategies {
    margin: 15px;
}

.ann-component {
    margin: 5px;
}


#collapseTrigger {
    color: #fff;
    display: block;
    text-decoration: none;
}

#submitButton {
    white-space: normal;
}

#input-area {
    display: block;
    margin: 10px;
}

.input-fields {
    margin: 10px;
    padding: 10px;
    background-color: #ffe3e3;
    border-radius: 15px;
}

#template-area {
    background-color: #eee;
    display: flex;
}

#relations-area {
    display: flex;
    flex-direction: column;
    row-gap: 5px;
}

.template-map {
    border: 1px solid gray;
    padding: 5px;
}

.btn-container>button {
    min-width: 3em;
}

trigger {
    display: inline;
}

role {
    display: inline;
}

.highlight-trigger {
    background-color: lightgoldenrodyellow;
}

.highlight-role {
    background-color: lightblue;
}

.highlight-role1 {
    background-color: rgba(255, 255, 0, 0.5);
}

.highlight-role2 {
    background-color: rgba(0, 255, 255, 0.5);
}

.highlight-role3 {
    background-color: rgba(255, 0, 255, 0.5);
}

.btn-group {
    vertical-align: middle;
}

.content {
    margin-bottom: 15px;
}

.ann {
    font-size: 16px;
}

.disp {
    font-size: 20px;
}

.ann>span.token {
    cursor: pointer;
}

.ann>span.token:hover {
    text-decoration: underline;
}

.ann>strong.annotation:hover {
    text-decoration: line-through;
}

input[disabled] {
    color: #000
}

.question-input, .answer-input {
    vertical-align: middle;
}</style>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
  <script>// ---------------------------------------------------------
// Global
// ---------------------------------------------------------

var page_num_set = new Set();
let strategy = '';
let developer_mode = false;

// ---------------------------------------------------------
// Create jQuery elements
// ---------------------------------------------------------

var submit = $('#submitButton');

// list of text/offset objects 
const events_data = JSON.parse($('#events-data').text().trim());
const relations_data = JSON.parse($('#relations-data').text().trim());
const strategyB_tuples = [["road_ied_8-E1", "road_ied_8-E2", "road_ied_8-E3"]];//JSON.parse($('#strategyB-tuples').text().trim());

const empty_template_map = function () {
    return $('<div class="template-map">');
}

const save_record = {
    A: {
        relations: relations_data,
        qapairs: [],
    },
    B: {
        qapairs: [],
    },
};

const strategyA_template = function (tno, event1, event2) {
    return {
        question: '',
        answer: '',
    }
}

const template_record = [];
events_data.forEach(function (ei, i) {
    template_record[i] = empty_template_map();
    events_data.forEach(function (ej, j) {
        if (i >= j) return;

        for (let tno = 1; tno <= 4; tno++){
            {
                const { question, answer } = strategyA_template(tno, ei, ej);
                save_record.A.qapairs.push({
                    event1_id: ei.event_id,
                    event2_id: ej.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
            {
                const { question, answer } = strategyA_template(tno, ej, ei);
                save_record.A.qapairs.push({
                    event1_id: ej.event_id,
                    event2_id: ei.event_id,
                    templateno: tno,
                    question,
                    answer,
                });
            }
        }
    });
});

function strategyB_template(event1_id, event2_id, event3_id) {
    const question = 'What is the participant in the event that interviews the transporter that flew the place that gone off the explosive device. ';
    const answer = '';
    return {
        question, answer
    };
}

strategyB_tuples.forEach(function (tuple, i) {
    const { question, answer } = strategyB_template(tuple[0], tuple[1], tuple[2]);
    save_record.B.qapairs.push({
        event1_id: tuple[0],
        event2_id: tuple[1],
        event3_id: tuple[2],
        question,
        answer,
    });
});

// implementation of string formatting
if (!String.prototype.format) {
    String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
            return typeof args[number] != 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

// ---------------------------------------------------------
// Create elements
// ---------------------------------------------------------

var makeDom = function () {
    recoverUserInput();
    console.log(page_num_set);
    highlightEvent();
};

var highlightEvent = function () {
    /* highlight trigger within document */
    const pagenos = Array.from(page_num_set);
    pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

    // remove previous highlights
    $('trigger').removeClass('highlight-trigger');
    $('role').removeClass('highlight-role1 highlight-role2 highlight-role3');

    pagenos.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role'+(trigger_num+1));
    })
}

const relationTypes = [
    "BEFORE",
    "AFTER",
    "OVERLAPS",
    "EQUAL",
    "CONTAINS",
    "CONTAINED BY",
    "CAUSES",
    "CAUSED BY",
]

// restore input from other trigger
var recoverUserInput = function () {
    const inputArea = $('#input-area');
    inputArea.empty();
    page_num_set.clear();

    let pagenos = [];
    if (strategy === 'A') {
        // questions
        const event_pair = $('#tuple-select').val().split(',').map(x => parseInt(x));
        page_num_set.add(event_pair[0]);
        page_num_set.add(event_pair[1]);

        pagenos = event_pair;
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);

        // relations
        const relationsArea = $('#relations-area');
        relationsArea.empty();
        pagenos.forEach(i => {
            pagenos.forEach(j => {
                if (i >= j) return;

                const event1 = events_data[i];
                const event2 = events_data[j];
                relationsArea.append(makeRelationSelect(event1, event2));
                relationsArea.append(makeRelationSelect(event2, event1));
            })
        })

        const matching_pairs = save_record.A.qapairs.filter(qa => {
            return (
                (qa.event1_id === events_data[event_pair[0]].event_id &&
                qa.event2_id === events_data[event_pair[1]].event_id) ||
                (qa.event1_id === events_data[event_pair[1]].event_id &&
                qa.event2_id === events_data[event_pair[0]].event_id)
            );
        });
        matching_pairs.forEach((qa, i) => {
            add_qa_input(qa.question, qa.answer, qa);
            if (i % 2 === 1 && i < matching_pairs.length - 1)
                inputArea.add($('<hr>'));
        });
    } else if (strategy === 'B') {
        const tuple = save_record.B.qapairs[$('#tuple-select').val()];
        console.log("TUPLE", tuple)
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event1_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event2_id));
        page_num_set.add(events_data.findIndex(e => e.event_id === tuple.event3_id));
        pagenos = Array.from(page_num_set);
        pagenos.sort((a, b) => events_data[a].offset - events_data[b].offset);
        add_qa_input(tuple.question, tuple.answer, null, false);
        add_qa_input('', '', tuple, true);
    }
    // templates
    const templateArea = $('#template-area');
    templateArea.empty()
    pagenos.forEach(trigger_num => {
        const div = $('<div>')
            .append($('<p>').text(describeEvent(events_data[trigger_num])))
            .append(template_record[trigger_num]);
        templateArea.append(div);
    });
};

function describeEvent(event) {
    return (developer_mode ? `ID: ${event.event_id} | ` : "") + `${event.text} @ ${event.offset}`;
}

function makeRelationSelect(event1, event2) {
    const id1 = event1.event_id;
    const id2 = event2.event_id;
    const relation = relations_data.find(r =>
        r.event1_id == id1 &&
        r.event2_id == id2
    );

    const selectInput =
        $('<select class="relation-select mg-5">');
    relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
    });
    selectInput.append($('<option value="NONE">none</option>'));
    selectInput.val(relation?.type ?? "NONE");
    selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r =>
            r.event1_id == event1_id &&
            r.event2_id == event2_id
        );
        if (relation) {
            relation.type = type;
        } else {
            relations_data.push({
                event1_id,
                event2_id,
                type,
            });
        }
    });

    const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

    return div;
}

// ensure something is in the input box
var canSubmit = function () {
    return true;
};

// template role fields
const make_role_mapping_element = function (role, text) {
    const role_text = $('<label>').html('<b>' + role + '</b>:');
    const role_field = $('<span>')
        .addClass('role-field')
        .attr({
            role: role,
            rows: 1,
        })
        .text(text)

    const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

    return role_div;
}


const add_qa_input = function (question = '', answer = '', ref = null, editable = true) {
    let question_text = $('<label>').text('question:');
    let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your question',
            rows: 2,
            cols: 80,
        })
        .text(question);
    question_input.on("input", function () {
        console.log('q', ref)
        if (ref != null)
            ref.question = $(this).val();
        show();
    });
    let answer_text = $('<label>').text('answer:');
    let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
            placeholder: 'write down your answer',
            rows: 2,
            cols: 80,
        })
        .text(answer);
    answer_input.on("input", function () {
        console.log('a', ref)
        if (ref != null)
            ref.answer = $(this).val();
        show();
    });

    if (!editable) {
        question_input.attr('disabled', 'disabled');
        answer_input.attr('disabled', 'disabled');
    }

    const input_fields = $('<div>')
        .addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)

    $('#input-area').append(input_fields);

    show();
};

var enable_button = function (button) {
    button.removeAttr("disabled");
    button.removeClass("btn-default");
    button.addClass("btn-success");
};

var disable_button = function (button) {
    button.attr("disabled", "disabled");
    button.removeClass("btn-success");
    button.addClass("btn-default");
};

var select_button = function (button) {
    button.removeClass("btn-default");
    button.addClass("btn-primary");
};

var deselect_button = function (button) {
    button.removeClass("btn-primary");
    button.addClass("btn-default");
};

var is_wh_question = function (question) {
    let tokens = question.split(' ');
    if (tokens.length <= 1) {
        return false;
    }

    // let wh_pattern = /^Wh\|wh\|How\|how/;
    let wh_pattern = /^wh|Wh|how|How/;
    // console.log(question.match(wh_pattern));
    return !!question.match(wh_pattern);
};


var show = function () {
    for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
            select_button($(button));
        else
            deselect_button($(button));
    }

};

// dynamically create buttons for each SRL arg
events_data.forEach(function (event, i) {
    if (event.text.trim()) {
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = describeEvent(event);
        button.onclick = function () {
            // const pageno = parseInt(this.getAttribute("page-no"));
            // // toggle button
            // if (button.classList.contains('btn-default'))
            //     page_num_set.add(pageno);
            // else
            //     page_num_set.delete(pageno);
            // makeDom();
            // let instruction = $('#instructionBody');
            // if (instruction.is(':visible')) {
            //     instruction.toggle();
            // }
            // //window.scrollTo(0, 0); // scroll to top
            // show();
        }
        document.getElementById('button-bar').appendChild(button);
    }

    // format template area with role mappings
    // if template not null or undefined
    if (event.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(event.template);
        template_area.append(template);
        event.role_text_map.forEach(function (pairing) {
            template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
    }
})

// ---------------------------------------------------------
// Initialize
// ---------------------------------------------------------

var submit_form = function (event) {
    event.preventDefault();
    if (!window.confirm("Are you sure you want to submit?")) return;
    save_all();

    const urlParams = new URLSearchParams(window.location.search)

    // create the form element and point it to the correct endpoint
    const form = document.createElement('form')
    form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
    form.method = 'post'

    // attach the assignmentId
    const inputAssignmentId = document.createElement('input')
    inputAssignmentId.name = 'assignmentId'
    inputAssignmentId.value = urlParams.get('assignmentId')
    inputAssignmentId.hidden = true
    form.appendChild(inputAssignmentId)

    // attach data I want to send back
    const inputResults = document.createElement('input')
    inputResults.name = 'results'
    inputResults.value = JSON.stringify(save_record)
    inputResults.hidden = true
    form.appendChild(inputResults)

    // attach the form to the HTML document and trigger submission
    document.body.appendChild(form)
    form.submit()
}

//$('#save').on('click', save_all);
submit.on('click', submit_form);

var popup_alert = function (alert_box, text) {
    alert_box.html(text);
    alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
    });
    displaying = true;
    setTimeout(function () {
        alert_box.html('');
        alert_box.css({
            'padding': '0px',
            'border': '0px'
        });
        displaying = false;
    }, 7000);
};

const selectA = $('#selectA');
const selectB = $('#selectB');

const tupleSelect = $('#tuple-select');


function makeSelectionOptions() {
    if (strategy === 'A') {
        tupleSelect.empty();
        events_data.forEach(function (ei, i) {
            events_data.forEach(function (ej, j) {
                if (i >= j) return;
                const opt = $('<option>')
                    .attr({
                        value: `${i},${j}`,
                    })
                    .text(`${describeEvent(ei)} & ${describeEvent(ej)}`);
                tupleSelect.append(opt);
            });
        });
        tupleSelect.children()[0].selected = true;
    } else {
        tupleSelect.empty();
        function describeEventById(id) {
            const event = events_data.find(e => e.event_id === id);
            return describeEvent(event);
        }
        strategyB_tuples.forEach(function (tuple, i) {
            const opt = $('<option>')
                .attr({
                    value: i,
                })
                .text(`${describeEventById(tuple[0])}, ${describeEventById(tuple[1])}, ${describeEventById(tuple[2])}`);
            tupleSelect.append(opt);
        });
        tupleSelect.children()[0].selected = true;
    }
}

selectA.on('click', function () {
    if (strategy === 'A') return;
    strategy = 'A';
    $('#strategyA').show();
    select_button(selectA);
    $('#strategyB').hide();
    deselect_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectB.on('click', function () {
    if (strategy === 'B') return;
    strategy = 'B';
    $('#strategyA').hide();
    deselect_button(selectA);
    $('#strategyB').show();
    select_button(selectB);
    makeSelectionOptions();
    makeDom();
    show();
});

selectA.click();

tupleSelect.on('change', function () {
    makeDom();
    show();
});

$('#developer-mode').on('change', function () {
    developer_mode = this.checked;
    makeSelectionOptions();
    makeDom();
    show();
});

// Instructions expand/collapse
var content = $('#instructionBody');
var instructions_trigger = $('#collapseTrigger');
// content.hide();
$('.collapse-text').text('(Click to collapse)');
instructions_trigger.click(function () {
    content.toggle();
    var isVisible = content.is(':visible');
    if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
    } else {
        $('.collapse-text').text('(Click to expand)');
    }
});

console.log(save_record)
show();
</script>
</crowd-form>