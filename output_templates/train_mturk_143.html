<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      <trigger id='trigger-0'>Blast</trigger> also <trigger id='trigger-1'>injured</trigger> more than 50 <role id='role-1-Victim-0'trigno='1'>people</role>, but authorities have yet to suggest <role id='role-2-Attacker-0'trigno='2'>who</role> was behind the <trigger id='trigger-2'>attack</trigger> This article is more than 1 year old This article is more than 1 year old Twenty-one <role id='role-3-Victim-0'trigno='3'>people</role> have been <trigger id='trigger-3'>killed</trigger> and dozens <role id='role-4-Victim-0'trigno='4'>more</role> <trigger id='trigger-4'>injured</trigger> in a car <trigger id='trigger-5'>bombing</trigger> at a Colombian police <role id='role-5-Place-0'trigno='5'>academy</role> in Bogotá, recalling the high-profile <trigger id='trigger-6'>attacks</trigger> associated with the bloodiest chapters of the country’s guerrilla and drug conflicts. The scene outside the General Santander police <role id='role-7-Place-0'trigno='7'>academy</role> was chaotic after the mid-morning <trigger id='trigger-7'>explosion</trigger> on Thursday, with <role id='role-8-Vehicle-1'trigno='8'>ambulances</role> and <role id='role-8-Vehicle-0'trigno='8'>helicopters</role> <trigger id='trigger-8'>rushing</trigger> to the normally tightly controlled <role id='role-8-Destination-0'trigno='8'>facility</role>. Witnesses said they heard a loud <trigger id='trigger-9'>explosion</trigger> that <trigger id='trigger-10'>destroyed</trigger> <role id='role-10-Artifact-0'trigno='10'>windows</role> in adjacent <role id='role-10-Place-0'trigno='10'><role id='role-9-Place-0'trigno='9'>buildings</role></role>. Pictures on social media showed a charred vehicle surrounded by debris on the academy’s campus. Among the dead were a Panamanian and an Ecuadorian national. Alcaldía de Bogotá (@ Bogota) #Atención El alcalde @ EnriquePenalosa se encuentra en la Escuela General Santander acompañando a la @ PoliciaColombia. En breve entregaremos más información. #BogotáCondenaElTerrorismo pic. twitter. com / HBekT48yYi Rafael Trujillo said <role id='role-11-Transporter-0'trigno='11'>he</role> was <trigger id='trigger-11'>delivering</trigger> a care <role id='role-11-PassengerArtifact-0'trigno='11'>package</role> to his son Gerson, who entered the school two days ago, when he was stopped in his tracks by the <trigger id='trigger-12'>blast</trigger> a block away from the school’s heavily fortified entrance. “I’m sad and very worried because I don’t have any information about my son,” said Trujillo, standing outside the facility, where police officers had set up a taped perimeter. “This reminds me of some very sad days in the past.” President <role id='role-13-PassengerArtifact-0'trigno='13'>Iván Duque</role>, who was visiting a western state, was <trigger id='trigger-13'>rushing back</trigger> to the <role id='role-13-Destination-0'trigno='13'>capital</role> to oversee the <role id='role-14-Investigator-0'trigno='14'>police</role> <trigger id='trigger-14'>investigation</trigger> into what he called a “miserable” <trigger id='trigger-15'>attack</trigger>. “All of us Colombians reject terrorism and are united in confronting it,” Duque said in a tweet. “We won’t bend in the face of violence.” <role id='role-16-Identifier-0'trigno='16'>Investigators</role> had <trigger id='trigger-16'>identified</trigger> the car’s <role id='role-16-IdentifiedObject-0'trigno='16'>driver</role> as <role id='role-16-IdentifiedRole-0'trigno='16'>José Aldemar Rojas Rodríguez</role>, who was among the dead, said the Colombian attorney general, Néstor Humberto Martínez. He said the vehicle, a gray Nissan Patrol <role id='role-17-Vehicle-0'trigno='17'>SUV</role>, was <trigger id='trigger-17'>carrying</trigger> 80kg (176lb) of the high explosive <role id='role-17-PassengerArtifact-0'trigno='17'>pentolite</role>, which has been used in the past by Colombian guerrillas. There was no immediate claim of responsibility for the <trigger id='trigger-18'>attack</trigger> and Martínez said investigators were searching for its “intellectual authors” . For decades, residents of Bogotá lived in fear of being caught in a <trigger id='trigger-19'>bombing</trigger> by leftist <role id='role-19-Attacker-0'trigno='19'>rebels</role> or Pablo Escobar’s Medellín drug <role id='role-19-Attacker-1'trigno='19'>cartel</role>. But as Colombia’s conflict has wound down, and the nation’s largest rebel group disarmed under a 2016 peace deal, security has improved and <trigger id='trigger-20'>attacks</trigger> have become less frequent. Facebook Twitter Pinterest Smouldering remains of car bomb are seen in this screengrab outside Bogotá police academy. Authorities have yet to suggest <role id='role-21-Attacker-0'trigno='21'>who</role> was behind the <trigger id='trigger-21'>attack</trigger>, but attention has focused on leftist rebels from the National Liberation Army, ELN, which has been stepping up <trigger id='trigger-22'>attacks</trigger> on police targets in Colombia amid a standoff with the conservative Duque over how to restart stalled peace <trigger id='trigger-23'>talks</trigger>. Colombian <role id='role-24-Killer-0'trigno='24'>rebels</role> blamed for <trigger id='trigger-24'>killing</trigger> spree 400 miles inside Venezuela Read more The group known was long considered a lesser military threat than the Revolutionary Armed Forces of Colombia (Farc), whose 7, 000 guerrilla fighters disarmed as part of a 2016 peace accord. But in the wake of the peace deal, the Cuban-inspired insurgency has been gaining strength, especially along the eastern border with Venezuela, where <role id='role-26-Attacker-0'trigno='26'><role id='role-25-Perpetrator-0'trigno='25'>it</role></role> has carried out a number of <trigger id='trigger-25'>kidnappings</trigger> and <trigger id='trigger-26'>bombings</trigger> of oil <role id='role-26-Target-0'trigno='26'>pipelines</role>. That has hardened Duque’s resolve in refusing to resume peace <trigger id='trigger-27'>talks</trigger> that have been stalled since he took office last August. Thursday’s <trigger id='trigger-28'>bombing</trigger> was the deadliest in the <role id='role-28-Place-0'trigno='28'>capital</role> since an <trigger id='trigger-29'>explosion</trigger> at the upmarket Andino shopping <role id='role-30-Place-0'trigno='30'><role id='role-29-Place-0'trigno='29'>mall</role></role> in June 2017 <trigger id='trigger-30'>killed</trigger> three <role id='role-30-Victim-0'trigno='30'>people</role>, including a French <role id='role-30-Victim-1'trigno='30'>woman</role>, and <trigger id='trigger-31'>injured</trigger> another <role id='role-31-Victim-0'trigno='31'>11</role>. Police later <trigger id='trigger-32'>arrested</trigger> several suspected <role id='role-32-Detainee-0'trigno='32'>members</role> of a far-left urban guerrilla group called the People Revolutionary’s Movement for the <trigger id='trigger-33'>bombing</trigger>. But it has been more than a decade since a police or military installation in the capital has suffered a major <trigger id='trigger-34'>bombing</trigger>. A <trigger id='trigger-35'>blast</trigger> at a military <role id='role-35-Place-0'trigno='35'>university</role> in 2006 left almost two dozen <role id='role-36-Victim-0'trigno='36'>people</role> <trigger id='trigger-36'>injured</trigger>. Ariel Ávila, an analyst who tracks violence, said that in the last four years, there have been 28 <trigger id='trigger-37'>attacks</trigger> in the <role id='role-37-Place-0'trigno='37'>capital</role> with <role id='role-37-Instrument-0'trigno='37'>explosives</role>. While the majority has been carried out with low-grade homemade <role id='role-38-Instrument-1'trigno='38'>materials</role> and <role id='role-38-Instrument-0'trigno='38'>grenades</role> that have <trigger id='trigger-38'>damaged</trigger> property but left no casualties, he said police intelligence and checkpoints surrounding the city need to be reinforced to prevent more <trigger id='trigger-39'>attacks</trigger>. 
    </div>

    <div id='events-data' hidden>
      [{"event_id": "wiki_mass_car_bombings_0_news_0-E3", "text": "Blast", "offset": 0, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E1", "text": "injured", "offset": 2, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_mass_car_bombings_0_news_0-T1", "offset": 6, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E2", "text": "attack", "offset": 18, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "who", "entity_id": "wiki_mass_car_bombings_0_news_0-T3", "offset": 14, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E4", "text": "killed", "offset": 41, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_mass_car_bombings_0_news_0-T4", "offset": 38, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E5", "text": "injured", "offset": 45, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "more", "entity_id": "wiki_mass_car_bombings_0_news_0-T5", "offset": 44, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E6", "text": "bombing", "offset": 49, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "academy", "entity_id": "wiki_mass_car_bombings_0_news_0-T9", "offset": 54, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E7", "text": "attacks", "offset": 63, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E8", "text": "explosion", "offset": 94, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "academy", "entity_id": "wiki_mass_car_bombings_0_news_0-T13", "offset": 86, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E9", "text": "rushing", "offset": 102, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": []}, {"role": "Vehicle", "tokens": [{"text": "helicopters", "entity_id": "wiki_mass_car_bombings_0_news_0-T15", "offset": 101, "length": 1}, {"text": "ambulances", "entity_id": "wiki_mass_car_bombings_0_news_0-T14", "offset": 99, "length": 1}]}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "facility", "entity_id": "wiki_mass_car_bombings_0_news_0-T16", "offset": 108, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E10", "text": "explosion", "offset": 116, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "buildings", "entity_id": "wiki_mass_car_bombings_0_news_0-T20", "offset": 122, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E11", "text": "destroyed", "offset": 118, "length": 1, "template": "[Destroyer] destroyed [Artifact] using [Instrument] instrument in [Place] place", "role_text_map": [{"role": "Destroyer", "tokens": []}, {"role": "Artifact", "tokens": [{"text": "windows", "entity_id": "wiki_mass_car_bombings_0_news_0-T19", "offset": 119, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": [{"text": "buildings", "entity_id": "wiki_mass_car_bombings_0_news_0-T20", "offset": 122, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E12", "text": "delivering", "offset": 199, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": [{"text": "he", "entity_id": "wiki_mass_car_bombings_0_news_0-T34", "offset": 197, "length": 1}]}, {"role": "PassengerArtifact", "tokens": [{"text": "package", "entity_id": "wiki_mass_car_bombings_0_news_0-T170", "offset": 202, "length": 1}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E13", "text": "blast", "offset": 225, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E16", "text": "rushing back", "offset": 303, "length": 2, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": [{"text": "Iv\u00e1n Duque", "entity_id": "wiki_mass_car_bombings_0_news_0-T55", "offset": 292, "length": 2}]}, {"role": "Vehicle", "tokens": []}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": [{"text": "capital", "entity_id": "wiki_mass_car_bombings_0_news_0-T59", "offset": 307, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E14", "text": "investigation", "offset": 312, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "tokens": [{"text": "police", "entity_id": "wiki_mass_car_bombings_0_news_0-T60", "offset": 311, "length": 1}]}, {"role": "Defendant", "tokens": []}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E15", "text": "attack", "offset": 321, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E17", "text": "identified", "offset": 359, "length": 1, "template": "[Identifier] identified [IdentifiedObject] as [IdentifiedRole] at [Place] place", "role_text_map": [{"role": "Identifier", "tokens": [{"text": "Investigators", "entity_id": "wiki_mass_car_bombings_0_news_0-T66", "offset": 357, "length": 1}]}, {"role": "IdentifiedObject", "tokens": [{"text": "driver", "entity_id": "wiki_mass_car_bombings_0_news_0-T68", "offset": 364, "length": 1}]}, {"role": "IdentifiedRole", "tokens": [{"text": "Jos\u00e9 Aldemar Rojas Rodr\u00edguez", "entity_id": "wiki_mass_car_bombings_0_news_0-T69", "offset": 366, "length": 4}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E18", "text": "carrying", "offset": 399, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "tokens": []}, {"role": "PassengerArtifact", "tokens": [{"text": "pentolite", "entity_id": "wiki_mass_car_bombings_0_news_0-T80", "offset": 408, "length": 1}]}, {"role": "Vehicle", "tokens": [{"text": "SUV", "entity_id": "wiki_mass_car_bombings_0_news_0-T78", "offset": 396, "length": 1}]}, {"role": "Origin", "tokens": []}, {"role": "Destination", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E19", "text": "attack", "offset": 430, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E20", "text": "bombing", "offset": 458, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "rebels", "entity_id": "wiki_mass_car_bombings_0_news_0-T89", "offset": 461, "length": 1}, {"text": "cartel", "entity_id": "wiki_mass_car_bombings_0_news_0-T92", "offset": 469, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E21", "text": "attacks", "offset": 500, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E22", "text": "attack", "offset": 533, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "who", "entity_id": "wiki_mass_car_bombings_0_news_0-T103", "offset": 529, "length": 1}]}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E23", "text": "attacks", "offset": 555, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E24", "text": "talks", "offset": 574, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": []}, {"role": "Participant", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E25", "text": "killing", "offset": 580, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": []}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": [{"text": "rebels", "entity_id": "wiki_mass_car_bombings_0_news_0-T112", "offset": 577, "length": 1}]}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E26", "text": "kidnappings", "offset": 659, "length": 1, "template": "[Perpetrator] committed a crime against [Victim] at [Place] place", "role_text_map": [{"role": "Perpetrator", "tokens": [{"text": "it", "entity_id": "wiki_mass_car_bombings_0_news_0-T124", "offset": 652, "length": 1}]}, {"role": "Victim", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E27", "text": "bombings", "offset": 661, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": [{"text": "it", "entity_id": "wiki_mass_car_bombings_0_news_0-T124", "offset": 652, "length": 1}]}, {"role": "Target", "tokens": [{"text": "pipelines", "entity_id": "wiki_mass_car_bombings_0_news_0-T125", "offset": 664, "length": 1}]}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E28", "text": "talks", "offset": 678, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "tokens": []}, {"role": "Participant", "tokens": []}, {"role": "Topic", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E29", "text": "bombing", "offset": 693, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "capital", "entity_id": "wiki_mass_car_bombings_0_news_0-T128", "offset": 699, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E30", "text": "explosion", "offset": 702, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "mall", "entity_id": "wiki_mass_car_bombings_0_news_0-T130", "offset": 708, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E31", "text": "killed", "offset": 712, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_mass_car_bombings_0_news_0-T131", "offset": 714, "length": 1}, {"text": "woman", "entity_id": "wiki_mass_car_bombings_0_news_0-T133", "offset": 719, "length": 1}]}, {"role": "Place", "tokens": [{"text": "mall", "entity_id": "wiki_mass_car_bombings_0_news_0-T130", "offset": 708, "length": 1}]}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E32", "text": "injured", "offset": 722, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "tokens": [{"text": "11", "entity_id": "wiki_mass_car_bombings_0_news_0-T135", "offset": 724, "length": 1}]}, {"role": "Place", "tokens": []}, {"role": "Killer", "tokens": []}, {"role": "MedicalIssue", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E33", "text": "arrested", "offset": 728, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "tokens": []}, {"role": "Detainee", "tokens": [{"text": "members", "entity_id": "wiki_mass_car_bombings_0_news_0-T137", "offset": 731, "length": 1}]}, {"role": "Crime", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E34", "text": "bombing", "offset": 749, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E35", "text": "bombing", "offset": 772, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E36", "text": "blast", "offset": 775, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "ExplosiveDevice", "tokens": []}, {"role": "Place", "tokens": [{"text": "university", "entity_id": "wiki_mass_car_bombings_0_news_0-T145", "offset": 779, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E37", "text": "injured", "offset": 787, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "tokens": [{"text": "people", "entity_id": "wiki_mass_car_bombings_0_news_0-T146", "offset": 786, "length": 1}]}, {"role": "Injurer", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "BodyPart", "tokens": []}, {"role": "MedicalCondition", "tokens": []}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E38", "text": "attacks", "offset": 810, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": [{"text": "explosives", "entity_id": "wiki_mass_car_bombings_0_news_0-T151", "offset": 815, "length": 1}]}, {"role": "Place", "tokens": [{"text": "capital", "entity_id": "wiki_mass_car_bombings_0_news_0-T150", "offset": 813, "length": 1}]}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E40", "text": "damaged", "offset": 834, "length": 1, "template": "[Damager] damaged [Artifact] using [Instrument] instrument in [Place] place", "role_text_map": [{"role": "Damager", "tokens": []}, {"role": "Artifact", "tokens": []}, {"role": "Instrument", "tokens": [{"text": "grenades", "entity_id": "wiki_mass_car_bombings_0_news_0-T152", "offset": 831, "length": 1}, {"text": "materials", "entity_id": "wiki_mass_car_bombings_0_news_0-T199", "offset": 829, "length": 1}]}, {"role": "Place", "tokens": []}]}, {"event_id": "wiki_mass_car_bombings_0_news_0-E39", "text": "attacks", "offset": 857, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "tokens": []}, {"role": "Target", "tokens": []}, {"role": "Instrument", "tokens": []}, {"role": "Place", "tokens": []}]}]
    </div>

    <div id='relations-data' hidden>
      []
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. 
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are relations between events.
        </em>
        <div id='relations-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          KAIROS event arguments for triggers
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .mg-5 {
      margin: 5px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #eee;
      display: flex;
    }

    .template-map {
      border: 1px solid gray;
      padding: 5px;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
    }

    role {
      display: inline;
    }

    .highlight-trigger {
      background-color: lightgoldenrodyellow;
    }

    .highlight-role {
      background-color: lightblue;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num_set = new Set();

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    let events_data = JSON.parse($('#events-data').text().trim());
    let relations_data = JSON.parse($('#relations-data').text().trim());

    const empty_template_map = function () {
      return $('<div class="template-map">');
    }

    let save_record = [];
    let template_record = [];
    events_data.forEach(function (_, idx) {
      template_record[idx] = empty_template_map();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function () {
      highlightEvent();
      recoverUserInput();
    };

    var highlightEvent = function () {
      /* highlight trigger within document */

      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');

      page_num_set.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role');
      })

      /* update bootstrap questions */
      //$('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    const relationTypes = [
      "BEFORE",
      "AFTER",
      "OVERLAPS",
      "RIGHT-AFTER",
      "RIGHT-BEFORE",
      "EQUAL",
      "CONTAINS",
      "CAUSALITY",
    ]

    // restore input from other trigger
    var recoverUserInput = function () {
      // insert template mapping
      const templateArea = $('#template-area');
      templateArea.empty()
      page_num_set.forEach(trigger_num => {
        templateArea.append(template_record[trigger_num]);
      });

      // relations
      const relationsArea = $('#relations-area');
      relationsArea.empty();

      const pagenos = Array.from(page_num_set);
      pagenos.forEach(i => {
        pagenos.forEach(j => {
          if (i == j) return;

          const event1 = events_data[i];
          const event2 = events_data[j];
          const select = makeRelationSelect(event1, event2);
          relationsArea.append(select);
        })
      })
    };

    function makeRelationSelect(event1, event2) {
      const id1 = event1.event_id;
      const id2 = event2.event_id;
      const relation = relations_data.find(r => 
        r.event1_id == id1 && 
        r.event2_id == id2
      );

      const selectInput =
        $('<select class="relation-select mg-5">');
      
      relationTypes.forEach(type => {
        const option = $(`<option value="${type}">${type.toLowerCase()}</option>`);
        selectInput.append(option);
      });
      selectInput.append($('<option value="NONE">none</option>'));

      selectInput.val(relation?.type ?? "NONE");
      selectInput.on('change', function () {
        const type = $(this).val();
        const event1_id = id1;
        const event2_id = id2;
        const relation = relations_data.find(r => 
          r.event1_id == event1_id && 
          r.event2_id == event2_id
        );
        if (relation) {
          relation.type = type;
        } else {
          relations_data.push({
            event1_id,
            event2_id,
            type,
          });
        }
      });

      function describeEvent(event) {
        console.log(event)
        return `${event.text} @ ${event.offset}`;
      }

      const div = $('<div>')
        .append($('<label>').text(describeEvent(event1)))
        .append(selectInput)
        .append($('<label>').text(describeEvent(event2)))

      return div;
    }

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    events_data.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        //console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          const pageno = parseInt(this.getAttribute("page-no"));
          // toggle button
          if (button.classList.contains('btn-default'))
            page_num_set.add(pageno);
          else
            page_num_set.delete(pageno);
          makeDom();
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.tokens.map(tk => tk.text).join('/')));
        });
      }
    })

    var clear_button = document.createElement("button");
    clear_button.setAttribute("type", "button");
    clear_button.setAttribute("class", "btn btn-default");
    clear_button.innerHTML = "Clear Triggers";
    clear_button.onclick = function () {
      page_num_set.clear();
      makeDom();
      show();
    }
    document.getElementById('button-bar').appendChild(clear_button);

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.relations = relations_data.filter(r => r.type !== "NONE");

      const inputAreas = $('#input-area').children();

      // traverse over elements to get QA pairs
      inputAreas.each(function (_, input) {
        const $input = $(input);
        // save qa pairs
        const question = $input.children('.question-input').val();
        const answer = $input.children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>