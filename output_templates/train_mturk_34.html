<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      After explosives <trigger id='trigger-1'>killed</trigger> three <role id='role-1-Victim'trigno='1'>people</role> and <trigger id='trigger-2'>wounded</trigger> about 180 <role id='role-2-Victim'trigno='2'>others</role> during the Boston Marathon, details continue to trickle in as investigators sort through evidence. WHAT'S NEW--<role id='role-10-Communicator'trigno='10'>Obama</role> <trigger id='trigger-10'>declared</trigger> an emergency in <role id='role-11-Place'trigno='11'><role id='role-10-Place'trigno='10'>Massachusetts</role></role> and <trigger id='trigger-11'>ordered</trigger> <role id='role-11-Participant'trigno='11'><role id='role-11-Participant'trigno='11'>federal</role></role> aid to supplement <role id='role-11-Topic'trigno='11'>state</role> and local response efforts. PREVIOUSLY REPORTED Details on the bombs--<role id='role-12-Communicator'trigno='12'>Investigators</role> <trigger id='trigger-12'>say</trigger> the dual <role id='role-12-Topic'trigno='12'><role id='role-0-ExplosiveDevice'trigno='0'>bombs</role></role>, which <trigger id='trigger-0'>exploded</trigger> 12 seconds apart Monday, were designed to deliver vicious suffering. Photos: After the explosion: Moment-by-moment Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Witness Ben Thorndike saw Monday's blast at the Boston Marathon from a nearby office building. His sequence of photos, seven shown here, show the moments immediately after the blast. Hide Caption 1 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 2 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 3 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 4 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 5 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–Hide Caption 6 of 7 Photos: After the explosion: Moment-by-moment After the explosion: Moment-by-moment–The image ends the sequence of photos showing the moments immediately after the blast. Hide Caption 7 of 7 JUST WATCHED Several members of same family wounded Replay More Videos. . . MUST WATCH Several members of same family wounded 04: 43 JUST WATCHED Doctor: Instincts kicked in after blast Replay More Videos. . . MUST WATCH Doctor: Instincts kicked in after blast 09: 06 JUST WATCHED Expert: Cooker bomb easy to make Replay More Videos. . . MUST WATCH Expert: Cooker bomb easy to make 03: 40 JUST WATCHED Mailbox might have saved this man's life Replay More Videos. . . MUST WATCH Mailbox might have saved this man's life 03: 13--One was housed in a pressure cooker hidden inside a backpack, the FBI said. The device also had fragments that may have included nails, BBs and ball bearings, the agency said.--The second bomb was in a metal container, but it was unclear whether it was in a pressure cooker as well, the FBI said.--Photos obtained by CNN show the remains of a pressure cooker found at the scene, along with a shredded black backpack and what appear to be metal pellets or ball bearings.--They were sent to the FBI's national laboratory in Virginia, where technicians will try to reconstruct the devices.--In the past, the U. S. government has <trigger id='trigger-13'>warned</trigger> federal <role id='role-13-Participant'trigno='13'><role id='role-13-Participant'trigno='13'>agencies</role></role> that <role id='role-13-Topic'trigno='13'>terrorists</role> could turn pressure cookers into bombs by packing them with explosives and shrapnel, and detonating them with blasting caps.--Authorities sifted through thousands of pieces of evidence and a mass of digital photos and video clips. They have <trigger id='trigger-14'>pleaded</trigger> for the <role id='role-14-Participant'trigno='14'><role id='role-14-Participant'trigno='14'>public</role></role>'s help in providing additional leads and <role id='role-14-Topic'trigno='14'>images</role>. The casualties The blasts left three people dead.--Martin Richard, an 8-year-old boy with a gap-tooth grin and bright eyes. He loved to run and play in his yard.--Krystle Campbell, a 29-year-old freckle-faced woman described as having"a heart of gold."--The third victim was Lingzu Lu, a graduate student at Boston University, who had moved to the city last fall, making friends and soaking up new experiences.--Of the approximately 178 people <trigger id='trigger-3'>injured</trigger>, <role id='role-3-Victim'trigno='3'>66</role> remain in area hospitals, according to the latest CNN tally. Thirteen of those are still in critical condition, hospital officials said.-Martin's mother and sister are among the wounded. His <role id='role-4-Patient'trigno='4'>mother</role> underwent <trigger id='trigger-4'>surgery</trigger> for a brain injury, and his 6-year-old sister lost her leg. The injuries--<role id='role-4-Treater'trigno='4'>Doctors</role> say dozens of victims suffered injuries to their legs that involve blood vessels, bone and tissue.--The <trigger id='trigger-6'>bombings</trigger> resulted in at least 13 <trigger id='trigger-5'>amputations</trigger> and left <role id='role-5-Treater'trigno='5'>doctors</role> picking ball bearings out of <role id='role-6-Target'trigno='6'><role id='role-5-Patient'trigno='5'>victims</role></role> in the emergency room, a terrorism expert briefed on the investigation said.--Dr. George Velmahos, head of trauma care at Massachusetts General Hospital, said his team found"numerous"metal pellets and nails inside patients'bodies."There are people who have 10, 20, 30, 40 of them in their body, or more,"Velmahos said.--Dr. <role id='role-15-Communicator'trigno='15'>Ron</role> Walls also <trigger id='trigger-15'>said</trigger> one <role id='role-15-Topic'trigno='15'>patient</role> had more than 12 carpenter-type nails."There is no question some of these objects were implanted in the device for the purpose of being exploded forward,"he said. Terror group links--While the clues moved the investigation forward, it is still unclear whether the attack was an act of domestic or foreign terrorism.--No connection has been made to any terrorist group or individual.--President <role id='role-16-Communicator'trigno='16'>Barack</role> Obama <trigger id='trigger-16'>described</trigger> the bombings as an act of terrorism, but said it is unclear whether they were the work of a group or"a malevolent individual."--The Pakistani <role id='role-17-Communicator'trigno='17'>Taliban</role> has <trigger id='trigger-17'>said</trigger> it was not involved in the attack.--Authorities don't have a sense of what the motive is, an official said.--The FBI <trigger id='trigger-18'>asked</trigger> the <role id='role-18-Participant'trigno='18'><role id='role-18-Participant'trigno='18'>public</role></role> to report anyone who talked about targeting the marathon or showed interest in <role id='role-18-Topic'trigno='18'>explosives</role>. The agency urged anyone who might have heard explosions in remote areas--possibly by someone testing a bomb--or seen someone carrying"an unusually heavy, dark-colored bag"around the time of the attack to come forward.'Possible'suspects Three days later, authorities have yet to make an arrest, but have made"significant progress,"a law enforcement official said.--Investigators have pinpointed two men of"high interest"as possible suspects after they appeared in images near the finish line moments before the blasts, a law enforcement official said.--One of the men is seen carrying a black backpack.--Authorities had not yet named the two, but their photographs have been distributed to law enforcement, a source said.--Earlier Wednesday, two sources with knowledge of the investigation identified a man as a possible suspect in the attack, but did not name him.--Seen on a video, the man wore a white baseball cap. One of the sources added that the cap was on backwards and the man was also wearing a light-colored hooded sweatshirt and a black jacket.--It was not immediately clear if he is one of those alluded to in the photographs distributed to law enforcement officials.--Investigators are closer to cracking the case"every hour,"Massachusetts Gov. Deval Patrick said. He urged patience with the probe to allow investigators space to do their job.--"I wish they had nailed the perpetrator within minutes of this catastrophe, but I understand from experience it's going to take some time,"he said. The Investigation--Significant progress has been made in the <trigger id='trigger-7'>investigation</trigger>, but there has been no arrest, the FBI told CNN.--After sources told CNN on Wednesday that an <trigger id='trigger-8'>arrest</trigger> had been made, sources with the Department of Justice and <role id='role-8-Jailer'trigno='8'>Boston</role> Police Department each said that no arrest had been made.--A source with Boston law enforcement said,"We got him,"but would not clarify whether that meant an identification had been made or an arrest carried out.--Some federal sources said that it would be going too far to say even that an identification had been made, but several sources in Boston disputed that, saying a clear identification had been made.--<role id='role-9-Investigator'trigno='9'>Investigators</role> believe they have <trigger id='trigger-9'>identified</trigger> a <role id='role-9-Defendant'trigno='9'>suspect</role> in the marathon bombings, a source who has been briefed on the investigation told CNN's John King. The possible breakthrough came from an analysis of video from a Lord and Taylor department store near the site of the second blast, and video from a Boston TV station helped as well, the official said.--As they scramble to search for suspects, authorities are processing"the most complex crime scene that we have dealt with in the history of our department,"said Ed Davis, the Boston police commissioner.--Forensic specialists and dogs trained to detect explosive devices and their residue were at the scene of the blasts. A command post has been created, with 1, 000 officers conducting interviews and gathering details.--Authorities have received 2, 000 tips from around the world, said Richard DesLauriers, the special agent in charge of the FBI's Boston office."Someone knows who did this,"he said. Security elsewhere--Cities have stepped up security after the attacks, including Washington, New York, Miami, Chicago, Atlanta and Los Angeles.--British police said they are reviewing the security plan for the London Marathon scheduled for Sunday. The marathon will observe 30 seconds of silence and is urging runners to wear a black ribbon to mark the Boston tragedy. Reaction--"Boston is not going to be intimidated by this,"said Secretary of State John Kerry, a former U. S. senator from Massachusetts."But we are going to find out who did this. The police work being done is extraordinary. The FBI is remarkable. There is a great deal of forensic evidence. We are hopeful we can bring people to justice.""The Islamic Republic condemns killing of innocent people in U. S. Boston, Pakistan, Afghanistan, Iraq and Syria in equal measure,"Iran's Ayatollah <role id='role-19-Communicator'trigno='19'>Ali</role> Khamenei <trigger id='trigger-19'>said</trigger> Wednesday, according to a <role id='role-19-Topic'trigno='19'>report</role> on state-run <role id='role-19-Recipient'trigno='19'>Press</role> TV. Tributes--Obama and first lady Michelle Obama will travel to Boston on Thursday for an 11 a. m. interfaith service dedicated to the victims. The president is expected to meet with the families of those wounded or killed.--Obama declared an emergency in Massachusetts and ordered federal aid to supplement state and local response efforts. 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "backpack_ied_18-E1", "text": "exploded", "offset": 63, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "bombs", "offset": 60}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E2", "text": "killed", "offset": 2, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 4}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "backpack_ied_18-E3", "text": "wounded", "offset": 6, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "others", "offset": 9}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E4", "text": "injured", "offset": 726, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "66", "offset": 728}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E5", "text": "surgery", "offset": 769, "template": "[Treater] treater treated [Patient] patient for [MedicalIssue] medical issue with [Instrument] means at [Place] place", "role_text_map": [{"role": "Treater", "token": {"text": "Doctors", "offset": 790}}, {"role": "Patient", "token": {"text": "mother", "offset": 767}}, {"role": "MedicalIssue", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E6", "text": "amputations", "offset": 817, "template": "[Treater] treater treated [Patient] patient for [MedicalIssue] medical issue with [Instrument] means at [Place] place", "role_text_map": [{"role": "Treater", "token": {"text": "doctors", "offset": 820}}, {"role": "Patient", "token": {"text": "victims", "offset": 826}}, {"role": "MedicalIssue", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E7", "text": "bombings", "offset": 811, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "victims", "offset": 826}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E8", "text": "investigation", "offset": 1383, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": null}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E9", "text": "arrest", "offset": 1406, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "Boston Police Department", "offset": 1418}}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E10", "text": "identified", "offset": 1506, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "Investigators", "offset": 1502}}, {"role": "Defendant", "token": {"text": "suspect", "offset": 1508}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E11", "text": "declared", "offset": 32, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Obama", "offset": 31}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": {"text": "Massachusetts", "offset": 36}}]}, {"event_id": "backpack_ied_18-E12", "text": "ordered", "offset": 38, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "federal", "offset": 39}}, {"role": "Participant", "token": {"text": "federal", "offset": 39}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "state", "offset": 43}}, {"role": "Place", "token": {"text": "Massachusetts", "offset": 36}}]}, {"event_id": "backpack_ied_18-E13", "text": "say", "offset": 57, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Investigators", "offset": 56}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "bombs", "offset": 60}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E14", "text": "warned", "offset": 563, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "agencies", "offset": 565}}, {"role": "Participant", "token": {"text": "agencies", "offset": 565}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "terrorists", "offset": 567}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E15", "text": "pleaded", "offset": 610, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "public's", "offset": 613}}, {"role": "Participant", "token": {"text": "public's", "offset": 613}}, {"role": "Topic", "token": {"text": "images", "offset": 622}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E16", "text": "said", "offset": 904, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Ron Walls", "offset": 901}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "patient", "offset": 906}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E17", "text": "described", "offset": 987, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Barack Obama", "offset": 985}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E18", "text": "said", "offset": 1021, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Taliban", "offset": 1019}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E19", "text": "asked", "offset": 1051, "template": "[Participant] communicated remotely with [Participant] about [Topic] topic using [Instrument] at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "public", "offset": 1053}}, {"role": "Participant", "token": {"text": "public", "offset": 1053}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "explosives", "offset": 1067}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_18-E20", "text": "said", "offset": 1867, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Ali Khamenei", "offset": 1865}}, {"role": "Recipient", "token": {"text": "Press TV", "offset": 1878}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "report", "offset": 1873}}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>