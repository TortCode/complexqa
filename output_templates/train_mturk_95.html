<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Multiple outlets, law enforcement officials, and President Obama responded throughout a manic Monday with news that a horrific looking scene made clear in downtown Boston, even as a frenzied search for more potential explosive devices continued and hospitals rushed to help survivors: The crowd at the finish line of the <role id='role-0-Target'trigno='0'>Boston Marathon</role> was <trigger id='trigger-0'>bombed</trigger> twice in what is being described as both a coordinated"event"and"an act of terror"with more than 140 <role id='role-1-Victim'trigno='1'>people</role> brutally <trigger id='trigger-1'>injured</trigger> at eight Boston hospitals and at least three dead, including a young child. Indeed, even as a city and a nation came together amidst the chaotic scene, there was not much good news in Boston this April 15 — the annual Patriot Day, a Massachusetts festival holiday with schools and offices closed for the marathon and, on this particular day, tragedy in the happiest of places. The FBI has taken over"a potential <role id='role-2-Defendant'trigno='2'>terrorist</role> <trigger id='trigger-2'>investigation</trigger>,"FBI special agent in charge <role id='role-7-Communicator'trigno='7'><role id='role-2-Investigator'trigno='2'>Richard DesLauriers</role></role> <trigger id='trigger-7'>said</trigger> at a Monday evening press conference."There is no suspect"at the hospital, Boston Police commissioner Ed Davis said at the briefing, despite reports to the contrary — and speculation that there was still one or multiple persons of interest being questioned at the hospital. When asked if there was a person of interest at the hospital, DeLaurio declined to comment; he also declined to comment on a Wall Street Journal report that there were five additional devices, which was soon clarified to note that"investigators now doubt the devices were bombs"— just one of many conflicting reports citing anonymous law enforcement officials as the investigation began. (And that's not counting the conspiracy theories. ) After the death toll had stood at two for much of the day, <role id='role-8-Communicator'trigno='8'>Davis</role> <trigger id='trigger-8'>confirmed</trigger> at the evening <role id='role-8-Place'trigno='8'>event</role> that"at least three <role id='role-9-Victim'trigno='9'>people</role> have <trigger id='trigger-9'>died</trigger>"in the marathon bombing. Governor <role id='role-10-Communicator'trigno='10'>Deval Patrick</role> <trigger id='trigger-10'>said</trigger>"we are asking that everyone be at a state of heightened vigilance"as Boston planned to re-open on Tuesday, though he said it"will not be business as usual."Boston police and the FBI were scheduled to hold another news conference at 9: 30 a. m. Tuesday morning. At a late afternoon press conference with Patrick, <role id='role-11-Communicator'trigno='11'>Davis</role> initially <trigger id='trigger-11'>reported</trigger> a third <trigger id='trigger-3'>explosion</trigger> at <role id='role-3-Target'trigno='3'>JFK Library</role> in <role id='role-3-Place'trigno='3'>Boston</role>, which has since been given the all-clear as a separate fire. At a second police briefing, <role id='role-12-Communicator'trigno='12'>Davis</role> <trigger id='trigger-12'>said</trigger>"we have no <role id='role-12-Topic'trigno='12'>suspect</role> in custody,"as <role id='role-13-Communicator'trigno='13'><role id='role-12-Recipient'trigno='12'>CNN</role></role> <trigger id='trigger-13'>reported</trigger> that the FBI had classified the event as a terrorist attack. Senate Intelligence Committee Chair Dianne Feinstein classified it as a"terrorist incident"that"could be be foreign, could be homegrown."At a White House briefing shortly after 6 p. m. Eastern time on a quiet day in Washington, President Obama reiterated that federal and local <role id='role-4-Investigator'trigno='4'>investigators</role> are still in the <trigger id='trigger-4'>investigation</trigger> phase. He did not use the words"terror"or"terrorist"or"attack,"instead using the words"unnecessary loss"—"America will say a prayer for Boston tonight,"he said — before delivering a more forceful message: We don't yet have all the answers. . . We still do not know who did this or why. . . But make no mistake we will get to the bottom of this. We will find out who did this. . . and any responsible groups will feel the full weight of justice. NBC News and <role id='role-14-Communicator'trigno='14'>others</role> <trigger id='trigger-14'>reported</trigger> that the <role id='role-14-Recipient'trigno='14'>White House</role> said the bombings would be"approached as an act of terror."Both Obama and Vice President Joe Biden will <trigger id='trigger-5'>meet</trigger> with Secretary of Defense <role id='role-5-Participant'trigno='5'><role id='role-5-Participant'trigno='5'>Chuck Hagel</role></role> on Tuesday. As the investigation continues and news reports continue to make sense of the fallout, you can follow the Boston police scanner, the Boston Globe live blog, and the local CBS, ABC, and Fox stations — as well as some solid Twitter lists. The basic details of the bombings, however, are starting to come into focus. After two explosions hit at around 2: 50 p. m. Boston Police would go on to confirm at least three <trigger id='trigger-6'>dead</trigger> — NBC News cited law enforcement officials as saying one was an eight-year-old <role id='role-6-Victim'trigno='6'>child</role>, a report confirmed by the Boston Globe — and 141 injuries. As for the two bombs that caused the carnage, it appears they were fairly unsophisticated devices, perhaps pipe bombs stuffed with ball bearings, which doctors later reported pulling out of victims'flesh. ABC News reported that the explosions were triggered by remote detonation, but there's still strikingly little known about the other specifics. Meanwhile, there were gruesome images and raw footage from Copley Square area to makeshift tents, from Boston hospitals to Instagram feeds, of lost limbs, hair on fire, children with severe burns, and worse. Scroll down for all the details on the victims, the persons of interest, the moment of horror, and eyewitness accounts. You can follow all of The Atlantic Wire's ongoing Boston Marathon bomb coverage right here — and our Day Two aftermath updates here. The Casualties The Boston Marathon is tracking runners here, and for those looking for information on loved ones, here are the best ways online. Also, phone numbers: for families of victims, call 617-635-4500; for tips, call 1-800-494-TIPS. The Boston chapter of the American Red Cross said on Monday evening that there was no need for additional blood donations"at this time"as their shelves were full. The Red Cross also opened a disaster response center for the recovery effort. Reports of casualties are largely unconfirmed and varying, but here they are, updated in relative real time. In a Monday night press conference, Dr. Peter Fagenholz, a trauma surgeon at Mass. General Hospital, explained that most of the casualties were vascular, bone-related or soft tissue injuries, and that there had been"several"amputees. Fagenholz explained that he started his day in surgery at 8 a. m. , and after the explosion worked nonstop until the press conference. Other local hospitals — some of the best in the nation — are flooded: Injury count as of 745 pm by hospital: Boston Children’s 8; Brigham 27; BMC 23; MGH 22; BI 21; St E's, 15; Tufts 9 — The Boston Globe (@ BostonGlobe) April 16, 2013 An update at the official law enforcement press conference Monday night put the casualty count at 141 injured, at least 15 of them critically. CNN reported that at least ten limbs were lost due to the explosions and doctors were picking ball bearings, a common shrapnel generator in pipe bombs, out of victims. The New York Post reported 12 casualties, and is further reporting that authorities say a suspect in detention is a Saudi national — officials have not confirmed this and Boston PD has not confirmed this. <role id='role-15-Communicator'trigno='15'>CBS News</role> is <trigger id='trigger-15'>reporting</trigger> that <role id='role-15-Recipient'trigno='15'>Boston PD</role> has <role id='role-15-Topic'trigno='15'>video</role> of someone"bringing multiple backpacks to blast site."There are various reports on Twitter of a suspect being detained, but Davis, the police commissioner, maintainted taht"we have no suspect in custody,"seeming to cast doubt on reports quoting a federal law enforcement official in the Post and elsewhere. Among the reported 141 injured a nine-year-old girl, a seven-year-old boy, a 12-year-old, and a two-year-old, according to The Boston Globe. Of the three dead, one is reportedly an eight-year-old boy. The"Person of Interest"For now, Boston Police say that there are no suspects, but when asked about scattered reports about a person of interest, officials — including the new FBI investigator — would not comment, though law enforcement officials maintain, however anonymously, that there are several active leads. Throughout the day and ahead of other media outlets, a law enforcement official kept telling the New York Post about a"Saudi national"as a potential suspect or person of interest, leading to many questions as well as similar reports from Fox News. Another report in the Los Angeles Times said one person — not a"suspect,"but apparently a Saudi national — was being questioned."A federal law enforcement officials said authorities were questioning a Saudi national who was taken to a Boston hospital with injuries,"the report reads."The person was not identified as a suspect."Later on Monday evening The Globe reported that authorities were"questioning person of interest in Marathon bombings at Brigham and Women's Hospital"but did not provide any details about the person's nationality. However, the paper maintains,"The situation remains fluid and it remains too early to establish the cause and motivation."Officials didn't offer much more clarity at the official press conference on Monday night and appear to be approaching the situation with caution. The New York Times reports,"Although investigators confirmed that they were speaking to a Saudi citizen, several law enforcement officials took pains to note that no one was being held in custody."Meanwhile, the FBI is asking for people to send in any info — photos, video, tips — or to call 1-800-CALL-FBI with information regarding the explosions. The investigation remains in the early stages, and the public is clearly pouncing on any sign of a lead. Reports of a police search at a Revere, Mass. condo complex between five and six on Monday night lit up Twitter. However, it's unclear if the search was related to a bombing or not. The Other Devices Soon after the initial explosions, Boston Globe photographer David L. Ryan reported that he heard but did not see a third explosion, and Boston police were scrambling to contain the scene."There were two booms heard from near the finish line"reports the AP. A spokeswoman at the Fairmont Copley Plaza Hotel, close to the explosion, says that it was around two blocks away, while The Boston Globe said that police were conducting a"controlled explosion"on the 600 block of Boylston Street. Over the course of the afternoon and evening, police say they found five additional devices along the marathon route, though a police source later said it was unclear if they were actually bombs. That number does not include numerous reports of suspicious packages around Boston and neighboring cities. The Boston Globe reported another device found near Harvard, and there was a bomb threat phoned in near the Financial District. There were also reports of undetonated devices being found as far away as Newton, though local police have denied those claims. Again, the Journal walked back its initial claim of the five unexploded devices. And then there was the library fire, which had a whole back-and-forth narrative of its own. Here's an updated interactive map of the at times confounding activity, including multiple reported incidents about unconfirmed devices, fires, and all the explosions throughout Monday, both alleged and confirmed, for a sense of scale in downtown Boston and beyond — even as the day seemed to settle on the two explosions near the finish line: The FBI said on Monday evening that local police and federal agents would sweep the entire length of the course to look for evidence and additional devices. Meanwhile, the Navy has sent an Explosive Ordnance Disposal team to help with the effort. The Pictures and Video of the Explosion Here are a couple of many images to flow in from social media early on: Explosion at coply twitter. com / Boston_to_a_T / … — Boston to a T (@ Boston_to_a_T) April 15, 2013 And one more: Just heard that bombs went off at #boston marathon finish line twitter. com / chanyasulkit / s … — Chris Chanyasulkit (@ chanyasulkit) April 15, 2013 Here is perhaps the most shocking, dramatic, and up-close video from the bombings, via the Globe: Here is the moment of impact for the first of the two confirmed explosions, by way of Twitter's Vine, right near the sidewalk (scroll down for video of both): We're going to link to these next two shots (WARNING — they are graphic) since they show the chaos and some of the injuries, and there are a few very graphic images that have been uploaded to Reddit. NECN's Jackie Bruno reports that the injuries there are gruesome: I saw people's legs blown off. Horrific. Two explosions. Runners were coming in and saw unspeakable horror. — Jackie Bruno (@ JackieBrunoNECN) April 15, 2013 To be sure, this is a time to be good to each other. Because there are as many unconfirmed reports and speculative ideas (CBS News reported that certain terrorist target areas are being monitored in Boston, and the Secret Service set up a perimeter around the White House) as there are graphic images. There are amputations. Here are some of the first photos to hit the AP wire (WARNING — it is graphic): This photo from Reuters photographer John Tlumacki quickly became the iconic image of the day: Check out this Tumblr post where you can see Tlumacki taking the photo. And one more from The Boston Globe: boston marathon explosion twitter. com / GlobeDavidLRya … — David L. Ryan (@ GlobeDavidLRyan) April 15, 2013 Here are more photos from The Atlantic's In Focus blog. Here's video of the first explosion: And another close-up video from the explosion: Here's how a marathon runner saw things: And here's another angle with a second explosion in the distance. Here is the photo of Obama on the phone with FBI Director Robert Mueller (official White House photo by Pete Souza): Here is text of President Obama's full remarks at the White House. Adding further heartbreak to utter tragedy, the 26th mile marker in this year's marathon was actually dedicated to the victims of Newtown. The Eyewitness Accounts The size of the crowd has yielded countless eyewitness accounts of the horrific scene. One of the more powerful ones we've read comes from The New York Times, which spoke to Rhode Island state trooper and former Marine Roupen Bastajian."These runners just finished and they don’t have legs now,"said Bastajian."So many of them. There are so many people without legs. It's all blood. There's blood everywhere. You got bones, fragments. It's disgusting."Several of those reporting on the explosions were actually runners in the marathon, so there is no shortage of eyewitness accounts. Two worth reading come from The Wall Street Journal reporter Coleen McCain Nelson and Boston Globe photographer John Tlumacki. Our own Richard Lawson, a Boston native, describes what the scene of the end of the marathon is like on a typical year: Marathon Monday is one of Boston's most celebratory days, with schools and offices closed and people lining the streets cheering runners on for essentially all 26. 2 miles of a course which works its way further and further into town. By the time the Boston Marathon reaches the final stretch down narrow Boylston Street, it has entered the busy commercial district of Copley Square. The historic Boston Public Library is on the runners'right, ahead of them the open area of Copley Square Park and the famous Trinity Church. And of course the culmination of all that is the final downtown stretch, as spirited and jovial a scene as there is in Boston at any time throughout the year. The crowd on marathon day is dense and varied — locals and tourists and running enthusiasts from all over show up hours ahead to secure a good view of the finish line. And of course, there are the runners themselves, still streaming across the finish line for hours after the big winners are crowned. — Richard Lawson As the day wound down and everyone struggled to process what had happened, Astronaut Chris Hadfield sent a sympathetic dispatch from the International Space Station."A somber Spring night in Boston,"he said, including this aerial photo of the city: Closer to home, some folks at MIT paid tribute to the patriotic spirit with an entire building: Stay tuned for the Wire's Day Two live blog and more at our Boston Marathon hub. Want to add to this story? Let us know in comments or send an email to the authors at, aabadsantos at theatlantic dot com or matt dot sullivan at theatlantic dot com. You can share ideas for stories on the Open Wire. Adam Clark Estes Alexander Abad-Santos Matt Sullivan
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "backpack_ied_19-E1", "text": "bombed", "offset": 57, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "Boston Marathon", "offset": 54, "length": 2}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E2", "text": "injured", "offset": 84, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 82, "length": 1}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E3", "text": "investigation", "offset": 168, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "Richard DesLauriers", "offset": 176, "length": 2}}, {"role": "Defendant", "token": {"text": "terrorist", "offset": 167, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E4", "text": "explosion", "offset": 423, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "JFK Library", "offset": 425, "length": 2}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Boston", "offset": 428, "length": 1}}]}, {"event_id": "backpack_ied_19-E5", "text": "investigation", "offset": 535, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "investigators", "offset": 530, "length": 1}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E6", "text": "meet", "offset": 677, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Chuck Hagel", "offset": 682, "length": 2}}, {"role": "Participant", "token": {"text": "Chuck Hagel", "offset": 682, "length": 2}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E7", "text": "dead", "offset": 774, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "child", "offset": 792, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "backpack_ied_19-E8", "text": "said", "offset": 178, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Richard DesLauriers", "offset": 176, "length": 2}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E9", "text": "confirmed", "offset": 326, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Davis", "offset": 325, "length": 1}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": {"text": "event", "offset": 330, "length": 1}}]}, {"event_id": "backpack_ied_19-E10", "text": "died", "offset": 338, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 336, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "backpack_ied_19-E11", "text": "said", "offset": 348, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Deval Patrick", "offset": 346, "length": 2}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E12", "text": "reported", "offset": 420, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Davis", "offset": 418, "length": 1}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E13", "text": "said", "offset": 451, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Davis", "offset": 450, "length": 1}}, {"role": "Recipient", "token": {"text": "CNN", "offset": 462, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "suspect", "offset": 456, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E14", "text": "reported", "offset": 463, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "CNN", "offset": 462, "length": 1}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E15", "text": "reported", "offset": 650, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "others", "offset": 649, "length": 1}}, {"role": "Recipient", "token": {"text": "White House", "offset": 653, "length": 2}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "backpack_ied_19-E16", "text": "reporting", "offset": 1316, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "CBS News", "offset": 1313, "length": 2}}, {"role": "Recipient", "token": {"text": "Boston PD", "offset": 1318, "length": 2}}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": {"text": "video", "offset": 1321, "length": 1}}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>