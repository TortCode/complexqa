<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Wealth of Clues Led to Quick <trigger id='trigger-0'>Arrest</trigger> of New York Suspected <role id='role-0-Detainee'trigno='0'>Bomber</role> NEW YORK — The man suspected of <trigger id='trigger-1'>planting</trigger> <role id='role-1-Artifact'trigno='1'>bombs</role> in a New York neighborhood and a New Jersey seaside <role id='role-1-Place'trigno='1'>town</role> may have aimed to inflict carnage incognito, but he didn't succeed for long in concealing his identity. Ahmad Khan Rahami provided investigators with a wealth of clues that led to <role id='role-2-Detainee'trigno='2'>his</role> <trigger id='trigger-2'>arrest</trigger> about 50 hours after the first explosion, according to three law enforcement <role id='role-3-Investigator'trigno='3'>officials</role> familiar with the <trigger id='trigger-3'>investigation</trigger>. His fingerprints and DNA were found at the scene of the <role id='role-4-Place'trigno='4'>Manhattan</role> <trigger id='trigger-4'>bombing</trigger>, they said. His uncovered face was clearly captured by surveillance cameras near the spot of the blast. Electronic toll records show a <role id='role-5-Vehicle'trigno='5'>car</role> to which he had access was <trigger id='trigger-5'>driven</trigger> from <role id='role-5-Origin'trigno='5'>New</role> Jersey to Manhattan and back to <role id='role-5-Destination'trigno='5'>New</role> Jersey the day of the bombing, according to the officials, who spoke to The Associated Press on condition of anonymity because they weren't authorized to discuss an ongoing case. Those and other clues spurred officials to publicize his name and photo Monday morning, asking for help finding Rahami, 28, a Muslim U. S. citizen born in Afghanistan, who lives with his family in Elizabeth, New Jersey. As the investigation heated up, a bar owner in Linden, New Jersey, reported someone asleep in his doorway. An <role id='role-6-Investigator'trigno='6'>officer</role> went to <trigger id='trigger-6'>investigate</trigger> and recognized the man as <role id='role-6-Defendant'trigno='6'>Rahami</role>, police and the mayor said. <role id='role-7-Attacker'trigno='7'>Rahami</role> pulled a <role id='role-7-Instrument'trigno='7'>gun</role> and <trigger id='trigger-7'>shot</trigger> the <role id='role-7-Target'trigno='7'>officer</role> — who was wearing a bulletproof vest — in the torso, and more <role id='role-8-Jailer'trigno='8'>officers</role> joined in a running gun battle along the street and <trigger id='trigger-8'>brought</trigger> <role id='role-8-Detainee'trigno='8'>Rahami</role> down, police Capt. James Sarnicki said. Another police <role id='role-9-Victim'trigno='9'>officer</role> was <trigger id='trigger-9'>grazed</trigger> by a <role id='role-9-Instrument'trigno='9'>bullet</role>."A lot of technology involved in this, but a lot of good, old-fashioned police work, too,"said New York Police Commissioner James O'Neill. He said now, investigators would"make sure that we get to the bottom of who's involved and why."After <trigger id='trigger-11'>surgery</trigger> for a gunshot <trigger id='trigger-10'>wound</trigger> to his leg, <role id='role-12-Defendant'trigno='12'><role id='role-10-Victim'trigno='10'>Rahami</role></role> was being held on $5. 2 million bail, <trigger id='trigger-12'>charged</trigger> with five counts of attempted murder of police officers. Federal prosecutors said they still were weighing charges over the bombings. Rahami remains hospitalized. Messages left for family members were not immediately returned. It wasn't clear when Rahami would get an attorney. Officials said they have no other suspects at large, but cautioned they are still <trigger id='trigger-13'>investigating</trigger>. The bombing spread fear across the New York area and revived anxiety about homegrown terrorism nationwide. As the East Coast was rattled by the bombings, a man who authorities say referred to <role id='role-15-Target'trigno='15'><role id='role-14-Injurer'trigno='14'>Allah</role></role> <trigger id='trigger-14'>wounded</trigger> nine <role id='role-14-Victim'trigno='14'>people</role> in a stabbing rampage at a Minnesota mall Saturday before being <trigger id='trigger-15'>shot</trigger> to death by an off-duty police <role id='role-15-Attacker'trigno='15'>officer</role>. <role id='role-16-Investigator'trigno='16'>Authorities</role> are <trigger id='trigger-16'>investigating</trigger> the stabbings as a possible terrorist attack but have not drawn any connection between the bloodshed there and the bombings. William Sweeney Jr. , the FBI's assistant director in New York, said there was no indication so far that the bombings were the work of a larger terror cell. Rahami wasn't on any terror or no-fly watch lists, though he had been interviewed for immigration purposes <trigger id='trigger-17'>traveling</trigger> between the <role id='role-17-Destination'trigno='17'>U</role>. S. and <role id='role-17-Origin'trigno='17'>Afghanistan</role>, one of the law enforcement officials said. Rahami and his family live above their restaurant — called First American Fried Chicken — and the family has clashed with the city over closing times and noise complaints, which the Rahamis said in a lawsuit were tinged with anti-Muslim sentiment. The lawsuit was terminated in 2012 because <role id='role-18-Defendant'trigno='18'>one</role> of Rahami's brothers had <trigger id='trigger-18'>pleaded</trigger> guilty to blocking police from enforcing closing hours at the restaurant. A childhood friend, Flee Jones, said Rahami had become more religious after <trigger id='trigger-19'>returning</trigger> from a trip to <role id='role-19-Destination'trigno='19'>Afghanistan</role> several years ago. Still, some of the family restaurant's customers said Rahami was more likely to talk about his interest in cars than to mention faith."He's a very friendly guy,"patron Ryan McCann said."That's what's so scary."The <trigger id='trigger-20'>investigation</trigger> began when a pipe <role id='role-21-ExplosiveDevice'trigno='21'>bomb</role> <trigger id='trigger-21'>blew</trigger> up Saturday morning in Seaside Park, <role id='role-21-Place'trigno='21'>New</role> Jersey, before a charity race to benefit Marines. No one was injured. Then a shrapnel-packed pressure-cooker <role id='role-22-ExplosiveDevice'trigno='22'>bomb</role> <trigger id='trigger-22'>exploded</trigger> Saturday night in New York's Chelsea section, <trigger id='trigger-23'>wounding</trigger> 29 <role id='role-23-Victim'trigno='23'>people</role>, none seriously. An unexploded pressure-cooker bomb was found blocks away. Late Sunday night, five explosive devices were discovered in a trash can at an Elizabeth train station, about 3 miles from where Rahami was later found asleep in the doorway of a bar. Investigators are still gathering evidence and have not publicly tied Rahami to those devices, though Sweeney noted they aren't"ruling anything out."The bombs discovered Saturday all used flip cellphones as a trigger and were all made with easily purchasable materials, a federal law enforcement official speaking on condition of anonymity said. After zeroing in on Rahami and learning of the car that had <trigger id='trigger-24'>traveled</trigger> between <role id='role-24-Origin'trigno='24'>New</role> Jersey and <role id='role-24-Destination'trigno='24'>New</role> York, authorities pulled it over Sunday night after it headed in the direction of Kennedy airport. The law enforcement officials said at least one of Rahami's relatives was in the car. All <role id='role-25-Defendant'trigno='25'>five</role> were questioned and <trigger id='trigger-25'>released</trigger>, Sweeney said. He declined to say whether they might later face charges. Around the time <role id='role-26-Detainee'trigno='26'>Rahami</role> was <trigger id='trigger-26'>captured</trigger>, President Barack Obama was in New York on a previously scheduled visit for a meeting of the U. N. General Assembly. He called on Americans to show the world"we will never give in to fear."
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E1", "text": "Arrest", "offset": 6, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Bomber", "offset": 11}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E2", "text": "planting", "offset": 19, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "bombs", "offset": 20}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "town", "offset": 31}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E3", "text": "arrest", "offset": 67, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "his", "offset": 66}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E4", "text": "investigation", "offset": 85, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "officials", "offset": 81}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E5", "text": "bombing", "offset": 99, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Manhattan", "offset": 98}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E6", "text": "driven", "offset": 132, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": {"text": "car", "offset": 125}}, {"role": "Origin", "token": {"text": "New Jersey", "offset": 134}}, {"role": "Destination", "token": {"text": "New Jersey", "offset": 141}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E7", "text": "investigate", "offset": 247, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "officer", "offset": 244}}, {"role": "Defendant", "token": {"text": "Rahami", "offset": 253}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E8", "text": "shot", "offset": 266, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Rahami", "offset": 261}}, {"role": "Target", "token": {"text": "officer", "offset": 268}}, {"role": "Instrument", "token": {"text": "gun", "offset": 264}}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E9", "text": "brought", "offset": 294, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "officers", "offset": 283}}, {"role": "Detainee", "token": {"text": "Rahami", "offset": 295}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E10", "text": "grazed", "offset": 309, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "officer", "offset": 307}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": {"text": "bullet", "offset": 312}}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E11", "text": "wound", "offset": 377, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "Rahami", "offset": 382}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E12", "text": "surgery", "offset": 373, "template": "[Treater] treater treated [Patient] patient for [MedicalIssue] medical issue with [Instrument] means at [Place] place", "role_text_map": [{"role": "Treater", "token": null}, {"role": "Patient", "token": null}, {"role": "MedicalIssue", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E13", "text": "charged", "offset": 394, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "Rahami", "offset": 382}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E14", "text": "investigating", "offset": 458, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": null}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E15", "text": "wounded", "offset": 495, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 497}}, {"role": "Injurer", "token": {"text": "Allah", "offset": 494}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E16", "text": "shot", "offset": 509, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "officer", "offset": 518}}, {"role": "Target", "token": {"text": "Allah", "offset": 494}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E17", "text": "investigating", "offset": 522, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "Authorities", "offset": 520}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E18", "text": "traveling", "offset": 600, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "Afghanistan", "offset": 608}}, {"role": "Destination", "token": {"text": "U.S.", "offset": 603}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E19", "text": "pleaded", "offset": 677, "template": "[JudgeCourt] court or judge convicted [Defendant] of [Crime] crime in [Place] place", "role_text_map": [{"role": "JudgeCourt", "token": null}, {"role": "Defendant", "token": {"text": "one", "offset": 670}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E20", "text": "returning", "offset": 704, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Afghanistan", "offset": 709}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E21", "text": "investigation", "offset": 768, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": null}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E22", "text": "blew", "offset": 774, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "bomb", "offset": 773}}, {"role": "Place", "token": {"text": "New Jersey", "offset": 782}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E23", "text": "exploded", "offset": 807, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "bomb", "offset": 806}}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E24", "text": "wounding", "offset": 818, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 820}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E25", "text": "traveled", "offset": 944, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "New Jersey", "offset": 946}}, {"role": "Destination", "token": {"text": "New York", "offset": 949}}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E26", "text": "released", "offset": 991, "template": "[JudgeCourt] court or judge released or paroled [Defendant] from [Crime] crime in [Place] place", "role_text_map": [{"role": "JudgeCourt", "token": null}, {"role": "Defendant", "token": {"text": "five", "offset": 987}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "6_VOA_EN_NW_2016.09.20.3516717-E27", "text": "captured", "offset": 1012, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Rahami", "offset": 1010}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>