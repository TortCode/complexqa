<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      2 New Arrests in <role id='role-0-Place'trigno='0'>London</role> <trigger id='trigger-0'>Terror Attack</trigger> <role id='role-1-Place'trigno='1'>London</role> <role id='role-1-Jailer'trigno='1'>police</role> said Friday they have made two more <trigger id='trigger-1'>arrests</trigger> in connection with the <trigger id='trigger-2'>attack</trigger> near Parliament. Counter-terrorism commander Mark Rowley characterized the <trigger id='trigger-3'>arrests</trigger> as “significant,” though he did not provide any details. He said nine <role id='role-4-Detainee'trigno='4'>people</role> are currently <trigger id='trigger-4'>in custody</trigger> and one person has been released. Police officials identified the attacker who <trigger id='trigger-5'>killed</trigger> four <role id='role-5-Victim'trigno='5'>people</role> near <role id='role-5-Place'trigno='5'>Parliament</role> as <role id='role-6-Perpetrator'trigno='6'><role id='role-5-Killer'trigno='5'>Khalid Masood</role></role>, a Briton who converted to Islam and had a lengthy criminal record for weapons <trigger id='trigger-6'>possession</trigger> and other charges. Rowley said Masood’s birth name was Adrian Russell Ajao and appealed to the public for any information about him. A woman holds up a sign at a vigil for the victims of Wednesday's <trigger id='trigger-7'>attack</trigger>, at Trafalgar Square in London, March 23, 2017. The Islamic State group has claimed responsibility for an <trigger id='trigger-8'>attack</trigger> by a <role id='role-9-Injurer'trigno='9'><role id='role-8-Attacker'trigno='8'>man</role></role> who plowed an <role id='role-8-Instrument'trigno='8'>SUV</role> into <role id='role-8-Target'trigno='8'>pedestrians</role> and then <trigger id='trigger-9'>stabbed</trigger> a police <role id='role-9-Victim'trigno='9'>officer</role>. “We remain keen to hear from anyone who knew Khalid Masood well, understands who his associates were and can provide us with information about places he has recently visited,’’Rowley said. “There might be people out there who did have concerns about Masood but did not feel comfortable for whatever reason in passing those concerns to us.’’Islamic State said Masood, who was 52, was a “soldier” of the extremist group who responded to its call to attack civilians and the military in countries allied with the United States in battling IS. Masood had never been convicted of terrorist offenses, but British security officials said he had been investigated in the past “in relation to concerns about violent extremism.” Authorities say they believe he was acting alone Wednesday when <role id='role-11-Killer'trigno='11'><role id='role-10-Attacker'trigno='10'>he</role></role> <trigger id='trigger-10'>ran down</trigger> <role id='role-10-Target'trigno='10'>pedestrians</role> on <role id='role-10-Place'trigno='10'>Westminster Bridge</role>, a Thames River crossing leading to the Houses of Parliament, crashed his rented vehicle into a gate and <trigger id='trigger-11'>fatally stabbed</trigger> a <role id='role-11-Victim'trigno='11'>policeman</role> who tried to stop him. Armed police shot and killed Masood moments later. A <role id='role-13-Place'trigno='13'>property</role> in Birmingham, England, was <trigger id='trigger-13'>searched</trigger> by <role id='role-13-Investigator'trigno='13'>police</role> following Wednesday's <role id='role-12-Place'trigno='12'>London</role> <trigger id='trigger-12'>attack</trigger>, March 23, 2017. In the hours after Wednesday’s <trigger id='trigger-14'>attack</trigger> in the heart of <role id='role-14-Place'trigno='14'>London</role>, <role id='role-15-Attacker'trigno='15'>police</role> <trigger id='trigger-15'>conducted raids</trigger> around the <role id='role-15-Place'trigno='15'>country</role> in search of anyone who may have given support to Masood. Eight men and <role id='role-16-Detainee'trigno='16'>women</role> were <trigger id='trigger-16'>arrested</trigger> Thursday on suspicion of planning terrorist acts. The dead assailant, who was older than most Islamist <role id='role-17-Attacker'trigno='17'>attackers</role> involved in recent spectacular <trigger id='trigger-17'>terror attacks</trigger> in <role id='role-17-Place'trigno='17'>Europe</role>, had been a teacher of English and was known as a fanatical bodybuilder. One of the <role id='role-19-Target'trigno='19'>civilians</role> who was <trigger id='trigger-19'>run down</trigger> on the bridge, a 75-year-old <role id='role-18-Victim'trigno='18'>man</role>, <trigger id='trigger-18'>died</trigger> Thursday in a <role id='role-18-Place'trigno='18'>hospital</role>, raising the casualty toll to four victims and Masood. Although Islamic State claimed responsibility for the <trigger id='trigger-20'>attack</trigger>, a statement posted online did not implicate the group in the planning or execution of the attack. An Italian tourist who witnessed the carnage told reporters he saw Masood attack the policeman with two knives. “<role id='role-21-Injurer'trigno='21'>He</role> gave [the <role id='role-21-Victim'trigno='21'>officer</role>] around <trigger id='trigger-21'>10 stabs in the back</trigger>,” the visitor said. Valiant efforts to resuscitate Constable <role id='role-22-Victim'trigno='22'>Keith Palmer</role> at the scene <trigger id='trigger-22'>failed</trigger>. The 48-year-old officer was a 15-year police veteran. One American was among the <trigger id='trigger-23'>dead</trigger>-54-year-old <role id='role-23-Victim'trigno='23'>Kurt Cochran</role> of Utah, who was in London with his wife to celebrate their 25th wedding anniversary. His wife, <role id='role-24-Victim'trigno='24'>Melissa</role>, was among the 30 people <trigger id='trigger-24'>injured</trigger>. <role id='role-25-Injurer'trigno='25'>Masood</role>’s <role id='role-25-Instrument'trigno='25'>vehicle</role> <trigger id='trigger-25'>hit</trigger> the <role id='role-25-Victim'trigno='25'>Cochrans</role> as they crossed Westminster Bridge. The remaining victim of the <trigger id='trigger-26'>attack</trigger> was a British school administrator, <role id='role-26-Target'trigno='26'>Aysha Frade</role>, 43. Candles burn on Westminster Bridge the day after an <trigger id='trigger-27'>attack</trigger> in London, March 23, 2017. Mourners gathered in London’s Trafalgar Square Thursday evening, about one kilometer from the crime scene, for a candlelight vigil. The mayor of London, Sadiq Khan, told the crowd of thousands that” those trying to destroy our shared way of life will never succeed.” Khan said the vigil in the most recognizable public plaza in London was meant to honor the dead and injured, but also “to send a clear, clear message: Londoners will never be cowed by terrorism.” Rowley, head of counterterrorism efforts for London’s <role id='role-28-Jailer'trigno='28'>Metropolitan Police Service</role>, said the eight <role id='role-28-Detainee'trigno='28'>people</role> <trigger id='trigger-28'>arrested</trigger> Thursday were picked up during searches at six separate <role id='role-28-Place'trigno='28'>locations</role>, and that <trigger id='trigger-29'>investigations</trigger> were continuing in London, Birmingham and other <role id='role-29-Place'trigno='29'>parts</role> of England. He declined to say whether or how those <trigger id='trigger-30'>detained</trigger> were involved in Wednesday’s <trigger id='trigger-31'>attack</trigger>. “It is still our belief, which continues to be born out by our investigation, that this attacker acted alone and was inspired by international terrorism,” Rowley told reporters. Britain's Prime Minister <role id='role-33-Communicator'trigno='33'>Theresa May</role> <trigger id='trigger-33'>gives a media statement</trigger> outside 10 Downing street in London, March 22, 2017, following a terror <trigger id='trigger-32'>attack</trigger> in the <role id='role-32-Place'trigno='32'>Westminster</role> area of London earlier Wednesday. Prime Minister Theresa May struck a defiant tone in discussing the <trigger id='trigger-34'>attack</trigger> before Parliament Thursday, telling British lawmakers that what London experienced was “an attack on free people everywhere.” “Yesterday an <trigger id='trigger-35'>act of terrorism</trigger> tried to silence our democracy, but today we meet as normal, as generations have done before us and as future generations will continue to do, to deliver a simple message: We are not afraid and our resolve will never waver in the face of terrorism,” she said. May thanked Britain’s friends and allies around the world “who have made it clear that they stand with us at this time.” She said the victims include nationals of France, Romania, South Korea, Germany, Poland, Ireland, China, Italy and Greece, as well as the United States. The United Nations Security Council in New York, chaired by British Foreign Minister Boris Johnson, observed a moment of silence Thursday for the London victims. Tense <role id='role-36-Place'trigno='36'>London</role> Carries on After <role id='role-36-Attacker'trigno='36'>Islamic State</role> <trigger id='trigger-36'>Attack</trigger> Video size width x height pixels Tense <role id='role-37-Place'trigno='37'>London</role> Carries on After <role id='role-37-Attacker'trigno='37'>Islamic State</role> <trigger id='trigger-37'>Attack</trigger> Share this video 0: 02: 20 ▶ 0: 00: 00 / 0: 02: 20 ▶ ▶ Direct link 270p | 6. 3MB 360p | 9. 3MB 720p | 61. 6MB “You may know that today there are victims in London from 11 nations. Which goes to show that an <trigger id='trigger-38'>attack</trigger> on <role id='role-38-Place'trigno='38'>London</role> is an attack on the world,” Johnson said. “I can tell you from my talks here in the United States with the U. S. government and with partners from around the world that the world is uniting to defeat the <role id='role-39-Attacker'trigno='39'>people</role> who launched this <trigger id='trigger-39'>attack</trigger> and defeat their bankrupt and odious ideology.” In London, Parliament’s session began with a minute of silence Thursday. Police officers stood in silence nearby outside the headquarters of the city’s Metropolitan Police. 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E1", "text": "Terror Attack", "offset": 5, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 4, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E2", "text": "arrests", "offset": 16, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "police", "offset": 8, "length": 1}}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 7, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E3", "text": "attack", "offset": 21, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E4", "text": "arrests", "offset": 33, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E5", "text": "in custody", "offset": 53, "length": 2, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "people", "offset": 50, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E6", "text": "killed", "offset": 68, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 70, "length": 1}}, {"role": "Place", "token": {"text": "Parliament", "offset": 72, "length": 1}}, {"role": "Killer", "token": {"text": "Khalid Masood", "offset": 74, "length": 2}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E7", "text": "possession", "offset": 91, "length": 1, "template": "[Perpetrator] committed a crime against [Victim] at [Place] place", "role_text_map": [{"role": "Perpetrator", "token": {"text": "Khalid Masood", "offset": 74, "length": 2}}, {"role": "Victim", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E8", "text": "attack", "offset": 134, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E9", "text": "attack", "offset": 156, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "man", "offset": 159, "length": 1}}, {"role": "Target", "token": {"text": "pedestrians", "offset": 165, "length": 1}}, {"role": "Instrument", "token": {"text": "SUV", "offset": 163, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E10", "text": "stabbed", "offset": 168, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "officer", "offset": 171, "length": 1}}, {"role": "Injurer", "token": {"text": "man", "offset": 159, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E11", "text": "ran down", "offset": 320, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "he", "offset": 319, "length": 1}}, {"role": "Target", "token": {"text": "pedestrians", "offset": 322, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Westminster Bridge", "offset": 324, "length": 2}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E12", "text": "fatally stabbed", "offset": 346, "length": 2, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "policeman", "offset": 349, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "he", "offset": 319, "length": 1}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E13", "text": "attack", "offset": 381, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 380, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E14", "text": "searched", "offset": 373, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "police", "offset": 375, "length": 1}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "property", "offset": 366, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E15", "text": "attack", "offset": 395, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 400, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E16", "text": "conducted raids", "offset": 403, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "police", "offset": 402, "length": 1}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "country", "offset": 407, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E17", "text": "arrested", "offset": 425, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "women", "offset": 423, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E18", "text": "terror attacks", "offset": 449, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "attackers", "offset": 444, "length": 1}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Europe", "offset": 452, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E19", "text": "died", "offset": 488, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "man", "offset": 486, "length": 1}}, {"role": "Place", "token": {"text": "hospital", "offset": 492, "length": 1}}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E20", "text": "run down", "offset": 474, "length": 2, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "civilians", "offset": 471, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E21", "text": "attack", "offset": 511, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E22", "text": "10 stabs in the back", "offset": 558, "length": 5, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "officer", "offset": 555, "length": 1}}, {"role": "Injurer", "token": {"text": "He", "offset": 551, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E23", "text": "failed", "offset": 579, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "Keith Palmer", "offset": 574, "length": 2}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E24", "text": "dead", "offset": 601, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "Kurt Cochran", "offset": 608, "length": 2}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E25", "text": "injured", "offset": 637, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "Melissa", "offset": 630, "length": 1}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E26", "text": "hit", "offset": 643, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "Cochrans", "offset": 645, "length": 1}}, {"role": "Injurer", "token": {"text": "Masood", "offset": 639, "length": 1}}, {"role": "Instrument", "token": {"text": "vehicle", "offset": 642, "length": 1}}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E27", "text": "attack", "offset": 657, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "Aysha Frade", "offset": 664, "length": 2}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E28", "text": "attack", "offset": 678, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E29", "text": "arrested", "offset": 799, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "Metropolitan Police Service", "offset": 791, "length": 3}}, {"role": "Detainee", "token": {"text": "people", "offset": 798, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "locations", "offset": 809, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E30", "text": "investigations", "offset": 813, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": null}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "parts", "offset": 822, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E31", "text": "detained", "offset": 834, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E32", "text": "attack", "offset": 841, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E33", "text": "attack", "offset": 903, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Westminster", "offset": 906, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E34", "text": "gives a media statement", "offset": 884, "length": 4, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Theresa May", "offset": 882, "length": 2}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E35", "text": "attack", "offset": 924, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E36", "text": "act of terrorism", "offset": 949, "length": 3, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E37", "text": "Attack", "offset": 1101, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Islamic State", "offset": 1099, "length": 2}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 1095, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E38", "text": "Attack", "offset": 1115, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Islamic State", "offset": 1113, "length": 2}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 1109, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E39", "text": "attack", "offset": 1176, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "London", "offset": 1178, "length": 1}}]}, {"event_id": "95_VOA_EN_NW_2017.03.24.3780056-E40", "text": "attack", "offset": 1229, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "people", "offset": 1225, "length": 1}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #eee;
      display: flex;
    }

    .template-map {
      border: 1px solid gray;
      padding: 5px;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num_set = new Set();

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_map = function () {
      return $('<div class="template-map">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_map();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function () {
      make_trigger();
      recoverUserInput();
    };

    var make_trigger = function () {
      /* highlight trigger within document */

      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');

      page_num_set.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role');
      })

      /* update bootstrap questions */
      //$('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function () {
      const templateArea = $('#template-area');
      // simply swap out the input area DOM element!
      templateArea.empty()
      
      page_num_set.forEach(trigger_num => {
        templateArea.append(template_record[trigger_num]);
      });
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          const pageno = parseInt(this.getAttribute("page-no"));
          // toggle button
          if (button.classList.contains('btn-default'))
            page_num_set.add(pageno);
          else
            page_num_set.delete(pageno);
          makeDom();
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    var clear_button = document.createElement("button");
    clear_button.setAttribute("type", "button");
    clear_button.setAttribute("class", "btn btn-default");
    clear_button.innerHTML = "Clear Triggers";
    clear_button.onclick = function () {
      page_num_set.clear();
      makeDom();
      show();
    }
    document.getElementById('button-bar').appendChild(clear_button);

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>