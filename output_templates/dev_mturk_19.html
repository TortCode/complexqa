<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      The owner of a body shop and truck rental agency in Junction City, Kan. , identified Timothy McVeigh in <trigger id='trigger-11'>court</trigger> Friday as the man <role id='role-24-Recipient'trigno='24'>who</role> <trigger id='trigger-24'>rented</trigger> the <role id='role-24-AcquiredEntity'trigno='24'>Ryder</role> truck used in the <trigger id='trigger-12'>bombing</trigger> of the Oklahoma City federal <role id='role-12-Target'trigno='12'>building</role>."I was looking right at <role id='role-13-Topic'trigno='13'>him</role>,"<trigger id='trigger-13'>declared</trigger> <role id='role-20-Giver'trigno='20'><role id='role-13-Participant'trigno='13'><role id='role-13-Participant'trigno='13'>Eldon</role></role></role> Elliott, owner of Elliott's Body Shop, recalling the two occasions when <role id='role-20-Recipient'trigno='20'>McVeigh</role>, now 29, entered his shop--on April 15, 1995, to <trigger id='trigger-20'>reserve</trigger> a <role id='role-20-AcquiredEntity'trigno='20'>truck</role> and pay the <role id='role-20-PaymentBarter'trigno='20'>$</role> 280. 32 rental fee in advance; and on April 17 to pick up the 20-foot Ryder truck. <role id='role-14-Participant'trigno='14'><role id='role-14-Participant'trigno='14'>He</role></role> <trigger id='trigger-14'>said</trigger> <role id='role-14-Topic'trigno='14'>McVeigh</role> used the name"Robert Kling.""That's the way I look at everybody,"he <trigger id='trigger-0'>told</trigger> jurors and <role id='role-0-Participant'trigno='0'><role id='role-0-Participant'trigno='0'>U</role></role>. S. District Judge Richard Matsch."I look at them right square in the face.""Is there any doubt in <role id='role-1-Participant'trigno='1'><role id='role-1-Participant'trigno='1'>your</role></role> mind?"<trigger id='trigger-1'>asked</trigger> Justice Department prosecutor <role id='role-25-Participant'trigno='25'><role id='role-25-Participant'trigno='25'>Scott</role></role> Mendeloff."No,"Elliott <trigger id='trigger-25'>replied</trigger>."Who was it?"<role id='role-3-Participant'trigno='3'><role id='role-3-Participant'trigno='3'>Mendeloff</role></role> <trigger id='trigger-3'>asked</trigger>."Timothy McVeigh,"<role id='role-2-Participant'trigno='2'><role id='role-2-Participant'trigno='2'>Elliott</role></role> <trigger id='trigger-2'>said</trigger>. <trigger id='trigger-21'>Asked</trigger> to point him out, <role id='role-21-Recipient'trigno='21'>Elliott</role> gestured to the defense table."Right over there. Blue shirt."McVeigh sat stone-faced, wearing a blue oxford shirt with long sleeves rolled up. He did not acknowledge Elliott's identification. The testimony came on a day when <role id='role-15-Participant'trigno='15'><role id='role-15-Participant'trigno='15'>prosecutors</role></role> <trigger id='trigger-15'>presented</trigger> a series of witnesses and <role id='role-15-Topic'trigno='15'>documents</role>, including telephone records, a taxi log and a Chinese food takeout order, as well as surveillance photos from a McDonald's restaurant, to trace <role id='role-22-Transporter'trigno='22'>McVeigh</role>'s <trigger id='trigger-22'>movements</trigger> from April 14, 1995, when prosecutors say <role id='role-26-Transporter'trigno='26'><role id='role-23-Transporter'trigno='23'>he</role></role> <trigger id='trigger-23'>arrived</trigger> in <role id='role-23-Destination'trigno='23'>Junction</role> City, until April 17, when the <role id='role-26-Vehicle'trigno='26'>Ryder</role> truck was <trigger id='trigger-26'>driven</trigger> from Elliott's <role id='role-26-Origin'trigno='26'>shop</role> around 4: 30 p. m. The <role id='role-4-Target'trigno='4'>Murrah</role> Federal Building in <role id='role-4-Place'trigno='4'>Oklahoma</role> City was shattered by an <trigger id='trigger-4'>explosion</trigger> at 9: 02 a. m. on April 19, 1995, <trigger id='trigger-5'>killing</trigger> 168 <role id='role-5-Victim'trigno='5'>people</role> and <trigger id='trigger-6'>injuring</trigger> more than 500 <role id='role-6-Victim'trigno='6'>others</role>. McVeigh is on trial on charges of murder and conspiracy. Prosecutors claim <role id='role-7-PassengerArtifact'trigno='7'>McVeigh</role> <trigger id='trigger-7'>arrived</trigger> in <role id='role-7-Destination'trigno='7'>Junction</role> City on April 14, where <role id='role-9-Recipient'trigno='9'><role id='role-8-Giver'trigno='8'>he</role></role> <trigger id='trigger-8'>sold</trigger> his <role id='role-8-AcquiredEntity'trigno='8'>car</role> and <trigger id='trigger-9'>purchased</trigger> a yellow 1977 <role id='role-9-AcquiredEntity'trigno='9'>Mercury</role> Marquis. <role id='role-27-Transporter'trigno='27'>He</role> allegedly <trigger id='trigger-27'>walked</trigger> to the J and K bus <role id='role-27-Destination'trigno='27'>depot</role> where he <trigger id='trigger-28'>called</trigger> <role id='role-28-Participant'trigno='28'><role id='role-28-Participant'trigno='28'>Elliott</role></role>'s to obtain a price quote on a Ryder truck rental. According to testimony, McVeigh checked into the Dreamland Motel later that day and stayed until the 17th. Prosecutors say <role id='role-16-Transporter'trigno='16'>he</role> <trigger id='trigger-16'>drove</trigger> the <role id='role-16-Vehicle'trigno='16'>truck</role> to <role id='role-16-Destination'trigno='16'>Geary</role> Lake in Kansas, that 4, 000 pounds of <role id='role-10-ExplosiveDevice'trigno='10'>ammonium</role> nitrate laced with nitromethane were loaded into the truck there, and that it was driven to <role id='role-10-Place'trigno='10'>Oklahoma</role> City and <trigger id='trigger-10'>detonated</trigger>. Elliott <trigger id='trigger-17'>testified</trigger> that on April 15, <role id='role-30-Recipient'trigno='30'><role id='role-29-Transporter'trigno='29'>McVeigh</role></role> <trigger id='trigger-29'>came</trigger> to the body <role id='role-29-Destination'trigno='29'>shop</role> and <trigger id='trigger-30'>reserved</trigger> the <role id='role-30-AcquiredEntity'trigno='30'>truck</role>, to be picked up at 4 p. m. two days later. <role id='role-31-Participant'trigno='31'><role id='role-31-Participant'trigno='31'>Elliott</role></role> <trigger id='trigger-31'>said</trigger> that <role id='role-31-Topic'trigno='31'>McVeigh</role> gave him the <role id='role-30-PaymentBarter'trigno='30'>$</role> 280. 32 in exact change after declining to pay an additional amount for insurance. <role id='role-32-Recipient'trigno='32'><role id='role-18-Topic'trigno='18'>He</role></role> <trigger id='trigger-32'>rented</trigger> the <role id='role-32-AcquiredEntity'trigno='32'>truck</role> using a driver's license in the name of"Robert Kling"that showed an address in Redfield, S. D. , <role id='role-32-Giver'trigno='32'><role id='role-18-Participant'trigno='18'><role id='role-18-Participant'trigno='18'>Elliott</role></role></role> <trigger id='trigger-18'>said</trigger>. To piece together McVeigh's movements, prosecutors <trigger id='trigger-34'>called</trigger> <role id='role-34-Participant'trigno='34'><role id='role-34-Participant'trigno='34'>Yuhua</role></role> Bai, owner of Hunam Palace, in Junction City, who testified that shortly after 5 p. m. on April 15 <role id='role-33-Recipient'trigno='33'>she</role> took a phone order for moo goo gai pan and egg rolls from a caller who gave the name"<role id='role-33-Communicator'trigno='33'>Kling</role>"and <trigger id='trigger-33'>requested</trigger> delivery to Room 25 at the Dreamland. According to previous testimony, McVeigh was assigned Room 25. Phone records indicated were shown to the jury indicating that a <trigger id='trigger-35'>call</trigger> was made from that room to the <role id='role-35-Participant'trigno='35'><role id='role-35-Participant'trigno='35'>Hunam</role></role> Palace at 5: 17 p. m. on the 15th. <role id='role-19-Participant'trigno='19'><role id='role-19-Participant'trigno='19'>Prosecutors</role></role> also <trigger id='trigger-19'>called</trigger> David D'Albini, manager of the McDonald's at the time, who narrated surveillance photographs taken in the restaurant April 17. Watching a TV monitor, jurors saw <role id='role-38-Transporter'trigno='38'><role id='role-37-Transporter'trigno='37'>McVeigh</role></role>, clad in a plaid shirt and jeans, <trigger id='trigger-37'>approach</trigger> the <role id='role-37-Destination'trigno='37'>counter</role> and later <trigger id='trigger-38'>walk</trigger> out of the <role id='role-38-Origin'trigno='38'>restaurant</role>. The video, which carried a date and time stamp, showed <role id='role-36-Transporter'trigno='36'>him</role> <trigger id='trigger-36'>leaving</trigger> the <role id='role-36-Origin'trigno='36'>restaurant</role> at 3: 57 p. m. 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "scenario_en_kairos_73-E1", "text": "told", "offset": 137, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "U.S", "offset": 140}}, {"role": "Participant", "token": {"text": "U.S", "offset": 140}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E2", "text": "asked", "offset": 171, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "your", "offset": 167}}, {"role": "Participant", "token": {"text": "your", "offset": 167}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E3", "text": "said", "offset": 200, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Elliott", "offset": 199}}, {"role": "Participant", "token": {"text": "Elliott", "offset": 199}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E4", "text": "asked", "offset": 192, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Mendeloff", "offset": 191}}, {"role": "Participant", "token": {"text": "Mendeloff", "offset": 191}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E5", "text": "explosion", "offset": 347, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "Murrah Federal Building", "offset": 337}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Oklahoma City", "offset": 341}}]}, {"event_id": "scenario_en_kairos_73-E6", "text": "killing", "offset": 362, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 364}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "scenario_en_kairos_73-E7", "text": "injuring", "offset": 366, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "others", "offset": 370}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E8", "text": "arrived", "offset": 386, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "McVeigh", "offset": 385}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Junction City", "offset": 388}}]}, {"event_id": "scenario_en_kairos_73-E9", "text": "sold", "offset": 396, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": {"text": "he", "offset": 395}}, {"role": "Recipient", "token": null}, {"role": "AcquiredEntity", "token": {"text": "car", "offset": 398}}, {"role": "PaymentBarter", "token": null}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E10", "text": "purchased", "offset": 400, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": null}, {"role": "Recipient", "token": {"text": "he", "offset": 395}}, {"role": "AcquiredEntity", "token": {"text": "Mercury Marquis", "offset": 404}}, {"role": "PaymentBarter", "token": null}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E11", "text": "detonated", "offset": 492, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "ammonium nitrate laced with nitromethane", "offset": 471}}, {"role": "Place", "token": {"text": "Oklahoma City", "offset": 489}}]}, {"event_id": "scenario_en_kairos_73-E12", "text": "court", "offset": 21, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": null}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E13", "text": "bombing", "offset": 34, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "building", "offset": 40}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E14", "text": "declared", "offset": 51, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Eldon Elliott", "offset": 52}}, {"role": "Participant", "token": {"text": "Eldon Elliott", "offset": 52}}, {"role": "Topic", "token": {"text": "him", "offset": 48}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E15", "text": "said", "offset": 114, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "He", "offset": 113}}, {"role": "Participant", "token": {"text": "He", "offset": 113}}, {"role": "Topic", "token": {"text": "McVeigh", "offset": 115}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E16", "text": "presented", "offset": 258, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "prosecutors", "offset": 257}}, {"role": "Participant", "token": {"text": "prosecutors", "offset": 257}}, {"role": "Topic", "token": {"text": "documents", "offset": 264}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E17", "text": "drove", "offset": 456, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "he", "offset": 455}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": {"text": "truck", "offset": 458}}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Geary Lake", "offset": 460}}]}, {"event_id": "scenario_en_kairos_73-E18", "text": "testified", "offset": 495, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": null}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E19", "text": "said", "offset": 581, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Elliott", "offset": 580}}, {"role": "Participant", "token": {"text": "Elliott", "offset": 580}}, {"role": "Topic", "token": {"text": "He", "offset": 550}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E20", "text": "called", "offset": 697, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Prosecutors", "offset": 695}}, {"role": "Participant", "token": {"text": "Prosecutors", "offset": 695}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E21", "text": "reserve", "offset": 84, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": {"text": "Eldon Elliott", "offset": 52}}, {"role": "Recipient", "token": {"text": "McVeigh", "offset": 68}}, {"role": "AcquiredEntity", "token": {"text": "truck", "offset": 86}}, {"role": "PaymentBarter", "token": {"text": "$280.32", "offset": 90}}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E22", "text": "Asked", "offset": 202, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": null}, {"role": "Recipient", "token": {"text": "Elliott", "offset": 208}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E23", "text": "movements", "offset": 297, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "McVeigh", "offset": 294}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": null}]}, {"event_id": "scenario_en_kairos_73-E24", "text": "arrived", "offset": 308, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "he", "offset": 307}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Junction City", "offset": 310}}]}, {"event_id": "scenario_en_kairos_73-E25", "text": "rented", "offset": 27, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": null}, {"role": "Recipient", "token": {"text": "who", "offset": 26}}, {"role": "AcquiredEntity", "token": {"text": "Ryder truck", "offset": 29}}, {"role": "PaymentBarter", "token": null}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E26", "text": "replied", "offset": 183, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "Scott Mendeloff", "offset": 175}}, {"role": "Participant", "token": {"text": "Scott Mendeloff", "offset": 175}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E27", "text": "driven", "offset": 322, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "he", "offset": 307}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": {"text": "Ryder truck", "offset": 319}}, {"role": "Origin", "token": {"text": "shop", "offset": 327}}, {"role": "Destination", "token": null}]}, {"event_id": "scenario_en_kairos_73-E28", "text": "walked", "offset": 409, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "He", "offset": 407}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "depot", "offset": 416}}]}, {"event_id": "scenario_en_kairos_73-E29", "text": "called", "offset": 419, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Elliott's", "offset": 420}}, {"role": "Participant", "token": {"text": "Elliott's", "offset": 420}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E30", "text": "came", "offset": 502, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "McVeigh", "offset": 501}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "shop", "offset": 506}}]}, {"event_id": "scenario_en_kairos_73-E31", "text": "reserved", "offset": 508, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": null}, {"role": "Recipient", "token": {"text": "McVeigh", "offset": 501}}, {"role": "AcquiredEntity", "token": {"text": "truck", "offset": 510}}, {"role": "PaymentBarter", "token": {"text": "$280.32", "offset": 533}}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E32", "text": "said", "offset": 527, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Elliott", "offset": 526}}, {"role": "Participant", "token": {"text": "Elliott", "offset": 526}}, {"role": "Topic", "token": {"text": "McVeigh", "offset": 529}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E33", "text": "rented", "offset": 551, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": {"text": "Elliott", "offset": 580}}, {"role": "Recipient", "token": {"text": "He", "offset": 550}}, {"role": "AcquiredEntity", "token": {"text": "truck", "offset": 553}}, {"role": "PaymentBarter", "token": null}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E34", "text": "requested", "offset": 642, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "Kling", "offset": 639}}, {"role": "Recipient", "token": {"text": "she", "offset": 618}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E35", "text": "called", "offset": 592, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Yuhua Bai", "offset": 593}}, {"role": "Participant", "token": {"text": "Yuhua Bai", "offset": 593}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E36", "text": "call", "offset": 673, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Hunam Palace", "offset": 681}}, {"role": "Participant", "token": {"text": "Hunam Palace", "offset": 681}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_kairos_73-E37", "text": "leaving", "offset": 765, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "him", "offset": 764}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "restaurant", "offset": 767}}, {"role": "Destination", "token": null}]}, {"event_id": "scenario_en_kairos_73-E38", "text": "approach", "offset": 741, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "McVeigh", "offset": 731}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "counter", "offset": 743}}]}, {"event_id": "scenario_en_kairos_73-E39", "text": "walk", "offset": 746, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "McVeigh", "offset": 731}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "restaurant", "offset": 750}}, {"role": "Destination", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>