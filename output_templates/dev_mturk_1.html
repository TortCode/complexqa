<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      <role id='role-27-Communicator'trigno='27'>Government</role> opponents are <trigger id='trigger-27'>begging</trigger> <role id='role-27-Recipient'trigno='27'>Venezuelans</role> to sit out a vote on Sunday for what they see as a puppet congress and the last step toward dictatorship in this South American country. But José, a Caracas bus driver, said <role id='role-28-Recipient'trigno='28'>he</role> and other public transit employees were given an <trigger id='trigger-28'>ultimatum</trigger> by <role id='role-28-Communicator'trigno='28'>their</role> bosses. Turn out and vote for the new congress, in an election in which nearly every candidate is a supporter of President Nicolás Maduro. Or else. “<role id='role-1-Communicator'trigno='1'>They</role>’re <trigger id='trigger-1'>obliging</trigger> <role id='role-1-Recipient'trigno='1'>us</role> to vote,” said the young father of two, who declined to give his last name, fearing repercussions. “If not, they’ll <trigger id='trigger-2'>fire</trigger> <role id='role-2-Employee'trigno='2'>us</role>, and what are we going to do without a job?” Venezuela is not yet the kind of dictatorship that once proliferated in Latin America — with rulers who “disappeared” opponents, banned books and movies, and ran mass torture centers. <role id='role-3-Impeder'trigno='3'>Government</role> pressure and violence against journalists have drastically <trigger id='trigger-3'>curbed</trigger> the press, but digital media outlets thrive. Hundreds of political <role id='role-4-Detainee'trigno='4'>prisoners</role> are <trigger id='trigger-4'>in</trigger> <role id='role-4-Place'trigno='4'>jail</role>, according to human rights groups, but opposition leaders continue to forcefully speak out. This month, the government allowed one major critic — Leopoldo López, the former mayor of Caracas — to exchange his jail cell for <role id='role-34-Place'trigno='34'>house</role> <trigger id='trigger-34'>arrest</trigger>. 1 of 46 Full Screen Autoplay Close Skip Ad × <role id='role-6-Detainee'trigno='6'><role id='role-5-Demonstrator'trigno='5'>Protesters</role></role> <trigger id='trigger-5'>clash</trigger> with Venezuelan <role id='role-6-Jailer'trigno='6'><role id='role-5-Regulator'trigno='5'>security forces</role></role> View Photos Thousands have been <trigger id='trigger-6'>arrested</trigger>, and many allege mistreatment. Caption People took to the streets to either vote in or boycott a controversial election to choose members of an all-powerful Constituent Assembly. Aug. 7, 2017 Pro-government <role id='role-7-Demonstrator'trigno='7'>supporters</role> holding Venezuela’s flag <trigger id='trigger-7'>march</trigger> in Caracas. Ueslei Marcelino / Reuters Buy Photo Wait 1 second to continue. Yet on Sunday, critics say, an authoritarian system long in the making will be formalized, reviving memories of an era that the region had hoped was over. In defiance of international warnings, the socialist government is pushing forward with a vote to elect a constituent assembly that will have the authority to change the 1999 constitution, supplant the opposition-controlled legislature and potentially keep Maduro in power indefinitely. The opposition on Thursday called for three days of massive, nationwide <trigger id='trigger-9'>protests</trigger> as <role id='role-9-Target'trigno='9'><role id='role-8-Killer'trigno='8'>the government</role></role> showed no willingness to back down and following the <trigger id='trigger-8'>slaying</trigger> of seven more <role id='role-8-Victim'trigno='8'>demonstrators</role> in two days. Responding to the spiraling tensions, the <role id='role-10-Communicator'trigno='10'>U. S. State Department</role> <trigger id='trigger-10'>ordered</trigger> the departure of family members of <role id='role-10-Recipient'trigno='10'>American</role> staff at its embassy in Caracas. It also authorized voluntary departures for American staff, and issued a broad travel warning for U. S. citizens. Maduro — the anointed successor of firebrand leader <role id='role-33-Participant'trigno='33'><role id='role-33-Participant'trigno='33'>Hugo Chávez</role></role>, <role id='role-11-Victim'trigno='11'>who</role> <trigger id='trigger-11'>died</trigger> in 2013 — strongly defends the new assembly, <trigger id='trigger-33'>saying</trigger> it will fortify what he hails as “the communal state.” While it’s unclear exactly what he is seeking in a new constitution, it would likely give more power to “communal councils” in poor neighborhoods. Leaders of those councils, critics say, are government loyalists who in practice would sideline elected politicians and win direct pipelines to government funds. On the surface, the assembly vote, along with the government’s pseudo-Soviet speak, hark back to old-school Marxist regimes. But many here see something perhaps more <trigger id='trigger-12'>sinister</trigger> emerging — a 21st-century thugocracy that rules by <trigger id='trigger-35'>coercion</trigger>, extortion and violence. About 100 people have <trigger id='trigger-13'>died</trigger> in three months of anti-government street protests. <trigger id='trigger-14'>Arrests</trigger> of political activists have accelerated. Bands of pro-government toughs — known as <role id='role-15-Injurer'trigno='15'>colectivos</role> — roam poor neighborhoods, waving guns, intimidating protesters and journalists, <trigger id='trigger-15'>beating</trigger> opposition <role id='role-15-Victim'trigno='15'>politicians</role>, and warning locals to toe the government line. [How a new kind of protest movement has arisen in Venezuela] More than 7 million people voted against the establishment of the new assembly in an informal referendum July 16. Opposition parties are boycotting the election. In a country where the government is the largest employer, state workers say they are being ordered to vote Sunday, at the risk of losing their jobs. HIV patients say officials have <trigger id='trigger-16'>threatened</trigger> to cut off <role id='role-16-Recipient'trigno='16'>their</role> supplies of antiretroviral drugs if they do not turn out for the election. Families risk being scratched off government food distribution rosters for not showing up — a dire outcome in a country where a socialist experiment and economic mismanagement have sparked hyperinflation and food shortages. Such threats are not idle, either. Yanelis Banco, 36 years old and nearly nine months pregnant, said her boss at the government postal service called her in along with other department heads for a talk last week. He ordered them, she said, to sign a form pledging to vote Sunday. She and five other senior staffers refused. All of <role id='role-17-Employee'trigno='17'>them</role> <trigger id='trigger-17'>lost</trigger> their jobs, she said. “I’m a pregnant woman who has been working in the company for 10 years and four months, so I didn’t think they’d fire me,” she said. “Why do I have to sign if I don’t agree? I thought the law protected me!” She added: “All the other employees are terrified. Now they’re sure that if they don’t vote, they’ll be fired. None of them can afford that.” [Stuck in a death spiral, Venezuela is borrowing money at any cost] Maduro has acknowledged that <role id='role-18-Communicator'trigno='18'>the government</role> is <trigger id='trigger-18'>pressuring</trigger> public <role id='role-18-Recipient'trigno='18'>employees</role> to vote. At a rally with public energy workers this month, he said: “Take the lists of workers from all the state institutions and businesses to create a constituent committee. For each business, call all the workers and organize how they’ll vote on July 30th. At the end of the day, check the list. If there are 15, 000 workers, there have to be 15, 000 votes, with no excuses.” Venezuela’s political <trigger id='trigger-19'>protests</trigger> have been fueled by the disastrous state of the economy, growing authoritarian rule and <role id='role-19-Target'trigno='19'>the government</role>’s resistance to early elections. The country’s electoral council ruled against the opposition when it sought a referendum in 2016 that could have cut short Maduro’s six-year term. The council also pushed back elections for governors, scheduled for 2016, to December of this year. Critics fear that the new assembly will cancel those, as well as the presidential election in 2018. The U. S. Treasury Department in February froze Vice President Tareck El Aissami’s American assets over his alleged involvement in narcotics trafficking and took similar action against eight justices of the pro-government supreme court after it tried to strip power from the opposition-led legislature. On Wednesday, the Trump administration targeted 13 more Venezuelan <role id='role-0-Perpetrator'trigno='0'>officials</role>, alleging <trigger id='trigger-0'>violations</trigger> of human rights and corruption. [Trump administration hits 13 Venezuelans with sanctions in advance of vote] Once the richest country per capita in South America due to its vast oil reserves, Venezuela was also cursed with vast disparities that kept an elite in luxury while the poor languished in slums. The result was Chávez, who used the petroleum wealth to launch massive social programs, even as he concentrated power. He remains much beloved by millions of Venezuelans, although many others — especially in the middle and upper classes — loathe him. Maduro’s approval rating, on the other hand, is hovering around 20 percent, with opponents calling this weekend’s vote the only way for him to remain in the presidential palace. He has promised Venezuelans that the assembly will herald a new era of security and stability. “July 30th will be the birth of a historic trigger of the homeland for a new phase of peace and advancement,” Maduro told a campaign rally this week. Yet many Venezuelans fear just the opposite — a deepening of official repression. It is already starting, they say. Take, for instance, 51-year-old Lisbeth Añez, or “Mama Lis.” For years, she was known for aiding anti-government protesters, bringing them blankets and cooking them fresh arepas, or cornmeal cakes. In May, <role id='role-21-Defendant'trigno='21'><role id='role-20-Detainee'trigno='20'>she</role></role> was <trigger id='trigger-20'>arrested</trigger> and <trigger id='trigger-21'>charged</trigger> with treason. Her case is in the hands of a military tribunal. In recent months, scores of civilians <role id='role-23-Defendant'trigno='23'><role id='role-22-Demonstrator'trigno='22'>who</role></role> have taken part in <trigger id='trigger-22'>demonstrations</trigger> or other perceived anti-<role id='role-22-Target'trigno='22'>government</role> acts have been <trigger id='trigger-23'>sent</trigger> into the military <role id='role-23-JudgeCourt'trigno='23'>court</role> system, where <role id='role-24-Defendant'trigno='24'>they</role> can face lengthy prison <trigger id='trigger-24'>sentences</trigger>. “I can’t sleep, I can’t eat, even if we had enough food,” said her son, Luis González Añez, 23, who said he was refused entry to <role id='role-25-Defendant'trigno='25'>her</role> <trigger id='trigger-25'>trial</trigger>. “I have nightmares, thinking about her in jail. . . I didn’t think things could get worse, but they have.” <role id='role-29-Communicator'trigno='29'>Gabriela Ramírez</role>, Venezuela’s former public ombudsman and a longtime Chávez supporter, <trigger id='trigger-29'>said</trigger> she feared the government would become worse than a dictatorship. “We will have a narco-authoritarian regime,” she said. Ramírez, who carries around a pocket version of Chávez’s 1999 constitution in her purse, is among the ranks of former “Chavistas” — or Chávez backers — who have turned against Maduro. She has paid for it with harassment, she said, including a recent hack in which intimate photos of her and her husband were leaked on social media. “There will no longer be any check on their power,” she said. “They will control everything.” Following an opposition-called 48-hour strike, <role id='role-30-Communicator'trigno='30'>the government</role> on Thursday issued a <trigger id='trigger-30'>ban</trigger> on public gatherings and protests lasting from Friday through Tuesday. The <role id='role-31-Communicator'trigno='31'>opposition</role> responded by calling for nationwide mobilization, <trigger id='trigger-31'>asking</trigger> <role id='role-31-Recipient'trigno='31'>citizens</role> to <trigger id='trigger-26'>take</trigger> to the streets from the Caribbean Sea to the Andes Mountains. In an interview, Freddy Guevara, an opposition leader and vice president of the National Assembly, played down the chances of any deal to suspend or cancel the vote. Former Spanish prime minister José Luis Rodríguez Zapatero is in Caracas, and has served as an intermediary between the government and opposition. Guevara denied reports that a deal had been offered to suspend the vote. “It is wishful thinking,” he said. “I am sure they are going forward with this scam, and that we are going to respond with pressure.” But even leading members of the opposition appear to be losing hope that Maduro will back down. Scenarios for what happens next range widely. Some observers suggest that social unrest and international sanctions will worsen, prompting, perhaps, a military coup or fueling an anti-government guerrilla movement. Others say the government, likely with the aid of Russia and China, will somehow manage to hold on as the country becomes an international pariah. Still others see a worst-case scenario of social implosion and anarchy. “Somalia,” <trigger id='trigger-32'>said</trigger> <role id='role-32-Participant'trigno='32'><role id='role-32-Participant'trigno='32'>Henrique Capriles</role></role>, an opposition leader and governor of the state of Miranda. “We could become a failed state.” Mariana Zuñiga contributed to this report. Read more Things are so bad in Venezuela that people are rationing toothpaste Venezuela’s paradox: people are hungry, but farmers can’t feed them Maduro wants to rewrite the constitution. That’s rocket fuel on the fire. Today’s coverage from Post correspondents around the world Like Washington Post World on Facebook and stay updated on foreign news
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "scenario_en_62-E2", "text": "violations", "offset": 1258, "length": 1, "template": "[Perpetrator] committed a crime against [Victim] at [Place] place", "role_text_map": [{"role": "Perpetrator", "token": {"text": "officials", "offset": 1255, "length": 1}}, {"role": "Victim", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E1", "text": "obliging", "offset": 87, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "They", "offset": 84, "length": 1}}, {"role": "Recipient", "token": {"text": "us", "offset": 88, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E3", "text": "fire", "offset": 118, "length": 1, "template": "[Employee] stopped working in [Position] position at [PlaceOfEmployment] organization in [Place] place", "role_text_map": [{"role": "Employee", "token": {"text": "us", "offset": 119, "length": 1}}, {"role": "PlaceOfEmployment", "token": null}, {"role": "Position", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E4", "text": "curbed", "offset": 175, "length": 1, "template": "[Impeder] impeded or interfered with [ImpededEvent] event at [Place] place", "role_text_map": [{"role": "Impeder", "token": {"text": "Government", "offset": 167, "length": 1}}, {"role": "ImpededEvent", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E5", "text": "in", "offset": 190, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "prisoners", "offset": 188, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "jail", "offset": 191, "length": 1}}]}, {"event_id": "scenario_en_62-E6", "text": "clash", "offset": 247, "length": 1, "template": "[Demonstrator] was in a demonstration involving violence for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": {"text": "Protesters", "offset": 246, "length": 1}}, {"role": "Regulator", "token": {"text": "security forces", "offset": 250, "length": 2}}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E7", "text": "arrested", "offset": 257, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "security forces", "offset": 250, "length": 2}}, {"role": "Detainee", "token": {"text": "Protesters", "offset": 246, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E8", "text": "march", "offset": 304, "length": 1, "template": "[Demonstrator] was in a demonstration for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": {"text": "supporters", "offset": 298, "length": 1}}, {"role": "Regulator", "token": null}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E9", "text": "slaying", "offset": 421, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "demonstrators", "offset": 425, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "the government", "offset": 410, "length": 2}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "scenario_en_62-E10", "text": "protests", "offset": 408, "length": 1, "template": "[Demonstrator] was in a demonstration for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": null}, {"role": "Regulator", "token": null}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": {"text": "the government", "offset": 410, "length": 2}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E11", "text": "ordered", "offset": 443, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "U.S. State Department", "offset": 437, "length": 6}}, {"role": "Recipient", "token": {"text": "American", "offset": 450, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E12", "text": "died", "offset": 492, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "who", "offset": 491, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "scenario_en_62-E13", "text": "sinister", "offset": 607, "length": 1, "template": "[Perpetrator] committed a crime against [Victim] at [Place] place", "role_text_map": [{"role": "Perpetrator", "token": null}, {"role": "Victim", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E14", "text": "died", "offset": 628, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": null}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "scenario_en_62-E15", "text": "Arrests", "offset": 639, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E16", "text": "beating", "offset": 669, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "politicians", "offset": 671, "length": 1}}, {"role": "Injurer", "token": {"text": "colectivos", "offset": 655, "length": 1}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E17", "text": "threatened", "offset": 757, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": null}, {"role": "Recipient", "token": {"text": "their", "offset": 761, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E18", "text": "lost", "offset": 879, "length": 1, "template": "[Employee] stopped working in [Position] position at [PlaceOfEmployment] organization in [Place] place", "role_text_map": [{"role": "Employee", "token": {"text": "them", "offset": 878, "length": 1}}, {"role": "PlaceOfEmployment", "token": null}, {"role": "Position", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E19", "text": "pressuring", "offset": 1005, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "the government", "offset": 1002, "length": 2}}, {"role": "Recipient", "token": {"text": "employees", "offset": 1007, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E20", "text": "protests", "offset": 1099, "length": 1, "template": "[Demonstrator] was in a demonstration for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": null}, {"role": "Regulator", "token": null}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": {"text": "the government", "offset": 1115, "length": 2}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E21", "text": "arrested", "offset": 1518, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "she", "offset": 1516, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E22", "text": "charged", "offset": 1520, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "she", "offset": 1516, "length": 1}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E23", "text": "demonstrations", "offset": 1547, "length": 1, "template": "[Demonstrator] was in a demonstration for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": {"text": "who", "offset": 1542, "length": 1}}, {"role": "Regulator", "token": null}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": {"text": "government", "offset": 1553, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E24", "text": "sent", "offset": 1557, "length": 1, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "who", "offset": 1542, "length": 1}}, {"role": "JudgeCourt", "token": {"text": "court", "offset": 1561, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E25", "text": "sentences", "offset": 1570, "length": 1, "template": "[JudgeCourt] court or judge sentenced [Defendant] for [Crime] crime to [Sentence] sentence in [Place] place", "role_text_map": [{"role": "JudgeCourt", "token": null}, {"role": "Defendant", "token": {"text": "they", "offset": 1565, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Sentence", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E26", "text": "trial", "offset": 1611, "length": 1, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "her", "offset": 1610, "length": 1}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E27", "text": "take", "offset": 1813, "length": 1, "template": "[Demonstrator] was in a demonstration for [Topic] topic with [VisualDisplay] visual display against [Target] at [Place] place, with potential involvement of [Regulator] police or military", "role_text_map": [{"role": "Demonstrator", "token": null}, {"role": "Regulator", "token": null}, {"role": "VisualDisplay", "token": null}, {"role": "Topic", "token": null}, {"role": "Target", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E28", "text": "begging", "offset": 3, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "Government", "offset": 0, "length": 1}}, {"role": "Recipient", "token": {"text": "Venezuelans", "offset": 4, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E29", "text": "ultimatum", "offset": 50, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "their", "offset": 52, "length": 1}}, {"role": "Recipient", "token": {"text": "he", "offset": 41, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E30", "text": "said", "offset": 1656, "length": 1, "template": "[Communicator] communicated to [Recipient] about [Topic] topic using [Instrument] at [Place] place (one-way communication)", "role_text_map": [{"role": "Communicator", "token": {"text": "Gabriela Ram\u00edrez", "offset": 1641, "length": 2}}, {"role": "Recipient", "token": null}, {"role": "Instrument", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E31", "text": "ban", "offset": 1789, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "the government", "offset": 1783, "length": 2}}, {"role": "Recipient", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E32", "text": "asking", "offset": 1810, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "opposition", "offset": 1802, "length": 1}}, {"role": "Recipient", "token": {"text": "citizens", "offset": 1811, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E33", "text": "said", "offset": 2029, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Henrique Capriles", "offset": 2030, "length": 2}}, {"role": "Participant", "token": {"text": "Henrique Capriles", "offset": 2030, "length": 2}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E34", "text": "saying", "offset": 502, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Hugo Ch\u00e1vez", "offset": 488, "length": 2}}, {"role": "Participant", "token": {"text": "Hugo Ch\u00e1vez", "offset": 488, "length": 2}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "scenario_en_62-E35", "text": "arrest", "offset": 234, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "house", "offset": 233, "length": 1}}]}, {"event_id": "scenario_en_62-E36", "text": "coercion", "offset": 618, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": null}, {"role": "Recipient", "token": null}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #eee;
      display: flex;
    }

    .template-map {
      border: 1px solid gray;
      padding: 5px;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
    }

    role {
      display: inline;
    }

    .highlight-trigger {
      background-color: lightgoldenrodyellow;
    }

    .highlight-role {
      background-color: lightblue;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num_set = new Set();

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_map = function () {
      return $('<div class="template-map">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_map();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function () {
      make_trigger();
      recoverUserInput();
    };

    var make_trigger = function () {
      /* highlight trigger within document */

      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');

      page_num_set.forEach(trigger_num => {
        // highlight trigger
        $('#trigger-' + trigger_num).addClass('highlight-trigger');
        $('role[trigno=' + trigger_num + ']').addClass('highlight-role');
      })

      /* update bootstrap questions */
      //$('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function () {
      const templateArea = $('#template-area');
      // simply swap out the input area DOM element!
      templateArea.empty()
      
      page_num_set.forEach(trigger_num => {
        templateArea.append(template_record[trigger_num]);
      });
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num_set.has(parseInt(button.getAttribute('page-no'))))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          const pageno = parseInt(this.getAttribute("page-no"));
          // toggle button
          if (button.classList.contains('btn-default'))
            page_num_set.add(pageno);
          else
            page_num_set.delete(pageno);
          makeDom();
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    var clear_button = document.createElement("button");
    clear_button.setAttribute("type", "button");
    clear_button.setAttribute("class", "btn btn-default");
    clear_button.innerHTML = "Clear Triggers";
    clear_button.onclick = function () {
      page_num_set.clear();
      makeDom();
      show();
    }
    document.getElementById('button-bar').appendChild(clear_button);

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>