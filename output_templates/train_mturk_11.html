<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Deadly <trigger id='trigger-0'>Attacks</trigger> in Western <role id='role-0-Place'trigno='0'>Europe</role> Since 2014 AMSTERDAM, THE NETHERLANDS â€” Police say there are an unspecified number of <trigger id='trigger-1'>casualties</trigger> including police <role id='role-1-Victim'trigno='1'>officers</role> in a"terrorist <trigger id='trigger-2'>incident</trigger>"close to the <role id='role-2-Place'trigno='2'>British</role> parliament in London. Eyewitnesses say a <role id='role-5-Instrument'trigno='5'>car</role> <trigger id='trigger-5'>crashed</trigger> into <role id='role-5-Target'trigno='5'>pedestrians</role> on nearby Westminster bridge before an <role id='role-4-Target'trigno='4'><role id='role-3-Attacker'trigno='3'>assailant</role></role> <trigger id='trigger-3'>stabbed</trigger> a <role id='role-3-Target'trigno='3'>policeman</role> and was <trigger id='trigger-4'>shot</trigger> by <role id='role-4-Attacker'trigno='4'>police</role> outside the parliament building. Two people were <trigger id='trigger-6'>killed</trigger>, according to Sky News, including a police <role id='role-6-Victim'trigno='6'>officer</role>. March 18, 2017-A man attempts to snatch gun from female soldier on patrol at Orly airport south of Paris; <role id='role-8-Attacker'trigno='8'><role id='role-7-Victim'trigno='7'>man</role></role>, who interior ministry spokesman says had earlier <trigger id='trigger-8'>fired</trigger> a potshot at <role id='role-8-Target'trigno='8'>police</role> during an identity check before fleeing, is <trigger id='trigger-7'>shot</trigger> dead in the Orly incident by other <role id='role-7-Killer'trigno='7'>members</role> of soldier patrol unit. Travelers wait outside the Orly airport, south of Paris, March, 18, 2017. A <role id='role-9-Victim'trigno='9'>man</role> was <trigger id='trigger-9'>shot</trigger> to death after trying to seize the weapon of a soldier guarding Paris'Orly Airport. Feb. 3, 2017-A <role id='role-10-Instrument'trigno='10'>machete</role>-wielding <role id='role-10-Attacker'trigno='10'>man</role>, shouting"Allahu Akbar"(God is greatest), <trigger id='trigger-10'>attacked</trigger> <role id='role-10-Target'trigno='10'>soldiers</role> in a shopping <role id='role-10-Place'trigno='10'>mall</role> on the edge of the Louvre museum in Paris; <role id='role-12-Victim'trigno='12'><role id='role-11-Target'trigno='11'>he</role></role> is <trigger id='trigger-11'>shot</trigger> and seriously <trigger id='trigger-12'>wounded</trigger> by <role id='role-12-Injurer'trigno='12'><role id='role-11-Attacker'trigno='11'>soldiers</role></role>. Security sources in Cairo identified the man as Abdullah Reda al-Hamamy, born in Dakahlia, a province northeast of Cairo. French police, soldiers and firefighters are seen in front of the street entrance of the Carrousel du Louvre in Paris, France, Feb. 3, 2017. Dec. 19, 2016-A <role id='role-13-Instrument'trigno='13'>truck</role> <trigger id='trigger-13'>ploughs</trigger> into a crowded Christmas <role id='role-13-Target'trigno='13'>market</role> in central <role id='role-13-Place'trigno='13'>Berlin</role>, <trigger id='trigger-14'>killing</trigger> 12 <role id='role-14-Victim'trigno='14'>people</role> and <trigger id='trigger-15'>injuring</trigger> <role id='role-15-Victim'trigno='15'>48</role>. German Chancellor Angela Merkel says authorities are assuming it was a terrorist attack. A truck is seen near the Christmas market in Berlin, Germany Dec. 19, 2016. July 26, 2016-Two <role id='role-18-Victim'trigno='18'><role id='role-17-Injurer'trigno='17'><role id='role-16-Killer'trigno='16'>attackers</role></role></role> <trigger id='trigger-16'>kill</trigger> a <role id='role-16-Victim'trigno='16'>priest</role> with a blade and seriously <trigger id='trigger-17'>wound</trigger> another <role id='role-17-Victim'trigno='17'>hostage</role> in a church in northern France before being shot <trigger id='trigger-18'>dead</trigger> by French <role id='role-18-Killer'trigno='18'>police</role>. Five people are initially taken hostage. French President Francois Hollande says the two hostage-takers had pledged allegiance to Islamic State. Police and rescue workers stand at the scene after two assailants had taken five people hostage in the church at Saint-Etienne-du-Rouvray near Rouen in Normandy, France, July 26, 2016. A <role id='role-19-Attacker'trigno='19'>patient</role> <trigger id='trigger-19'>shoots</trigger> at a <role id='role-19-Target'trigno='19'>doctor</role> in a university <role id='role-19-Place'trigno='19'>clinic</role> in Steglitz, a southwestern district of Berlin, before <trigger id='trigger-20'>shooting</trigger> <role id='role-20-Killer'trigno='20'><role id='role-20-Victim'trigno='20'>himself</role></role>. German police say there is no sign of a link to terrorism. July 24, 2016-A 21-year-old Syrian <role id='role-23-Injurer'trigno='23'><role id='role-22-Killer'trigno='22'><role id='role-21-Detainee'trigno='21'>refugee</role></role></role> is <trigger id='trigger-21'>arrested</trigger> after <trigger id='trigger-22'>killing</trigger> a pregnant <role id='role-22-Victim'trigno='22'>woman</role> and <trigger id='trigger-23'>wounding</trigger> two <role id='role-23-Victim'trigno='23'>people</role> with a <role id='role-23-Instrument'trigno='23'>machete</role> in the southwestern German city of Reutlingen, near Stuttgart."Given the current evidence, there is no indication that this was a terrorist attack,"police say. A special police officer examines the scene after an <trigger id='trigger-24'>explosion</trigger> occurred in <role id='role-24-Place'trigno='24'>Ansbach</role>, Germany, Monday, July 25, 2016. A Syrian <role id='role-25-Injurer'trigno='25'>man</role> <trigger id='trigger-25'>wounds</trigger> 15 <role id='role-25-Victim'trigno='25'>people</role> when <role id='role-26-Attacker'trigno='26'>he</role> <trigger id='trigger-26'>blows</trigger> himself up outside a music festival in <role id='role-26-Place'trigno='26'>Ansbach</role> in southern Germany. <role id='role-27-Attacker'trigno='27'>Islamic</role> State claims responsibility for the <trigger id='trigger-27'>attack</trigger>. The 27-year-old arrived in Germany two years ago and claimed asylum. He had been in trouble with the police repeatedly for drug-taking and other offences and had faced deportation to Bulgaria. July 22, 2016-An 18-year-old German-Iranian <role id='role-28-Attacker'trigno='28'>gunman</role> apparently acting alone <trigger id='trigger-28'>kills</trigger> at least nine <role id='role-28-Target'trigno='28'>people</role> in Munich. The teenager had no Islamist ties but was obsessed with mass killings. The <trigger id='trigger-29'>attack</trigger> was carried out on the fifth anniversary of twin <trigger id='trigger-30'>attacks</trigger> by Norwegian mass murderer <role id='role-30-Attacker'trigno='30'>Anders</role> Breivik that killed 77 <role id='role-30-Target'trigno='30'>people</role>. Police secures the area of a subway station Karlsplatz (Stachus) near a shopping <role id='role-31-Place'trigno='31'>mall</role> following a <trigger id='trigger-31'>shooting</trigger> on July 22, 2016 in Munich. July 18, 2016-A 17-year-old Afghan <role id='role-34-Target'trigno='34'><role id='role-33-Injurer'trigno='33'><role id='role-32-Attacker'trigno='32'>refugee</role></role></role> wielding an <role id='role-32-Instrument'trigno='32'>axe</role> and a knife <trigger id='trigger-32'>attacks</trigger> <role id='role-32-Target'trigno='32'>passengers</role> on a train in southern <role id='role-32-Place'trigno='32'>Germany</role>, severely <trigger id='trigger-33'>wounding</trigger> <role id='role-33-Victim'trigno='33'>four</role>, before being <trigger id='trigger-34'>shot</trigger> dead by <role id='role-34-Attacker'trigno='34'>police</role>. Islamic State claimed responsibility for the attack. German emergency services workers work in the area where a <role id='role-35-Attacker'trigno='35'>man</role> with an <role id='role-35-Instrument'trigno='35'>ax</role> <trigger id='trigger-35'>attacked</trigger> <role id='role-35-Target'trigno='35'>passengers</role> on a train near the city of Wuerzburg, July 19, 2016. July 14, 2016-A <role id='role-38-Injurer'trigno='38'><role id='role-37-Killer'trigno='37'><role id='role-36-Attacker'trigno='36'>gunman</role></role></role> <trigger id='trigger-36'>drives</trigger> <role id='role-36-Instrument'trigno='36'>a</role> heavy truck into a <role id='role-36-Target'trigno='36'>crowd</role> celebrating Bastille Day in the French city of <role id='role-36-Place'trigno='36'>Nice</role>, <trigger id='trigger-37'>killing</trigger> 86 <role id='role-37-Victim'trigno='37'>people</role> and <trigger id='trigger-38'>injuring</trigger> scores <role id='role-38-Victim'trigno='38'>more</role> in an attack claimed by Islamic State. The attacker is identified as a Tunisian-born Frenchman. Bodies are seen on the ground after a <role id='role-39-Instrument'trigno='39'>truck</role> <trigger id='trigger-39'>ran</trigger> into a <role id='role-39-Target'trigno='39'>crowd</role> in <role id='role-39-Place'trigno='39'>Nice</role>, France during a celebration for the Bastille Day national holiday, July 14, 2016. June 14, 2016-A <role id='role-41-Attacker'trigno='41'><role id='role-40-Attacker'trigno='40'>Frenchman</role></role> of Moroccan origin <trigger id='trigger-40'>stabs</trigger> a police <role id='role-40-Target'trigno='40'>commander</role> to death outside his home in a Paris suburb and <trigger id='trigger-41'>kills</trigger> his <role id='role-41-Target'trigno='41'>partner</role>, who also worked for the police. The attacker told police negotiators during a siege that he was answering an appeal by Islamic State. March 22, 2016-Three Islamic State suicide <role id='role-43-Killer'trigno='43'><role id='role-42-Attacker'trigno='42'>bombers</role></role>, all Belgian nationals, <trigger id='trigger-42'>blow</trigger> themselves up at <role id='role-42-Target'trigno='42'>Brussels</role> airport and in a metro train in the Belgian capital, <trigger id='trigger-43'>killing</trigger> 32 <role id='role-43-Victim'trigno='43'>people</role>. Police find links with the November attacks in Paris. An <trigger id='trigger-44'>injured</trigger> <role id='role-44-Victim'trigno='44'>woman</role> looks on as another speaks on her mobile phone following twin <trigger id='trigger-45'>blasts</trigger> at <role id='role-45-Target'trigno='45'>Brussels</role> airport in <role id='role-45-Place'trigno='45'>Zaventem</role>, Belgium, March 22, 2016. Nov. 13, 2015-Paris is rocked by multiple, near simultaneous gun-and-bomb <trigger id='trigger-46'>attacks</trigger> on entertainment <role id='role-46-Target'trigno='46'>sites</role> around the city, in which 130 <role id='role-47-Victim'trigno='47'>people</role> <trigger id='trigger-47'>die</trigger> and <role id='role-48-Victim'trigno='48'>368</role> are <trigger id='trigger-48'>wounded</trigger>. Islamic State claims responsibility. Two of the 10 known perpetrators were Belgian citizens and three others were French. Victims lay on the pavement in a Paris restaurant, Nov. 13, 2015. Jan. 7-9, 2015-Two Islamist militants break into an editorial meeting of satirical weekly Charlie Hebdo on Jan. 7 and rake it with bullets, <trigger id='trigger-49'>killing</trigger> <role id='role-49-Victim'trigno='49'>17</role>. Another <role id='role-50-Attacker'trigno='50'>militant</role> <trigger id='trigger-50'>kills</trigger> a <role id='role-50-Target'trigno='50'>policewoman</role> the next day and takes hostages at a supermarket on Jan. 9, <trigger id='trigger-51'>killing</trigger> <role id='role-51-Victim'trigno='51'>four</role> before <role id='role-52-Attacker'trigno='52'>police</role> <trigger id='trigger-52'>shoot</trigger> <role id='role-52-Target'trigno='52'>him</role> dead. The attacks prompt a worldwide solidarity movement with the slogan"Je Suis Charlie"(I am Charlie). An <trigger id='trigger-53'>injured</trigger> <role id='role-53-Victim'trigno='53'>person</role> is evacuated outside the French satirical newspaper Charlie Hebdo's office, in Paris, Jan. 7, 2015. May 24, 2014-Four <role id='role-55-Victim'trigno='55'><role id='role-54-Target'trigno='54'>people</role></role> are <trigger id='trigger-55'>killed</trigger> in a <trigger id='trigger-54'>shooting</trigger> at the <role id='role-54-Place'trigno='54'>Jewish</role> Museum in central Brussels. The attacker was French national <role id='role-56-Detainee'trigno='56'>Mehdi</role> Nemmouche, 29, who was subsequently <trigger id='trigger-56'>arrested</trigger> in Marseille, France. Extradited, he is awaiting trial in Belgium. 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E1", "text": "Attacks", "offset": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Europe", "offset": 4}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E2", "text": "casualties", "offset": 20, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "officers", "offset": 23}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E3", "text": "incident", "offset": 28, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "British parliament", "offset": 33}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E5", "text": "stabbed", "offset": 52, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "assailant", "offset": 51}}, {"role": "Target", "token": {"text": "policeman", "offset": 54}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E4", "text": "shot", "offset": 57, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "police", "offset": 59}}, {"role": "Target", "token": {"text": "assailant", "offset": 51}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E6", "text": "crashed", "offset": 42, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "pedestrians", "offset": 44}}, {"role": "Instrument", "token": {"text": "car", "offset": 41}}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E7", "text": "killed", "offset": 68, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "officer", "offset": 78}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E8", "text": "shot", "offset": 125, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "man", "offset": 103}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "members", "offset": 133}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E9", "text": "fired", "offset": 112, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "man", "offset": 103}}, {"role": "Target", "token": {"text": "police", "offset": 116}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E10", "text": "shot", "offset": 159, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "man", "offset": 157}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E11", "text": "attacked", "offset": 200, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "man", "offset": 187}}, {"role": "Target", "token": {"text": "soldiers", "offset": 201}}, {"role": "Instrument", "token": {"text": "machete", "offset": 184}}, {"role": "Place", "token": {"text": "mall", "offset": 205}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E12", "text": "shot", "offset": 218, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "soldiers", "offset": 223}}, {"role": "Target", "token": {"text": "he", "offset": 216}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E13", "text": "wounded", "offset": 221, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "he", "offset": 216}}, {"role": "Injurer", "token": {"text": "soldiers", "offset": 223}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E14", "text": "ploughs", "offset": 287, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "market", "offset": 292}}, {"role": "Instrument", "token": {"text": "truck", "offset": 286}}, {"role": "Place", "token": {"text": "Berlin", "offset": 295}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E15", "text": "killing", "offset": 297, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 299}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E16", "text": "injuring", "offset": 301, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "48", "offset": 302}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E17", "text": "kill", "offset": 343, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "priest", "offset": 345}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "attackers", "offset": 342}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E18", "text": "wound", "offset": 351, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "hostage", "offset": 353}}, {"role": "Injurer", "token": {"text": "attackers", "offset": 342}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E19", "text": "dead", "offset": 363, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "attackers", "offset": 342}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "police", "offset": 366}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E20", "text": "shoots", "offset": 433, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "patient", "offset": 432}}, {"role": "Target", "token": {"text": "doctor", "offset": 436}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "clinic", "offset": 440}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E21", "text": "shooting", "offset": 451, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "himself", "offset": 452}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "himself", "offset": 452}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E22", "text": "arrested", "offset": 481, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "refugee", "offset": 479}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E23", "text": "killing", "offset": 483, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "woman", "offset": 486}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "refugee", "offset": 479}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E24", "text": "wounding", "offset": 488, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 490}}, {"role": "Injurer", "token": {"text": "refugee", "offset": 479}}, {"role": "Instrument", "token": {"text": "machete", "offset": 493}}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E25", "text": "explosion", "offset": 535, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Ansbach", "offset": 538}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E26", "text": "wounds", "offset": 552, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 554}}, {"role": "Injurer", "token": {"text": "man", "offset": 551}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E27", "text": "blows", "offset": 557, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "he", "offset": 556}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Ansbach", "offset": 565}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E28", "text": "attack", "offset": 576, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Islamic State", "offset": 570}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E29", "text": "kills", "offset": 635, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "gunman", "offset": 631}}, {"role": "Target", "token": {"text": "people", "offset": 639}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E30", "text": "attack", "offset": 657, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E31", "text": "attacks", "offset": 667, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Anders Breivik", "offset": 672}}, {"role": "Target", "token": {"text": "people", "offset": 677}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E32", "text": "shooting", "offset": 697, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "mall", "offset": 694}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E33", "text": "attacks", "offset": 725, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "refugee", "offset": 718}}, {"role": "Target", "token": {"text": "passengers", "offset": 726}}, {"role": "Instrument", "token": {"text": "axe", "offset": 721}}, {"role": "Place", "token": {"text": "Germany", "offset": 732}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E34", "text": "wounding", "offset": 735, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "four", "offset": 736}}, {"role": "Injurer", "token": {"text": "refugee", "offset": 718}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E35", "text": "shot", "offset": 740, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "police", "offset": 743}}, {"role": "Target", "token": {"text": "refugee", "offset": 718}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E36", "text": "attacked", "offset": 767, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "man", "offset": 763}}, {"role": "Target", "token": {"text": "passengers", "offset": 768}}, {"role": "Instrument", "token": {"text": "ax", "offset": 766}}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E37", "text": "drives", "offset": 790, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "gunman", "offset": 789}}, {"role": "Target", "token": {"text": "crowd", "offset": 796}}, {"role": "Instrument", "token": {"text": "a heavy truck", "offset": 791}}, {"role": "Place", "token": {"text": "Nice", "offset": 805}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E38", "text": "killing", "offset": 807, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 809}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "gunman", "offset": 789}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E39", "text": "injuring", "offset": 811, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "more", "offset": 813}}, {"role": "Injurer", "token": {"text": "gunman", "offset": 789}}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E40", "text": "ran", "offset": 842, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "crowd", "offset": 845}}, {"role": "Instrument", "token": {"text": "truck", "offset": 841}}, {"role": "Place", "token": {"text": "Nice", "offset": 847}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E41", "text": "stabs", "offset": 875, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Frenchman", "offset": 871}}, {"role": "Target", "token": {"text": "commander", "offset": 878}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E42", "text": "kills", "offset": 889, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Frenchman", "offset": 871}}, {"role": "Target", "token": {"text": "partner", "offset": 891}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E43", "text": "blow", "offset": 933, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "bombers", "offset": 927}}, {"role": "Target", "token": {"text": "Brussels airport", "offset": 937}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E44", "text": "killing", "offset": 949, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 951}}, {"role": "Place", "token": null}, {"role": "Killer", "token": {"text": "bombers", "offset": 927}}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E45", "text": "injured", "offset": 964, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "woman", "offset": 965}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E46", "text": "blasts", "offset": 977, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "Brussels airport", "offset": 979}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Zaventem", "offset": 982}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E47", "text": "attacks", "offset": 1010, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "sites", "offset": 1013}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E48", "text": "die", "offset": 1022, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 1021}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E49", "text": "wounded", "offset": 1026, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "368", "offset": 1024}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E50", "text": "killing", "offset": 1095, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "17", "offset": 1096}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E51", "text": "kills", "offset": 1100, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "militant", "offset": 1099}}, {"role": "Target", "token": {"text": "policewoman", "offset": 1102}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E52", "text": "killing", "offset": 1117, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "four", "offset": 1118}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E53", "text": "shoot", "offset": 1121, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "police", "offset": 1120}}, {"role": "Target", "token": {"text": "him", "offset": 1122}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E54", "text": "injured", "offset": 1147, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "person", "offset": 1148}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E55", "text": "shooting", "offset": 1182, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "people", "offset": 1177}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Jewish Museum", "offset": 1185}}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E56", "text": "killed", "offset": 1179, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 1177}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "61_VOA_EN_NW_2017.03.22.3777524-E57", "text": "arrested", "offset": 1204, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Mehdi Nemmouche", "offset": 1196}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>