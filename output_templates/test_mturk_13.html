<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      Thai <role id='role-0-Prosecutor'trigno='0'>Authorities</role> <trigger id='trigger-0'>Indict</trigger> <role id='role-0-Defendant'trigno='0'>2</role> Over August <role id='role-1-Place'trigno='1'>Shrine</role> <trigger id='trigger-1'>Attack</trigger> A Bangkok military <role id='role-2-Prosecutor'trigno='2'>court</role> has <trigger id='trigger-2'>indicted</trigger> two <role id='role-2-Defendant'trigno='2'>men</role> accused of carrying out the August 17 <trigger id='trigger-3'>bombing</trigger> at a popular <role id='role-3-Place'trigno='3'>shrine</role> that <trigger id='trigger-4'>killed</trigger> 20 <role id='role-4-Victim'trigno='4'>people</role>. The <role id='role-5-Prosecutor'trigno='5'>court</role> on Tuesday <trigger id='trigger-5'>indicted</trigger> Bilal Mohammed and <role id='role-5-Defendant'trigno='5'>Mieraili</role> Yusufu on 10 counts connected to the <trigger id='trigger-6'>blast</trigger>, including conspiracy to explode bombs and commit premeditated murder. Thailand authorities have not officially named the bombing of Erawan Shrine an act of terror, and accordingly neither suspect was charged specifically with terrorism. Police issued 17 arrest warrants following the <trigger id='trigger-38'>bombing</trigger> but only <role id='role-7-Detainee'trigno='7'>Bilal</role> and Mieraili have been <trigger id='trigger-7'>detained</trigger>. They are described as ethnic Uighurs, a minority group based in China's Xinjiang region. <role id='role-8-Detainee'trigno='8'>They</role> have been held in custody since their <trigger id='trigger-8'>arrests</trigger> in late August and early September. Thai <role id='role-9-Participant'trigno='9'><role id='role-9-Participant'trigno='9'>officials</role></role> have <trigger id='trigger-9'>said</trigger> the <trigger id='trigger-10'>blast</trigger> was carried out by a people-smuggling <role id='role-10-Attacker'trigno='10'>gang</role> seeking revenge on Thai authorities for cracking down on their operation. The August 17 <trigger id='trigger-11'>blast</trigger> at the <role id='role-11-Place'trigno='11'>Erawan</role> Shrine-a popular tourist destination-was one of the most deadly acts of violence in Bangkok in decades, and left 20 <role id='role-12-Victim'trigno='12'>people</role> <trigger id='trigger-12'>dead</trigger> and more than <role id='role-13-Victim'trigno='13'>120</role> <trigger id='trigger-13'>injured</trigger>. Of the <trigger id='trigger-14'>dead</trigger>, <role id='role-14-Victim'trigno='14'>14</role> were tourists. The <trigger id='trigger-15'>attack</trigger> shocked the residents of the capital because of the apparent randomness, which drove home the point that no place is immune to acts of terror. <role id='role-39-Participant'trigno='39'><role id='role-39-Participant'trigno='39'>Authorities</role></role>, however, have <trigger id='trigger-39'>declined</trigger> to call it an act of terrorism out of apparent fear that it would hurt the country's huge tourism industry. <role id='role-18-Participant'trigno='18'><role id='role-18-Participant'trigno='18'>Police</role></role> initially appeared at first to be at a loss, but soon <trigger id='trigger-18'>claimed</trigger> success with a series of <trigger id='trigger-17'>raids</trigger> and two <trigger id='trigger-16'>arrests</trigger>. Arrest warrants have been issued for 15 others. The two suspects were brought to the court in handcuffs wearing brown prison garb. Members of the media were not allowed to enter the court and the <trigger id='trigger-19'>indictments</trigger> took place before the two <role id='role-20-PassengerArtifact'trigno='20'><role id='role-19-Defendant'trigno='19'>suspects</role></role> <trigger id='trigger-20'>arrived</trigger>, <trigger id='trigger-40'>said</trigger> defense lawyer <role id='role-40-Participant'trigno='40'><role id='role-40-Participant'trigno='40'>Chuchart</role></role> Kanpai. Doubts about motive Early speculation about the <trigger id='trigger-21'>bombing</trigger> had suggested it might be the work of Uighur separatists who were angry that <role id='role-22-Transporter'trigno='22'>Thailand</role> in July forcibly <trigger id='trigger-22'>repatriated</trigger> more than 100 <role id='role-22-PassengerArtifact'trigno='22'>Uighurs</role> to <role id='role-22-Destination'trigno='22'>China</role>, where it is feared they face persecution. The theory was bolstered by the fact that the Erawan Shrine is popular among Chinese tourists, who figured prominently among the <role id='role-23-Target'trigno='23'>victims</role> of the <trigger id='trigger-23'>bombing</trigger>. But Thai <role id='role-24-Participant'trigno='24'><role id='role-24-Participant'trigno='24'>officials</role></role> <trigger id='trigger-24'>reject</trigger> any political or religious motive, sticking to the theory that it was a revenge for disrupting a human-smuggling gang. Still, skepticism about the <role id='role-26-Participant'trigno='26'><role id='role-26-Participant'trigno='26'>police</role></role> <trigger id='trigger-26'>explanation</trigger> on the <role id='role-25-Place'trigno='25'>shrine</role> <trigger id='trigger-25'>attack</trigger> has abounded because of leaks, contradictions, misstatements and secrecy surrounding the investigation. The two <role id='role-27-Defendant'trigno='27'>suspects</role> are being <trigger id='trigger-27'>tried</trigger> at a military <role id='role-27-JudgeCourt'trigno='27'>court</role> on an army <role id='role-27-Place'trigno='27'>base</role> in Bangkok because cases of “national security” have been handled by the military since last May, when the army seized power in a coup from an elected government. Former National Police Chief <role id='role-28-Participant'trigno='28'><role id='role-28-Participant'trigno='28'>Somyot</role></role> Poomphanmuang <trigger id='trigger-28'>said</trigger> before his retirement in September that the case against the two suspects was supported by closed-circuit television footage, witnesses, DNA matching and physical evidence, in addition to their confessions. Security camera footage from the Erawan Shrine showed a man wearing a yellow T-shirt who sat down on a bench at the outdoor shrine, took off a black backpack and then left it behind as he stood up and walked away. Time stamps on closed circuit TV footage showed <role id='role-29-PassengerArtifact'trigno='29'>he</role> <trigger id='trigger-29'>left</trigger> the <role id='role-29-Origin'trigno='29'>shrine</role> just minutes before the <trigger id='trigger-30'>blast</trigger> occurred, during evening rush hour as the area in central Bangkok was filled with people. Police believe that Bilal is the yellow-shirted man who planted the bomb and <role id='role-31-Attacker'trigno='31'>Yusufu</role> is believed to have <trigger id='trigger-31'>detonated</trigger> the <role id='role-31-ExplosiveDevice'trigno='31'>bomb</role>. Bilal, was initially identified as Adem Karadag, which was the name on a fake Turkish passport in his possession when <role id='role-32-Detainee'trigno='32'>he</role> was <trigger id='trigger-32'>arrested</trigger> Aug. 29. <role id='role-33-Detainee'trigno='33'>He</role> was <trigger id='trigger-33'>arrested</trigger> at <role id='role-33-Place'trigno='33'>one</role> of two apartments <role id='role-33-Jailer'trigno='33'>police</role> raided on the outskirts of Bangkok. <role id='role-34-Detainee'trigno='34'>Yusufu</role> was <trigger id='trigger-34'>arrested</trigger> Sept. 1 near the Thai-Cambodia border, carrying a Chinese passport indicating he was from Xinjiang. <role id='role-35-Participant'trigno='35'><role id='role-35-Participant'trigno='35'>Police</role></role> <trigger id='trigger-35'>said</trigger> <role id='role-35-Topic'trigno='35'>his</role> DNA and fingerprints were found in both raided apartments, including on a container of gunpowder. <role id='role-36-Participant'trigno='36'><role id='role-36-Participant'trigno='36'>Police</role></role> <trigger id='trigger-36'>said</trigger> they have confessions from the two, and Bilal's lawyer says his client admitted planting the deadly bomb at the behest of another suspect who remains a fugitive. <role id='role-37-Participant'trigno='37'><role id='role-37-Participant'trigno='37'>He</role></role> <trigger id='trigger-37'>says</trigger> Bilal was induced to carry out the action by a promise that his emigration to Turkey would be expedited. Some material for this report came from AP. 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E1", "text": "Indict", "offset": 2, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": {"text": "Authorities", "offset": 1}}, {"role": "Defendant", "token": {"text": "2", "offset": 3}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E2", "text": "Attack", "offset": 7, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Shrine", "offset": 6}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E3", "text": "indicted", "offset": 13, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": {"text": "court", "offset": 11}}, {"role": "Defendant", "token": {"text": "men", "offset": 15}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E4", "text": "bombing", "offset": 23, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "shrine", "offset": 27}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E5", "text": "killed", "offset": 29, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 31}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E6", "text": "indicted", "offset": 37, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": {"text": "court", "offset": 34}}, {"role": "Defendant", "token": {"text": "Mieraili Yusufu", "offset": 41}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E7", "text": "blast", "offset": 49, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E8", "text": "detained", "offset": 102, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Bilal", "offset": 97}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E9", "text": "arrests", "offset": 130, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "They", "offset": 122}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E10", "text": "said", "offset": 141, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "officials", "offset": 139}}, {"role": "Participant", "token": {"text": "officials", "offset": 139}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E11", "text": "blast", "offset": 143, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "gang", "offset": 152}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E12", "text": "blast", "offset": 168, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Erawan Shrine", "offset": 171}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E13", "text": "dead", "offset": 197, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 196}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E14", "text": "injured", "offset": 202, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "120", "offset": 201}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E15", "text": "dead", "offset": 206, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "14", "offset": 208}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E16", "text": "attack", "offset": 213, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E17", "text": "arrests", "offset": 292, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E18", "text": "raids", "offset": 289, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E19", "text": "claimed", "offset": 283, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Police", "offset": 270}}, {"role": "Participant", "token": {"text": "Police", "offset": 270}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E20", "text": "indictments", "offset": 331, "template": "[Prosecutor] charged or indicted [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "suspects", "offset": 337}}, {"role": "JudgeCourt", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E21", "text": "arrived", "offset": 338, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "suspects", "offset": 337}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E22", "text": "bombing", "offset": 353, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E23", "text": "repatriated", "offset": 372, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "Thailand", "offset": 368}}, {"role": "PassengerArtifact", "token": {"text": "Uighurs", "offset": 376}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "China", "offset": 378}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E24", "text": "bombing", "offset": 413, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "victims", "offset": 410}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E25", "text": "reject", "offset": 418, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "officials", "offset": 417}}, {"role": "Participant", "token": {"text": "officials", "offset": 417}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E26", "text": "attack", "offset": 452, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "shrine", "offset": 451}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E27", "text": "explanation", "offset": 448, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "police", "offset": 447}}, {"role": "Participant", "token": {"text": "police", "offset": 447}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E28", "text": "tried", "offset": 473, "template": "[Prosecutor] tried [Defendant] before [JudgeCourt] court or judge for [Crime] crime in [Place] place", "role_text_map": [{"role": "Prosecutor", "token": null}, {"role": "Defendant", "token": {"text": "suspects", "offset": 470}}, {"role": "JudgeCourt", "token": {"text": "court", "offset": 477}}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "base", "offset": 481}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E29", "text": "said", "offset": 520, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Somyot Poomphanmuang", "offset": 518}}, {"role": "Participant", "token": {"text": "Somyot Poomphanmuang", "offset": 518}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E30", "text": "left", "offset": 610, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "he", "offset": 609}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "shrine", "offset": 612}}, {"role": "Destination", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E31", "text": "blast", "offset": 617, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E32", "text": "detonated", "offset": 655, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Yusufu", "offset": 650}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "bomb", "offset": 657}}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E33", "text": "arrested", "offset": 683, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "he", "offset": 681}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E34", "text": "arrested", "offset": 690, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "police", "offset": 696}}, {"role": "Detainee", "token": {"text": "He", "offset": 688}}, {"role": "Crime", "token": null}, {"role": "Place", "token": {"text": "one", "offset": 692}}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E35", "text": "arrested", "offset": 706, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Yusufu", "offset": 704}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E36", "text": "said", "offset": 728, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Police", "offset": 727}}, {"role": "Participant", "token": {"text": "Police", "offset": 727}}, {"role": "Topic", "token": {"text": "his", "offset": 729}}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E37", "text": "said", "offset": 748, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Police", "offset": 747}}, {"role": "Participant", "token": {"text": "Police", "offset": 747}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E38", "text": "says", "offset": 781, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "He", "offset": 780}}, {"role": "Participant", "token": {"text": "He", "offset": 780}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E39", "text": "bombing", "offset": 94, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E40", "text": "declined", "offset": 246, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Authorities", "offset": 241}}, {"role": "Participant", "token": {"text": "Authorities", "offset": 241}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "23_VOA_EN_NW_2015.11.24.3071320-E41", "text": "said", "offset": 340, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "Chuchart Kanpai", "offset": 343}}, {"role": "Participant", "token": {"text": "Chuchart Kanpai", "offset": 343}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>