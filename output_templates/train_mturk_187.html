<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      <role id='role-3-Attacker'trigno='3'>Manchester Bomber</role>’s <trigger id='trigger-3'>Blast</trigger> Felt on <role id='role-3-Place'trigno='3'>Street</role> Where He Grew Up MANCHESTER, ENGLAND — The British-born jihadist behind the worst terror <trigger id='trigger-2'>attack</trigger> in <role id='role-2-Place'trigno='2'>Britain</role> in more than a decade in effect <trigger id='trigger-1'>killed</trigger> and <trigger id='trigger-0'>maimed</trigger> <role id='role-1-Victim'trigno='1'><role id='role-0-Victim'trigno='0'>people</role></role> he’d grown up with — making the atrocity even more horrifying for Manchester residents still struggling to come to terms with a <trigger id='trigger-4'>bombing</trigger> that <trigger id='trigger-5'>killed</trigger> 22 <role id='role-5-Victim'trigno='5'>people</role> and <trigger id='trigger-6'>injured</trigger> 59 <role id='role-6-Victim'trigno='6'>others</role> at a <role id='role-4-Place'trigno='4'>concert</role> of American pop star Ariana Grande. As the British government raised the terrorist threat level to"critical"— only the second time authorities have done so — details began to emerge of the 22-year-old suicide bomber Salman Abedi, his Libyan paternity, and his alleged ties to a well-known recruiter for the Islamic State terror group and other known jihadists. <role id='role-7-PassengerArtifact'trigno='7'>He</role> only recently <trigger id='trigger-7'>returned</trigger> from a three-week trip to <role id='role-7-Origin'trigno='7'>Libya</role>, according to family members. British police <role id='role-24-Participant'trigno='24'><role id='role-24-Participant'trigno='24'>sources</role></role> <trigger id='trigger-24'>say</trigger> the <trigger id='trigger-9'>trip</trigger> raises the possibility <role id='role-9-PassengerArtifact'trigno='9'>he</role> may have <trigger id='trigger-8'>met</trigger> with <role id='role-8-Participant'trigno='8'><role id='role-8-Participant'trigno='8'>members</role></role> of the terror group’s affiliate in the North African country to plot the attack and to receive training. Known to police The portrait drawn of the mass killer who packed his <trigger id='trigger-25'>improvised</trigger> explosive <role id='role-25-Artifact'trigno='25'>device</role> with nails, nuts and bolts to maximize the slaughter, is a mixed one. Some <role id='role-26-Participant'trigno='26'><role id='role-26-Participant'trigno='26'>neighbors</role></role> <trigger id='trigger-26'>describe</trigger> <role id='role-26-Topic'trigno='26'>him</role> as a football-obsessed fan of Manchester United and keen enthusiast of computer games. <role id='role-27-Participant'trigno='27'><role id='role-27-Participant'trigno='27'>They</role></role> <trigger id='trigger-27'>insist</trigger> there were no signs the student <role id='role-27-Topic'trigno='27'>dropout</role> became radicalized. British security <role id='role-10-Participant'trigno='10'><role id='role-10-Participant'trigno='10'>services</role></role> <trigger id='trigger-10'>acknowledged</trigger> <role id='role-10-Topic'trigno='10'>Abedi</role> was known to them — there are some reports the intelligence <role id='role-11-Communicator'trigno='11'>service</role> may have tried to <trigger id='trigger-11'>persuade</trigger> <role id='role-11-Recipient'trigno='11'>him</role> to act as an informant — but they did not see him as a high risk. Others, though, describe a young man full of rage, who <trigger id='trigger-28'>denounced</trigger> a local mosque <role id='role-28-Participant'trigno='28'><role id='role-28-Participant'trigno='28'>leader</role></role> for his <role id='role-28-Topic'trigno='28'>criticism</role> of IS. <role id='role-29-Participant'trigno='29'><role id='role-29-Participant'trigno='29'>They</role></role> <trigger id='trigger-29'>say</trigger> <role id='role-29-Topic'trigno='29'>he</role> started to pray openly in the streets. A police officer stands outside Didsbury mosque in Manchester, May 24, 2017. A local imam, Mohammed Saeed, <trigger id='trigger-30'>told</trigger> British <role id='role-30-Participant'trigno='30'><role id='role-30-Participant'trigno='30'>newspapers</role></role> <role id='role-30-Topic'trigno='30'>Abedi</role> stopped attending his mosque in 2015 after they argued over IS. “Salman used to come to the mosque occasionally, he wasn’t particularly friendly towards me because he didn’t like my anti-IS sermons. He didn’t like what I was saying and showed me the face of hate. He came to the mosque less and less after that.” Son of Libyan emigres Abedi was born in Manchester in 1994, the third of four children, three boys and one girl. His <role id='role-15-PassengerArtifact'trigno='15'><role id='role-14-PassengerArtifact'trigno='14'>parents</role></role> were <role id='role-15-Origin'trigno='15'><role id='role-14-Origin'trigno='14'>Libyan</role></role> emigres who <trigger id='trigger-15'>found</trigger> a home in the northern English <role id='role-15-Destination'trigno='15'><role id='role-14-Destination'trigno='14'>city</role></role> after <trigger id='trigger-14'>fleeing</trigger> the Moammar Gadhafi regime in 1980. His father, <role id='role-16-PassengerArtifact'trigno='16'>Ramadan Abedi</role>, a former security guard at Manchester Airport, <trigger id='trigger-16'>returned</trigger> to <role id='role-16-Destination'trigno='16'>Libya</role> in 2011 to join the uprising against the Libyan autocrat. Since Gadhafi’s overthrow his parents spent more time in the North African country than in their home in south Manchester, less than two miles from the scene of Monday’s <trigger id='trigger-17'>bombing</trigger>. Police <role id='role-18-PassengerArtifact'trigno='18'>officers</role> <trigger id='trigger-18'>arrive</trigger> at a residential <role id='role-18-Destination'trigno='18'>property</role> on Elsmore Road in Fallowfield, Manchester, on May 24, 2017, as <trigger id='trigger-19'>investigations</trigger> continue into the May 22 terror <trigger id='trigger-31'>attack</trigger> at the Manchester Arena. Libyan <role id='role-32-Participant'trigno='32'><role id='role-32-Participant'trigno='32'>emigres</role></role> in Manchester <trigger id='trigger-32'>say</trigger> the bomber’s <role id='role-32-Topic'trigno='32'>father</role> had no time for jihadist ideology. “He was always very confrontational with jihadi ideology, and this ISIS thing isn’t even jihad, it’s criminality. The family will be devastated,” one <trigger id='trigger-20'>told</trigger> local <role id='role-20-Participant'trigno='20'><role id='role-20-Participant'trigno='20'>newspapers</role></role>. According to the Daily Mirror newspaper, Abedi was a family friend of Raphael Hostey, also known as Abu Qaqa al-Britani, who helped recruit other young Britons for Islamic State via social media until <role id='role-33-Victim'trigno='33'>he</role> was <trigger id='trigger-33'>killed</trigger> in a drone <trigger id='trigger-34'>strike</trigger> in <role id='role-34-Place'trigno='34'><role id='role-33-Place'trigno='33'>Syria</role></role> last year. British police <role id='role-21-Participant'trigno='21'><role id='role-21-Participant'trigno='21'>sources</role></role> <trigger id='trigger-21'>say</trigger> <role id='role-21-Topic'trigno='21'>his</role> ties to Hostey are being probed by counter-terror officials who fear Abedi may have been part of a terror cell, a concern heightened by a <trigger id='trigger-35'>trip</trigger> <role id='role-35-PassengerArtifact'trigno='35'>he</role> made to <role id='role-35-Destination'trigno='35'>Libya</role> in the run-up to the <trigger id='trigger-23'>bombing</trigger>. Police also remain skeptical that Abedi could have <trigger id='trigger-22'>built</trigger> the <role id='role-22-Artifact'trigno='22'>bomb</role> alone because of its sophistication. Radicalization Abedi attended local schools and then went on to study business and management at nearby Salford University. In a statement, a university <role id='role-36-Participant'trigno='36'><role id='role-36-Participant'trigno='36'>spokesman</role></role> <trigger id='trigger-36'>described</trigger> <role id='role-36-Topic'trigno='36'>him</role> as"completely off the radar. He turned up for lectures for two years and then just stopped coming.” A sign on the front door of a house reads"Stop Knocking On This Door-We Know Nothing About This Family!!"is pictured on Elsmore Road in Fallowfield, Manchester, on May 24, 2017. In the last year-and-half both Abedi and his older <role id='role-37-Participant'trigno='37'><role id='role-37-Participant'trigno='37'>brother</role></role>, 23-year-old Ismail, were active on social media sites, <trigger id='trigger-37'>praising</trigger> <role id='role-37-Topic'trigno='37'>jihadists</role>. <role id='role-38-Jailer'trigno='38'>Police</role> <trigger id='trigger-38'>arrested</trigger> <role id='role-38-Detainee'trigno='38'>Ismail</role> Monday night hours after the blast. <role id='role-39-TeacherTrainer'trigno='39'>He</role> <trigger id='trigger-39'>taught</trigger> Arabic classes at the Didsbury mosque and, according to locals, was reported to police after concerns were raised about what <role id='role-40-TeacherTrainer'trigno='40'>he</role> was <trigger id='trigger-40'>teaching</trigger>. <role id='role-41-Investigator'trigno='41'>Police</role> are also <trigger id='trigger-41'>probing</trigger> the links between the Abedi brothers and another British-Libyan from Manchester, <role id='role-43-Defendant'trigno='43'><role id='role-42-Defendant'trigno='42'><role id='role-41-Defendant'trigno='41'>Abdalraouf Abdallah</role></role></role>, who was <trigger id='trigger-43'>sentenced</trigger> to a nine-year-prison term after being <trigger id='trigger-42'>convicted</trigger> of funding terrorism and preparing acts of terrorism. Some <role id='role-44-Participant'trigno='44'><role id='role-44-Participant'trigno='44'>analysts</role></role> <trigger id='trigger-44'>argue</trigger> there were plenty of warning signs about <role id='role-44-Topic'trigno='44'>Abedi</role>. In a recent <trigger id='trigger-13'>study</trigger> of young British <role id='role-13-Subject'trigno='13'>jihadists</role> for the Henry Jackson Society, a London-based think tank, researcher <role id='role-13-Researcher'trigno='13'>Emma Webb</role> noted a failure of various agencies and educational institutions to share relevant information about individuals vulnerable to radicalization. <role id='role-12-Communicator'trigno='12'>She</role> <trigger id='trigger-12'>urged</trigger> police and social <role id='role-12-Recipient'trigno='12'>services</role> to share “relevant information on vulnerable individuals so the full picture is known across all agencies.” 
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E1", "text": "maimed", "offset": 37, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 38, "length": 1}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E2", "text": "killed", "offset": 35, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 38, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E3", "text": "attack", "offset": 25, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Britain", "offset": 27, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E4", "text": "Blast", "offset": 4, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "Manchester Bomber", "offset": 0, "length": 2}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "Street", "offset": 7, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E5", "text": "bombing", "offset": 63, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": {"text": "concert", "offset": 74, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E6", "text": "killed", "offset": 65, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 67, "length": 1}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E7", "text": "injured", "offset": 69, "length": 1, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "others", "offset": 71, "length": 1}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E8", "text": "returned", "offset": 149, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "He", "offset": 146, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "Libya", "offset": 157, "length": 1}}, {"role": "Destination", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E9", "text": "met", "offset": 176, "length": 1, "template": "[Participant] met face-to-face with [Participant] about [Topic] topic at [Place] place", "role_text_map": [{"role": "Participant", "token": {"text": "members", "offset": 178, "length": 1}}, {"role": "Participant", "token": {"text": "members", "offset": 178, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E10", "text": "trip", "offset": 169, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "he", "offset": 173, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E11", "text": "acknowledged", "offset": 267, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "services", "offset": 266, "length": 1}}, {"role": "Participant", "token": {"text": "services", "offset": 266, "length": 1}}, {"role": "Topic", "token": {"text": "Abedi", "offset": 268, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E12", "text": "persuade", "offset": 285, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "service", "offset": 280, "length": 1}}, {"role": "Recipient", "token": {"text": "him", "offset": 286, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E13", "text": "urged", "offset": 1012, "length": 1, "template": "[Communicator] communicated with [Recipient] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Communicator", "token": {"text": "She", "offset": 1011, "length": 1}}, {"role": "Recipient", "token": {"text": "services", "offset": 1016, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E14", "text": "study", "offset": 971, "length": 1, "template": "[Researcher] researched [Subject] subject using [Means] at [Place] place", "role_text_map": [{"role": "Researcher", "token": {"text": "Emma Webb", "offset": 990, "length": 2}}, {"role": "Subject", "token": {"text": "jihadists", "offset": 975, "length": 1}}, {"role": "Means", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E15", "text": "fleeing", "offset": 475, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "parents", "offset": 461, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "Libyan", "offset": 463, "length": 1}}, {"role": "Destination", "token": {"text": "city", "offset": 473, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E16", "text": "found", "offset": 466, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "parents", "offset": 461, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": {"text": "Libyan", "offset": 463, "length": 1}}, {"role": "Destination", "token": {"text": "city", "offset": 473, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E17", "text": "returned", "offset": 497, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "Ramadan Abedi", "offset": 486, "length": 2}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Libya", "offset": 499, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E18", "text": "bombing", "offset": 545, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E19", "text": "arrive", "offset": 549, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "officers", "offset": 548, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "property", "offset": 553, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E20", "text": "investigations", "offset": 569, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": null}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E21", "text": "told", "offset": 632, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "newspapers", "offset": 634, "length": 1}}, {"role": "Participant", "token": {"text": "newspapers", "offset": 634, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E22", "text": "say", "offset": 689, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "sources", "offset": 688, "length": 1}}, {"role": "Participant", "token": {"text": "sources", "offset": 688, "length": 1}}, {"role": "Topic", "token": {"text": "his", "offset": 690, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E23", "text": "built", "offset": 741, "length": 1, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "bomb", "offset": 743, "length": 1}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E24", "text": "bombing", "offset": 731, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E25", "text": "say", "offset": 167, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "sources", "offset": 166, "length": 1}}, {"role": "Participant", "token": {"text": "sources", "offset": 166, "length": 1}}, {"role": "Topic", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E26", "text": "improvised", "offset": 213, "length": 1, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "device", "offset": 215, "length": 1}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E27", "text": "describe", "offset": 234, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "neighbors", "offset": 233, "length": 1}}, {"role": "Participant", "token": {"text": "neighbors", "offset": 233, "length": 1}}, {"role": "Topic", "token": {"text": "him", "offset": 235, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E28", "text": "insist", "offset": 253, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "They", "offset": 252, "length": 1}}, {"role": "Participant", "token": {"text": "They", "offset": 252, "length": 1}}, {"role": "Topic", "token": {"text": "dropout", "offset": 260, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E29", "text": "denounced", "offset": 317, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "leader", "offset": 321, "length": 1}}, {"role": "Participant", "token": {"text": "leader", "offset": 321, "length": 1}}, {"role": "Topic", "token": {"text": "criticism", "offset": 324, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E30", "text": "say", "offset": 329, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "They", "offset": 328, "length": 1}}, {"role": "Participant", "token": {"text": "They", "offset": 328, "length": 1}}, {"role": "Topic", "token": {"text": "he", "offset": 330, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E31", "text": "told", "offset": 361, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "newspapers", "offset": 363, "length": 1}}, {"role": "Participant", "token": {"text": "newspapers", "offset": 363, "length": 1}}, {"role": "Topic", "token": {"text": "Abedi", "offset": 364, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E32", "text": "attack", "offset": 576, "length": 1, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E33", "text": "say", "offset": 586, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "emigres", "offset": 583, "length": 1}}, {"role": "Participant", "token": {"text": "emigres", "offset": 583, "length": 1}}, {"role": "Topic", "token": {"text": "father", "offset": 591, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E34", "text": "killed", "offset": 676, "length": 1, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "he", "offset": 674, "length": 1}}, {"role": "Place", "token": {"text": "Syria", "offset": 682, "length": 1}}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E35", "text": "strike", "offset": 680, "length": 1, "template": "[Attacker] attacked [Target] using [Instrument] at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": {"text": "Syria", "offset": 682, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E36", "text": "trip", "offset": 719, "length": 1, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "he", "offset": 720, "length": 1}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "Libya", "offset": 723, "length": 1}}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E37", "text": "described", "offset": 776, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "spokesman", "offset": 775, "length": 1}}, {"role": "Participant", "token": {"text": "spokesman", "offset": 775, "length": 1}}, {"role": "Topic", "token": {"text": "him", "offset": 777, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E38", "text": "praising", "offset": 871, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "brother", "offset": 855, "length": 1}}, {"role": "Participant", "token": {"text": "brother", "offset": 855, "length": 1}}, {"role": "Topic", "token": {"text": "jihadists", "offset": 872, "length": 1}}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E39", "text": "arrested", "offset": 875, "length": 1, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "Police", "offset": 874, "length": 1}}, {"role": "Detainee", "token": {"text": "Ismail", "offset": 876, "length": 1}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E40", "text": "taught", "offset": 885, "length": 1, "template": "[TeacherTrainer] taught [FieldOfKnowledge] field of knowledge to [Learner] using [Means] at [Institution] institution in [Place] place", "role_text_map": [{"role": "TeacherTrainer", "token": {"text": "He", "offset": 884, "length": 1}}, {"role": "FieldOfKnowledge", "token": null}, {"role": "Learner", "token": null}, {"role": "Means", "token": null}, {"role": "Institution", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E41", "text": "teaching", "offset": 910, "length": 1, "template": "[TeacherTrainer] taught [FieldOfKnowledge] field of knowledge to [Learner] using [Means] at [Institution] institution in [Place] place", "role_text_map": [{"role": "TeacherTrainer", "token": {"text": "he", "offset": 908, "length": 1}}, {"role": "FieldOfKnowledge", "token": null}, {"role": "Learner", "token": null}, {"role": "Means", "token": null}, {"role": "Institution", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E42", "text": "probing", "offset": 915, "length": 1, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "Police", "offset": 912, "length": 1}}, {"role": "Defendant", "token": {"text": "Abdalraouf Abdallah", "offset": 930, "length": 2}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E43", "text": "convicted", "offset": 946, "length": 1, "template": "[JudgeCourt] court or judge convicted [Defendant] of [Crime] crime in [Place] place", "role_text_map": [{"role": "JudgeCourt", "token": null}, {"role": "Defendant", "token": {"text": "Abdalraouf Abdallah", "offset": 930, "length": 2}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E44", "text": "sentenced", "offset": 935, "length": 1, "template": "[JudgeCourt] court or judge sentenced [Defendant] for [Crime] crime to [Sentence] sentence in [Place] place", "role_text_map": [{"role": "JudgeCourt", "token": null}, {"role": "Defendant", "token": {"text": "Abdalraouf Abdallah", "offset": 930, "length": 2}}, {"role": "Crime", "token": null}, {"role": "Sentence", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "74_VOA_EN_NW_2017.05.24.3868599-E45", "text": "argue", "offset": 958, "length": 1, "template": "[Participant] communicated with [Participant] about [Topic] topic at [Place] place (document does not specify in person or not, or one-way or not)", "role_text_map": [{"role": "Participant", "token": {"text": "analysts", "offset": 957, "length": 1}}, {"role": "Participant", "token": {"text": "analysts", "offset": 957, "length": 1}}, {"role": "Topic", "token": {"text": "Abedi", "offset": 966, "length": 1}}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>