<crowd-form answer-format="flatten-objects">
  <section class="container-fluid" id="Relevancy">
    <div class="row">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-primary">
          <a class="panel-heading" href="javascript:void(0);" id="collapseTrigger">
            <strong>Annotation Instructions</strong>
            <span class="collapse-text">(Click to expand)</span>
          </a>
          <div class="panel-body" id="instructionBody">
            {{INSTRUCTIONS}}
            {{LINK}}
          </div>
        </div>
      </div>
    </div>

    <h3>Document</h3>
    <div id="document-text" class="ann well well-sm">
      THE TWIN TOWERS; Deadly Bomb Was Cheap and Easily Made, Experts Say The <role id='role-1-Artifact'trigno='1'><role id='role-0-ExplosiveDevice'trigno='0'>bomb</role></role> that <trigger id='trigger-0'>savaged</trigger> the <role id='role-0-Target'trigno='0'>World</role> Trade Center, investigators and explosive experts said yesterday, apparently was <trigger id='trigger-1'>put</trigger> together with ordinary <role id='role-1-Components'trigno='1'>chemicals</role> that are widely and cheaply available at chemical supply houses and gardening centers throughout the country. Experts now estimate that the bomb weighed about 1, 000 pounds and that the <role id='role-2-AcquiredEntity'trigno='2'>chemicals</role> to make it were <trigger id='trigger-2'>bought</trigger> for a little more than <role id='role-2-PaymentBarter'trigno='2'>$</role> 400. Though a young chemical <role id='role-3-Detainee'trigno='3'>engineer</role> was <trigger id='trigger-3'>arrested</trigger> yesterday in connection with the explosion, the experts say that such a bomb could have been made by almost anyone with the help of one of scores of manuals, obtainable in bookstores and libraries, that provide step-by-step instructions."It's very easy to <trigger id='trigger-4'>make</trigger> one of these things,"said Edward M. Roy, an explosives expert at the New Mexico Institute of Mining and Technology in Socorro, N. M."I tell my students, a lot of <role id='role-5-Artifact'trigno='5'>explosives</role> I can <trigger id='trigger-5'>make</trigger> in my wastebasket."A Jumble of Chemicals Following the trail of <role id='role-6-Detainee'trigno='6'>Mohammed</role> A. Salameh, the ﬁrst suspect <trigger id='trigger-6'>arrested</trigger> in the bombing, <role id='role-7-Investigator'trigno='7'>investigators</role> <trigger id='trigger-7'>discovered</trigger> a jumble of chemicals, chemistry implements and detonating materials stacked in a storage locker at 69 Mallory Avenue in Jersey City that they say may also have served as the bomb laboratory. The day before the <trigger id='trigger-9'>explosion</trigger> that <trigger id='trigger-8'>killed</trigger> at least ﬁve <role id='role-8-Victim'trigno='8'>people</role> and <trigger id='trigger-10'>injured</trigger> more than 1, 000 <role id='role-10-Victim'trigno='10'>others</role>, Mr. Salameh and several other men made"numerous trips"to the locker, which Mr. Salameh had rented for $97 a month late last year, the authorities say. <role id='role-11-Transporter'trigno='11'>The</role> suspects <trigger id='trigger-11'>traveled</trigger> in a yellow Ford <role id='role-11-Vehicle'trigno='11'>van</role>, the investigators say, which has been identiﬁed as the vehicle that carried the explosive into the underground garage of the World Trade Center. A Thick Paste The investigators and experts say that after <trigger id='trigger-12'>mixing</trigger> the three main <role id='role-12-Components'trigno='12'>chemicals</role>--nitric and sulfuric acids and urea, a common ingredient in fertilizers--into a thick paste, the bombers are believed to have <trigger id='trigger-13'>packed</trigger> the <role id='role-13-Components'trigno='13'>material</role> into half a dozen or so cardboard boxes. <role id='role-14-Transporter'trigno='14'>They</role> simply loaded the boxes loosely into <role id='role-14-Vehicle'trigno='14'>the</role> van, without using a special container for them, the investigators believe, and <trigger id='trigger-14'>drove</trigger> across the <role id='role-14-Origin'trigno='14'>Hudson</role> River to <role id='role-14-Destination'trigno='14'>the</role> trade center. <role id='role-16-Attacker'trigno='16'><role id='role-15-Attacker'trigno='15'>The</role></role> bombers <trigger id='trigger-15'>ignited</trigger> their <role id='role-15-ExplosiveDevice'trigno='15'>concoction</role>, investigators believe, with several smaller nitroglycerine <role id='role-15-Instrument'trigno='15'>bombs</role>, which <role id='role-16-ExplosiveDevice'trigno='16'>themselves</role> were <trigger id='trigger-16'>touched</trigger> off with the kind of <role id='role-16-Instrument'trigno='16'>blasting</role> cap routinely used at construction and mining sites across the country. The blasting cap is the only ingredient in the deadly mix, the experts and law-enforcement ofﬁcials say, that requires a license or permit for purchase, and most probably was stolen. Manuals Were Found The investigators said they found manuals for bomb making in one of the apartments that <role id='role-17-Jailer'trigno='17'>they</role> raided after <trigger id='trigger-17'>arresting</trigger> Mr. <role id='role-17-Detainee'trigno='17'>Salameh</role>. Neil C. Livingstone, the president of the Institute on Terrorism and Sub-National Conﬂict in Washington, said that as a test of how easy it was to obtain such guides to destruction, he recently wrote to a publishing house using a child's lined notepad and a crayon. Three of the bomb-making <role id='role-18-PassengerArtifact'trigno='18'>manuals</role> were promptly <trigger id='trigger-18'>delivered</trigger> to the <role id='role-18-Destination'trigno='18'>address</role> Mr. Livingstone had given, he said, no questions asked. Though building the bomb was relatively easy, the experts say, it was not by any means free of danger. The bulkiest part of the bomb, they say, was extremely stable and could only have been touched off with a tremendous kick, like that provided by nitroglycerine. Making the nitroglycerine, by <trigger id='trigger-19'>blending</trigger> some of the <role id='role-19-Components'trigno='19'>chemicals</role>, was the trickiest part of the process. As the <role id='role-20-Components'trigno='20'>chemicals</role> are <trigger id='trigger-20'>mixed</trigger> to form this <role id='role-20-Artifact'trigno='20'>compound</role>, said Dr. Per-Anders Persson, the director of the center for explosives research at the New Mexico Institute of Mining and Technology, they get hot and may explode. Often, he said, beakers are packed in dry ice to keep the chemicals at a safe temperature. A Dangerous Mix The nitroglycerine could have also exploded prematurely with any jolt or sharp change in temperature, the experts said. The bombers risked blowing themselves up as well, the experts said, when <role id='role-21-ManufacturerAssembler'trigno='21'>they</role> <trigger id='trigger-21'>hooked</trigger> up the wires connecting the <role id='role-21-Artifact'trigno='21'>bomb</role>'s trigger with the <role id='role-21-Components'trigno='21'>blasting</role> cap. Dr. Robert H. Kupperman, a senior adviser for science and technology at the Center for Strategic and International Studies at Georgetown University, said that perhaps the greatest skill in making the bomb came in rigging the chain of triggering explosives so they all tore into the bulk of the bomb for maximum effect, as investigators at the World Trade Center say apparently happened. So far, in more than a week of <trigger id='trigger-22'>searching</trigger>, <role id='role-22-Investigator'trigno='22'>they</role> have not found a single grain of the main explosive material. Sulfuric Acid Widely Sold William Lazor, a senior technical consultant at the Du Pont Company in Wilmington, Del. , said that sulfuric acid is the most widely sold chemical in the United States, used in the manufacture of everything from battery acid to detergents and shampoos. Dale Ladysh, another consultant at Du Pont, said that nitric acid is only slightly behind in popularity. It is used, he said, in the electronics industry and for <trigger id='trigger-23'>making</trigger> stainless steel and many industrial dies and <role id='role-23-Artifact'trigno='23'>pigmentations</role>. Both acids are commonly used metal cleaners. According to Rick Amberg of Amberg Perennial Farm and Garden Center in Westﬁeld, N. J. , urea is often scattered over lawns to make them grow lustrously, and is also used in making plastics. Mr. <role id='role-24-Giver'trigno='24'>Amberg</role> <trigger id='trigger-24'>sells</trigger> a plastic 50-pound bag of urea for <role id='role-24-PaymentBarter'trigno='24'>$</role> 20. 99. In Newark, the <role id='role-25-Giver'trigno='25'>Dooner</role> & Smith Chemical Company <trigger id='trigger-25'>sells</trigger> a 15-gallon drum of <role id='role-25-AcquiredEntity'trigno='25'>sulfuric</role> acid, weighing 172 pounds, for <role id='role-25-PaymentBarter'trigno='25'>$</role> 41. 28. The same size container of nitric acid costs $44 and weighs 220 pounds."<role id='role-27-Damager'trigno='27'><role id='role-26-ManufacturerAssembler'trigno='26'>Whoever</role></role> <trigger id='trigger-26'>put</trigger> <role id='role-26-Artifact'trigno='26'>that</role> thing together really intended to do a lot of <trigger id='trigger-27'>damage</trigger>,"said Mr. Roy."This kind of explosive device is often used to fracture and move rock. It expands slowly with great force."
    </div>

    <div id='raw-data' hidden>
      [{"event_id": "JC002YBW2-E1", "text": "savaged", "offset": 17, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": {"text": "World Trade Center", "offset": 19}}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": {"text": "bomb", "offset": 15}}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E2", "text": "put together", "offset": 32, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "bomb", "offset": 15}}, {"role": "Components", "token": {"text": "chemicals", "offset": 36}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E3", "text": "bought", "offset": 74, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": null}, {"role": "Recipient", "token": null}, {"role": "AcquiredEntity", "token": {"text": "chemicals", "offset": 69}}, {"role": "PaymentBarter", "token": {"text": "$400", "offset": 80}}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E4", "text": "arrested", "offset": 89, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "engineer", "offset": 87}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E5", "text": "make", "offset": 143, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": null}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E6", "text": "make", "offset": 187, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "explosives", "offset": 184}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E7", "text": "arrested", "offset": 209, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": null}, {"role": "Detainee", "token": {"text": "Mohammed A. Salameh", "offset": 201}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E8", "text": "discovered", "offset": 215, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "investigators", "offset": 214}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E9", "text": "killed", "offset": 256, "template": "[Victim] died at [Place] place from [MedicalIssue] medical issue, killed by [Killer] killer", "role_text_map": [{"role": "Victim", "token": {"text": "people", "offset": 260}}, {"role": "Place", "token": null}, {"role": "Killer", "token": null}, {"role": "MedicalIssue", "token": null}]}, {"event_id": "JC002YBW2-E10", "text": "explosion", "offset": 254, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": null}, {"role": "Target", "token": null}, {"role": "Instrument", "token": null}, {"role": "ExplosiveDevice", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E11", "text": "injured", "offset": 262, "template": "[Victim] was injured by [Injurer] using [Instrument] in [BodyPart] body part with [MedicalCondition] medical issue at [Place] place", "role_text_map": [{"role": "Victim", "token": {"text": "others", "offset": 268}}, {"role": "Injurer", "token": null}, {"role": "Instrument", "token": null}, {"role": "BodyPart", "token": null}, {"role": "MedicalCondition", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E12", "text": "traveled", "offset": 307, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "The suspects", "offset": 305}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": {"text": "van", "offset": 312}}, {"role": "Origin", "token": null}, {"role": "Destination", "token": null}]}, {"event_id": "JC002YBW2-E13", "text": "mixing", "offset": 349, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": null}, {"role": "Components", "token": {"text": "chemicals", "offset": 353}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E14", "text": "packed", "offset": 379, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": null}, {"role": "Components", "token": {"text": "material", "offset": 381}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E15", "text": "drove", "offset": 414, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": {"text": "They", "offset": 391}}, {"role": "PassengerArtifact", "token": null}, {"role": "Vehicle", "token": {"text": "the van", "offset": 398}}, {"role": "Origin", "token": {"text": "Hudson River", "offset": 417}}, {"role": "Destination", "token": {"text": "the trade center", "offset": 420}}]}, {"event_id": "JC002YBW2-E16", "text": "ignited", "offset": 426, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "The bombers", "offset": 424}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": {"text": "bombs", "offset": 437}}, {"role": "ExplosiveDevice", "token": {"text": "concoction", "offset": 428}}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E17", "text": "touched off", "offset": 442, "template": "[Attacker] detonated or exploded [ExplosiveDevice] explosive device using [Instrument] to attack [Target] target at [Place] place", "role_text_map": [{"role": "Attacker", "token": {"text": "The bombers", "offset": 424}}, {"role": "Target", "token": null}, {"role": "Instrument", "token": {"text": "blasting cap", "offset": 448}}, {"role": "ExplosiveDevice", "token": {"text": "themselves", "offset": 440}}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E18", "text": "arresting", "offset": 518, "template": "[Jailer] arrested or jailed [Detainee] for [Crime] crime at [Place] place", "role_text_map": [{"role": "Jailer", "token": {"text": "they", "offset": 515}}, {"role": "Detainee", "token": {"text": "Salameh", "offset": 521}}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E19", "text": "delivered", "offset": 587, "template": "[Transporter] transported [PassengerArtifact] in [Vehicle] from [Origin] place to [Destination] place", "role_text_map": [{"role": "Transporter", "token": null}, {"role": "PassengerArtifact", "token": {"text": "manuals", "offset": 584}}, {"role": "Vehicle", "token": null}, {"role": "Origin", "token": null}, {"role": "Destination", "token": {"text": "address", "offset": 590}}]}, {"event_id": "JC002YBW2-E20", "text": "blending", "offset": 662, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": null}, {"role": "Components", "token": {"text": "chemicals", "offset": 666}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E21", "text": "mixed", "offset": 680, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "compound", "offset": 684}}, {"role": "Components", "token": {"text": "chemicals", "offset": 678}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E26", "text": "hooked up", "offset": 777, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": {"text": "they", "offset": 776}}, {"role": "Artifact", "token": {"text": "bomb", "offset": 783}}, {"role": "Components", "token": {"text": "blasting cap", "offset": 789}}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E27", "text": "searching", "offset": 870, "template": "[Investigator] investigated [Defendant] for [Crime] crime in [Place] place", "role_text_map": [{"role": "Investigator", "token": {"text": "they", "offset": 872}}, {"role": "Defendant", "token": null}, {"role": "Crime", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E28", "text": "making", "offset": 969, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": null}, {"role": "Artifact", "token": {"text": "pigmentations", "offset": 977}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E29", "text": "sells", "offset": 1029, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": {"text": "Amberg", "offset": 1028}}, {"role": "Recipient", "token": null}, {"role": "AcquiredEntity", "token": null}, {"role": "PaymentBarter", "token": {"text": "$20.99", "offset": 1039}}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E30", "text": "sells", "offset": 1053, "template": "[Giver] bought, sold, or traded [AcquiredEntity] to [Recipient] in exchange for [PaymentBarter] for the benefit of [Beneficiary] at [Place] place", "role_text_map": [{"role": "Giver", "token": {"text": "Dooner & Smith Chemical Company", "offset": 1048}}, {"role": "Recipient", "token": null}, {"role": "AcquiredEntity", "token": {"text": "sulfuric acid", "offset": 1060}}, {"role": "PaymentBarter", "token": {"text": "$41.28", "offset": 1068}}, {"role": "Beneficiary", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E31", "text": "put", "offset": 1090, "template": "[ManufacturerAssembler] manufactured or assembled or produced [Artifact] from [Components] components using [Instrument] at [Place] place", "role_text_map": [{"role": "ManufacturerAssembler", "token": {"text": "Whoever", "offset": 1089}}, {"role": "Artifact", "token": {"text": "that thing", "offset": 1091}}, {"role": "Components", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}, {"event_id": "JC002YBW2-E32", "text": "damage", "offset": 1101, "template": "[Damager] damaged [Artifact] using [Instrument] instrument in [Place] place", "role_text_map": [{"role": "Damager", "token": {"text": "Whoever", "offset": 1089}}, {"role": "Artifact", "token": null}, {"role": "Instrument", "token": null}, {"role": "Place", "token": null}]}]
    </div>

    <p>
      You can navigate all of the triggers by clicking the following buttons. <br>
      You have to finish all the triggers before submitting. (Remember that you can't refresh the page otherwise
      the progress will be gone, <br>
      to prevent this from happening, we suggest that you write the QA pairs in the google doc and copy paste them
      here)
    </p>
    <!-- Tabs for each trigger -->
    <div class="btn-toolbar" id="button-bar">
    </div>

    <section>
      <div style="margin-top:10px;">
        <em>
          These are bootstrap question answer pairs generated by GPT. Not all QA
          pairs are correct or relevant, but feel free to copy/paste the samples that are accurate
          enough, and make edits on top.
        </em>
        <div id='bootstrap-area' class='ann well well-sm'>
        </div>
      </div>

      <div style="margin-top:10px;">
        <em>
          These are KAIROS event arguments for the trigger. You can use them to help you write QA pairs.
          The underlying meaning of such pairs should be "Q: What is arg X of the event? A: arg X is Y".
          But the formatting of the QA pairs must be as in the instructions.
        </em>
        <div id='template-area' class='ann well well-sm'>
        </div>
      </div>

      <div class="btn-container">
        <button id="addbtn" class="btn btn-success" type="button" onclick="add_qa_input()">+</button>
        <label for="addbtn">Add a QA pair</label>
      </div>
      <div class="btn-container">
        <button id="rmbtn" class="btn btn-danger" type="button" onclick="remove_qa_input()">-</button>
        <label for="rmbtn">Remove a QA pair</label>
      </div>

      <div id="input-area">

      </div>
    </section>

    <div title="Highlight all fields before submitting">
      <button id="save" class="btn btn-default" type="button">Save</button>
      <button id="submitButton" class="btn btn-default" type="button">Submit</button>
    </div>
  </section>


  <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"
    integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  <style>
    .mg-15 {
      margin-left: 15px;
      margin-right: 15px;
    }

    .container-fluid {
      max-width: 1800px;
      margin: 30px;
    }

    .btn-container {
      display: inline-block;
      margin: 10px;
    }

    #collapseTrigger {
      color: #fff;
      display: block;
      text-decoration: none;
    }

    #submitButton {
      white-space: normal;
    }

    #input-area {
      display: block;
      margin: 10px;
    }

    #input-area>div {
      margin: 10px;
      background-color: #ffe3e3;
    }

    #bootstrap-area {
      background-color: #f7dec5;
    }

    #template-area {
      background-color: #75c3e7;
    }

    .btn-container>button {
      min-width: 3em;
    }

    trigger {
      display: inline;
      background-color: lightgoldenrodyellow;
    }

    role {
      display: inline;
      background-color: lightblue;
    }

    .highlight-trigger {
      background-color: palevioletred
    }

    .highlight-role {
      background-color: lightgreen;
    }

    .btn-group {
      vertical-align: middle;
    }

    .content {
      margin-bottom: 15px;
    }

    .ann {
      font-size: 16px;
    }

    .disp {
      font-size: 20px;
    }

    .ann>span.token {
      cursor: pointer;
    }

    .ann>span.token:hover {
      text-decoration: underline;
    }

    .ann>strong.annotation:hover {
      text-decoration: line-through;
    }

    input[disabled] {
      color: #000
    }
  </style>

  <script>
    // ---------------------------------------------------------
    // Global
    // ---------------------------------------------------------

    var page_num = 0;

    // ---------------------------------------------------------
    // Create jQuery elements
    // ---------------------------------------------------------

    var submit = $('#submitButton');

    // list of text/offset objects 
    var triggers_list = JSON.parse($('#raw-data').text().trim());

    const empty_template_area = function () {
      return $('<div id="template-area">');
    }

    let save_record = [];
    let template_record = [];
    triggers_list.forEach(function (_, idx) {
      template_record[idx] = empty_template_area();
    });

    // implementation of string formatting
    if (!String.prototype.format) {
      String.prototype.format = function () {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function (match, number) {
          return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
      };
    }

    // ---------------------------------------------------------
    // Create elements
    // ---------------------------------------------------------

    var makeDom = function (page_count) {
      make_trigger(page_count);
      recoverUserInput(page_count);
    };

    var make_trigger = function (question_num) {
      /* highlight trigger within document */

      const trigger = triggers_list[question_num];
      // remove previous highlights
      $('trigger').removeClass('highlight-trigger');
      $('role').removeClass('highlight-role');
      // highlight trigger
      $('#trigger-' + question_num).addClass('highlight-trigger');
      $('role[trigno=' + question_num + ']').addClass('highlight-role');

      /* update bootstrap questions */
      $('#bootstrap-area').html(trigger.bootstrap ?? 'no bootstrap available');

    }

    // restore input from other trigger
    var recoverUserInput = function (claim_num) {
      // simply swap out the input area DOM element!
      $('#template-area').replaceWith(template_record[claim_num]);
    };

    // ensure something is in the input box
    var canSubmit = function () {
      return true;
    };

    // template role fields
    const make_role_mapping_element = function (role, text) {
      const role_text = $('<label>').html('<b>' + role + '</b>:');
      const role_field = $('<span>')
        .addClass('role-field')
        .attr({
          role: role,
          rows: 1,
        })
        .text(text)

      const role_div = $('<div>')
        .addClass('role-container')
        .append(role_text)
        .append(role_field);

      return role_div;
    }

    // number of QA pairs at the moment
    var input_count = 0;

    const add_qa_input = function () {
      const current_idx = input_count;
      let question_text = $('<label>').text('question:');
      let question_input = $('<textarea>')
        .addClass('question-input')
        .addClass('mg-15')
        .attr({
          id: 'input-question' + input_count,
          name: 'input-question' + input_count,
          placeholder: 'write down your question',
          rows: 1,
          cols: 80,
        });
      question_input.on("input", function () {
        // if (is_wh_question(question_input.val())) {
        //     window.alert("It seems you are not writing a yes/no question, make sure " +
        //         "you are writing questions of which the answer is yes or no!")
        // }
        show();
      });
      let answer_text = $('<label>').text('answer:');
      let answer_input = $('<textarea>')
        .addClass('answer-input')
        .addClass('mg-15')
        .attr({
          id: 'input-answer' + input_count,
          name: 'input-answer' + input_count,
          placeholder: 'write down your answer',
          rows: 1,
          cols: 80,
        });
      answer_input.on("input", function () {
        show();
      });

      let input_fields = $(
        '<div>').addClass('input-fields')
        .append(question_text)
        .append(question_input)
        .append(answer_text)
        .append(answer_input)
      $('#input-area').append(input_fields);

      input_count += 1;
      show();
    };

    const remove_qa_input = function () {
      if (input_count <= 0) {
        return;
      }
      $('#input-area').children().last().remove();
      input_count -= 1;
      show();
    };

    var enable_button = function (button) {
      button.removeAttr("disabled");
      button.removeClass("btn-default");
      button.addClass("btn-success");
    };

    var disable_button = function (button) {
      button.attr("disabled", "disabled");
      button.removeClass("btn-success");
      button.addClass("btn-default");
    };

    var select_button = function (button) {
      button.removeClass("btn-default");
      button.addClass("btn-primary");
    };

    var deselect_button = function (button) {
      button.removeClass("btn-primary");
      button.addClass("btn-default");
    };

    var is_wh_question = function (question) {
      let tokens = question.split(' ');
      if (tokens.length <= 1) {
        return false;
      }
      console.log(tokens);

      // let wh_pattern = /^Wh\|wh\|How\|how/;
      let wh_pattern = /^wh|Wh|how|How/;
      // console.log(question.match(wh_pattern));
      return !!question.match(wh_pattern);
    };


    var show = function () {
      for (button of document.getElementById('button-bar').getElementsByTagName('*')) {
        if (page_num == button.getAttribute('page-no'))
          select_button($(button));
        else
          deselect_button($(button));
      }

      if (canSubmit()) {
        enable_button(submit);
        // enable_button($('#next-btn'));
      } else {
        disable_button(submit);
        // disable_button($('#next-btn'));
      }
    };

    // dynamically create buttons for each SRL arg
    triggers_list.forEach(function (trigger, i) {
      if (trigger.text.trim()) {
        console.log(trigger);
        var button = document.createElement("button");
        button.setAttribute("type", "button");
        button.setAttribute("id", "button-page-" + i);
        button.setAttribute("page-no", i);
        button.setAttribute("class", "btn btn-default");
        button.innerHTML = trigger.text + " @ token " + trigger.offset;
        button.onclick = function () {
          page_num = parseInt(this.getAttribute("page-no"));
          makeDom(page_num);
          let instruction = $('#instructionBody');
          if (instruction.is(':visible')) {
            instruction.toggle();
          }
          //window.scrollTo(0, 0); // scroll to top
          show();
        }
        document.getElementById('button-bar').appendChild(button);
      }

      // replace newlines with HTML line breaks
      const bootstrap = trigger.bootstrap;
      if (bootstrap !== undefined)
        trigger.bootstrap = bootstrap.replaceAll('\n', '<br>');

      // format template area with role mappings
      // if template not null or undefined
      if (trigger.template !== null) {
        const template_area = template_record[i];
        const template = $('<p>').text(trigger.template);
        template_area.append(template);
        trigger.role_text_map.forEach(function (pairing) {
          template_area.append(make_role_mapping_element(pairing.role, pairing.token?.text));
        });
      }
    })

    // ---------------------------------------------------------
    // Initialize
    // ---------------------------------------------------------

    makeDom(0);

    var save_all = function () {
      save_record.qapairs = [];
      save_record.triggers = [];
      // save all input
      triggers_list.forEach(function (trigger, idx) {
        // initialize record
        save_record.triggers[idx] = {
          event_id: trigger.event_id,
          trigger: {
            text: trigger.text,
            offset: trigger.offset
          },
          template: trigger.template,
          role_map: {},
        };

        // get input elements
        const template_input_area = template_record[idx];
        const template_inputs = template_input_area.children();

        // traverse over elements to get role mappings
        template_inputs.each(function (_, input) {
          const role = $(input).children('.role-field').attr('role');
          const text = $(input).children('.role-field').val();

          save_record.triggers[idx].role_map[role] = text;
        });
      });

      const trigger_input_area = $('#input-area');
      const trigger_inputs = trigger_input_area.children();

      // traverse over elements to get QA pairs
      trigger_inputs.each(function (_, input) {
        // save qa pairs
        const question = $(input).children('.question-input').val();
        const answer = $(input).children('.answer-input').val();
        save_record.qapairs.push({
          'question': question,
          'answer': answer
        });
      });

      console.log(save_record);
    };

    var submit_form = function () {
      save_all();

      const urlParams = new URLSearchParams(window.location.search)

      // create the form element and point it to the correct endpoint
      const form = document.createElement('form')
      form.action = (new URL('mturk/externalSubmit', urlParams.get('turkSubmitTo'))).href
      form.method = 'post'

      // attach the assignmentId
      const inputAssignmentId = document.createElement('input')
      inputAssignmentId.name = 'assignmentId'
      inputAssignmentId.value = urlParams.get('assignmentId')
      inputAssignmentId.hidden = true
      form.appendChild(inputAssignmentId)

      // attach data I want to send back
      const inputResults = document.createElement('input')
      inputResults.name = 'results'
      inputResults.value = JSON.stringify(save_record)
      inputResults.hidden = true
      form.appendChild(inputResults)

      // attach the form to the HTML document and trigger submission
      document.body.appendChild(form)
      form.submit()
    }

    $('#save').on('click', save_all);
    submit.on('click', submit_form);

    var popup_alert = function (alert_box, text) {
      alert_box.html(text);
      alert_box.css({
        'background-color': 'fec5bb',
        'padding': '5px',
        'border': '1px solid lightgray',
        'border-radius': '10px',
        'margin-top': '10px',
        'margin-bottom': '10px'
      });
      displaying = true;
      setTimeout(function () {
        alert_box.html('');
        alert_box.css({
          'padding': '0px',
          'border': '0px'
        });
        displaying = false;
      }, 7000);
    };

    // Instructions expand/collapse
    var content = $('#instructionBody');
    var instructions_trigger = $('#collapseTrigger');
    // content.hide();
    $('.collapse-text').text('(Click to collapse)');
    instructions_trigger.click(function () {
      content.toggle();
      var isVisible = content.is(':visible');
      if (isVisible) {
        $('.collapse-text').text('(Click to collapse)');
      } else {
        $('.collapse-text').text('(Click to expand)');
      }
    });

    show();

  </script>
</crowd-form>